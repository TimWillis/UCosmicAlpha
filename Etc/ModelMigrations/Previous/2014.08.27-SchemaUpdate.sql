/*
Deployment script for UCosmicTest

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
PRINT N'Creating [HomeSection]...';


GO
CREATE SCHEMA [HomeSection]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [HomeSection].[HomeSection]...';


GO
CREATE TABLE [HomeSection].[HomeSection] (
    [Id]              INT            IDENTITY (1, 1) NOT NULL,
    [EstablishmentId] INT            NOT NULL,
    [Title]           NVARCHAR (MAX) NOT NULL,
    [Description]     NVARCHAR (MAX) NOT NULL,
    [PhotoId]         INT            NOT NULL,
    CONSTRAINT [PK_HomeSection.HomeSection] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [HomeSection].[HomeSection].[IX_EstablishmentId]...';


GO
CREATE NONCLUSTERED INDEX [IX_EstablishmentId]
    ON [HomeSection].[HomeSection]([EstablishmentId] ASC);


GO
PRINT N'Creating [HomeSection].[HomeSection].[IX_PhotoId]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhotoId]
    ON [HomeSection].[HomeSection]([PhotoId] ASC);


GO
PRINT N'Creating [HomeSection].[HomeLink]...';


GO
CREATE TABLE [HomeSection].[HomeLink] (
    [Id]            INT            IDENTITY (1, 1) NOT NULL,
    [HomeSectionId] INT            NOT NULL,
    [Url]           NVARCHAR (MAX) NOT NULL,
    [Text]          NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [PK_HomeSection.HomeLink] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [HomeSection].[HomeLink].[IX_HomeSectionId]...';


GO
CREATE NONCLUSTERED INDEX [IX_HomeSectionId]
    ON [HomeSection].[HomeLink]([HomeSectionId] ASC);


GO
PRINT N'Creating FK_HomeSection.HomeSection_Establishments.Establishment_EstablishmentId...';


GO
ALTER TABLE [HomeSection].[HomeSection] WITH NOCHECK
    ADD CONSTRAINT [FK_HomeSection.HomeSection_Establishments.Establishment_EstablishmentId] FOREIGN KEY ([EstablishmentId]) REFERENCES [Establishments].[Establishment] ([RevisionId]);


GO
PRINT N'Creating FK_HomeSection.HomeSection_Files.ExternalFile_PhotoId...';


GO
ALTER TABLE [HomeSection].[HomeSection] WITH NOCHECK
    ADD CONSTRAINT [FK_HomeSection.HomeSection_Files.ExternalFile_PhotoId] FOREIGN KEY ([PhotoId]) REFERENCES [Files].[ExternalFile] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating FK_HomeSection.HomeLink_HomeSection.HomeSection_HomeSectionId...';


GO
ALTER TABLE [HomeSection].[HomeLink] WITH NOCHECK
    ADD CONSTRAINT [FK_HomeSection.HomeLink_HomeSection.HomeSection_HomeSectionId] FOREIGN KEY ([HomeSectionId]) REFERENCES [HomeSection].[HomeSection] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Checking existing data against newly created constraints';


GO
ALTER TABLE [HomeSection].[HomeSection] WITH CHECK CHECK CONSTRAINT [FK_HomeSection.HomeSection_Establishments.Establishment_EstablishmentId];

ALTER TABLE [HomeSection].[HomeSection] WITH CHECK CHECK CONSTRAINT [FK_HomeSection.HomeSection_Files.ExternalFile_PhotoId];

ALTER TABLE [HomeSection].[HomeLink] WITH CHECK CHECK CONSTRAINT [FK_HomeSection.HomeLink_HomeSection.HomeSection_HomeSectionId];


GO
PRINT N'Update complete.';


GO
