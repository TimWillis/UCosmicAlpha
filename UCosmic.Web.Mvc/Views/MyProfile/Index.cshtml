@{
    var customProfileTitle = "My UCosmic Profile";
    var tenancy = Request.Tenancy();
    if (tenancy != null && !string.IsNullOrWhiteSpace(tenancy.CustomProfileTitle))
    {
        customProfileTitle = tenancy.CustomProfileTitle;
    }
    ViewBag.Title = customProfileTitle;
}

@section styles
{
}

@section scripts
{
    @Scripts.Render("~/bundles/my/profile")
    @Scripts.Render("~/bundles/activities")

    <script type="text/javascript">

        $(function () {
            var profileViewModel = new ViewModels.My.Profile();
            $(profileViewModel).on('ready', function () {
                ko.applyBindings(profileViewModel, $('#my_profile')[0]);
                var activitiesViewModel = new ViewModels.Activities.ActivityList("activities", profileViewModel.personId);
            });
            $('#tabstrip').kendoTabStrip({
                animation: false
            })
            .show();

        });

    </script>

}

@section bib
{
    <nav class="bib hide" data-current-bib="my">
        @Html.Partial(MVC.Home.Views._Bib)
    </nav>
}

<div class="content fixed to-top" data-current-module="home">
    <div data-side-swiper="root">
        <div data-side-swiper="deck">
            <div data-side-swiper="on">
                <div class="group">
                    <div class="on-left from-top" style="width: 100%;">
                        <header>
                            <h1>@ViewBag.Title</h1>
                        </header>
                        <div id="my_profile">
                            <section class="person-profile" data-bind="click: startEditing, css: { clickable: !editMode() }">
                                <div class="card">
                                    <div class="group">
                                        <div class="on-left photo">
                                            <img src="~/images/icons/user/unisex-a-128.png" alt="" data-bind="attr: { src: photoSrc }" />
                                        </div>
                                        <div class="on-left name-and-title">
                                            <div class="display-name" data-bind="text: displayName"></div>
                                            <div class="titles" data-bind="multilineText: jobTitles"></div>
                                            @if (User.IsInRole(RoleName.EmployeeProfileManager))
                                            {
                                                <div class="admin-only">
                                                    <em><span data-bind="text: genderText"></span>, <span data-bind="text: isActiveText"></span></em>
                                                </div>
                                            }
                                        </div>
                                        <div class="on-left faculty">
                                            <span class="branded-dark1 badge" style="display: none;" data-bind="text: facultyRankText, visible: isFacultyRankVisible"></span>
                                            <div class="appointments" data-bind="multilineText: administrativeAppointments">
                                                <br />
                                                <br />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="action">
                                    Click to edit
                                </div>
                            </section>
                            <section class="fieldset" style="display: none;" data-bind="jqElement: '$editSection'">
                                <fieldset class="no-sidebar">
                                    <legend>Edit @customProfileTitle</legend>
                                    @Html.Partial(MVC.MyProfile.Views._PersonalInfo)
                                </fieldset>
                            </section>
                        </div>
                        <div id="tabstrip" class="profile-tabs" style="display: none;">
                            <ul>
                                <li class="k-state-active">Activities</li>
                                <li>Geographic Expertise</li>
                                <li>Language Expertise</li>
                                <li>Formal Education</li>
                                <li>Affiliations</li>
                                <li>Email Addresses</li>
                            </ul>
                            <div>
                                <div id="activities"> <!-- TODO: Move to partial -->
                                    <header>
                                        <h2>
                                            <span>Activities</span>
                                            <a href="#" title="Add a new activity" data-bind="click: addActivity">
                                                <img src="~/images/icons/plus/plus-24-green.png" alt="Add a new activity" />
                                            </a>
                                        </h2>
                                    </header>
                                    <table class="data">
                                        <colgroup>
                                            <col style="width: 10%" />
                                            <col style="width: 80%" />
                                        </colgroup>
                                        <tbody data-bind="template: { name: 'activities-template', foreach: items }">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                My Geographic Expertise
                            </div>
                            <div>
                                My Language Expertise
                            </div>
                            <div>
                                My Formal Education Outside the U.S.
                            </div>
                            <div>
                                My Affiliations
                                @Html.Partial(MVC.MyProfile.Views._Affiliations)
                            </div>
                            <div>
                                My Email Addresses
                                @Html.Partial(MVC.MyProfile.Views._EmailAddresses)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="activities-template">
    <tr class="hover-hilite" >
        <!-- image -->
        <td>
            <img src="../../images/placeholders/blue-96x96.png" alt="image" width="96" height="96" />
        </td>
        <!-- Description (styles will be moved later) -->
        <td style="vertical-align: top">
            <div style="height: 30px">
                <span style="font-size: large; font-weight: bold; vertical-align: middle" data-bind="text: $parent.getTypeName(values()[0].typeId())"></span>
                <span class="red badge" style="display:inline; vertical-align: middle" data-bind="visible: modeText().toLowerCase() == 'draft'">Draft</span>
            </div>
            <div class="ellipsis">
                <span data-bind="text: values()[0].title()"></span>
            </div>
            <div class="ellipsis">
                <span style="font-size: small" data-bind="text: $parent.activityDatesFormatted(values()[0].startsOn(), values()[0].endsOn())"></span>
                <span style="font-size: small" data-bind="text: $parent.activityLocationsFormatted(values()[0].locations())"></span>
            </div>
        </td>
        <!-- Remove Button -->
        <td style="text-align: center; vertical-align: middle">
            <a href="#" title="Remove activity">
                <img src="../../images/icons/minus/minus-24-red.png" alt="Remove activity" />
            </a>
        </td>
    </tr>
</script>

