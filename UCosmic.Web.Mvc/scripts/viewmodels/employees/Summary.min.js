var Employees;(function(n){(function(t){var i=function(){function n(){var n=this;this._state=ko.observable("up"),this.isUp=ko.computed(function(){return n._state()=="up"}),this.isHover=ko.computed(function(){return n._state()=="hover"})}return n.prototype.onMouseEnter=function(){this._state("hover")},n.prototype.onMouseLeave=function(){this._state("up")},n}(),r,u;t.ImageSwapper=i,r=function(){function n(n){this.loader=n,this._promise=$.Deferred()}return n.prototype.ready=function(){var n=this;return this._response||this.loader().done(function(t){n._response=t,n._promise.resolve(n._response)}).fail(function(){n._promise.reject()}),this._promise},n}(),t.DataCacher=r,u=function(){function t(n){var u=this;this.settings=n,this.geoChartSpinner=new App.Spinner(new App.SpinnerOptions(400,!0)),this.isGeoChartReady=ko.observable(!1),this.activityPlaceData=new r(function(){return u._loadActivityPlaceData()}),this.isD3Undefined=ko.computed(function(){return!t._isD3Defined()}),this.pacificOceanSwapper=new i,this.gulfOfMexicoSwapper=new i,this.caribbeanSeaSwapper=new i,this.atlanticOceanSwapper=new i,this.southernOceanSwapper=new i,this.arcticOceanSwapper=new i,this.indianOceanSwapper=new i,this.antarcticaSwapper=new i,this.activitiesSummary={personCount:ko.observable("?"),activityCount:ko.observable("?"),locationCount:ko.observable("?")},this.activitiesSummaryData=new r(function(){return u._loadActivitiesSummary()}),this.geoChart=new App.Google.GeoChart(document.getElementById(this.settings.geoChartElementId)),this._drawGeoChart(),this.activitiesSummaryData.ready()}return t.loadGoogleVisualization=function(){var n=this;return google.load("visualization","1",{packages:["corechart","geochart"]}),google.setOnLoadCallback(function(){n._googleVisualizationLoadedPromise.resolve()}),this._googleVisualizationLoadedPromise},t.prototype._loadActivityPlaceData=function(){var i=this,t=$.Deferred();return this.geoChartSpinner.start(),n.Servers.ActivityPlaces(this.settings.tenantDomain,{countries:!0}).done(function(n){t.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load activity location summary data.",!0),t.reject()}).always(function(){i.geoChartSpinner.stop()}),t},t.prototype._drawGeoChart=function(){var t=this,i={displayMode:"regions",region:"world",keepAspectRatio:!1,colorAxis:{minValue:1,colors:["#dceadc","#006400"]},backgroundColor:"#acccfd"},n=new google.visualization.DataTable;n.addColumn("string","Place"),n.addColumn("number","Total Activities"),this.geoChart.draw(n,i).then(function(){t.isGeoChartReady(!0),t._testSvgInjection(),t.activityPlaceData.ready().done(function(r){$.each(r,function(t,i){n.addRow([i.placeName,i.activityIds.length])}),t.geoChart.draw(n,i)})})},t._isD3Defined=function(){return typeof d3!="undefined"},t.prototype._testSvgInjection=function(){var i;if(t._isD3Defined()&&this.settings.geoChartWaterOverlaysElementId){var r=d3.select("#{0} svg > g".format(this.settings.geoChartElementId)),u=r.append("g").attr("id","{0}_root".format(this.settings.geoChartWaterOverlaysElementId)),n=$("#{0}".format(this.settings.geoChartWaterOverlaysElementId));n.show(),i=n.children(),$.each(i,function(n,t){var i=u.append("g"),r=$(t);$.each($(t).children(),function(n,t){var u=$(t);if(u.prop("tagName").toUpperCase()==="IMG"){var e=r.position().left,o=r.position().top,s=u.css("width"),h=u.css("height"),c=u.attr("src"),f=u.css("display"),l=i.append("image").attr("xlink:href",c).attr("x",e).attr("y",o).attr("width",s).attr("height",h);f&&f.toLowerCase()=="none"&&l.attr("style","display: none;")}}),$.each($(i[0][0]).children(),function(n,t){var r=$(t),i=d3.select(t),f=r.css("display"),s=r.siblings("image"),h=f&&f.toLowerCase()=="none"?"mouseleave":"mouseenter",u,e,o;i.on(h,function(){r.hide(),s.show()});u=i.attr("xlink:href"),u&&u.toLowerCase().indexOf("caribbean")>0&&(e=i.attr("y"),o=parseInt(e)+5,i.attr("y",o))})}),n.hide(),$("#google_geochart svg > g > g:last-child").insertAfter("#google_geochart svg > g > g:nth-child(2)").removeAttr("id")}},t.prototype._loadActivitiesSummary=function(){var i=this,t=$.Deferred();return n.Servers.ActivitiesSummary(this.settings.tenantDomain).done(function(n){ko.mapping.fromJS(n,{},i.activitiesSummary),t.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load activity total summary data.",!0),t.reject()}),t},t._googleVisualizationLoadedPromise=$.Deferred(),t}(),t.Summary=u})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Employees||(Employees={}))