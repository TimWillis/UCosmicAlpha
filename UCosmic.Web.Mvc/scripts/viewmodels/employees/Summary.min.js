var Employees;(function(n){(function(t){var i=function(){function n(){var n=this;this._state=ko.observable("up"),this.isUp=ko.computed(function(){return n._state()=="up"}),this.isHover=ko.computed(function(){return n._state()=="hover"})}return n.prototype.mouseover=function(){this._state("hover")},n.prototype.mouseout=function(){this._state("up")},n}(),r,u;t.ImageSwapper=i,r=function(){function n(n){this.loader=n,this._promise=$.Deferred()}return n.prototype.ready=function(){var n=this;return this._response||this.loader().done(function(t){n._response=t,n._promise.resolve(n._response)}).fail(function(){n._promise.reject()}),this._promise},n}(),t.DataCacher=r,u=function(){function t(n){var t=this;this.settings=n,this.geoChartSpinner=new App.Spinner(new App.SpinnerOptions(400,!0)),this.isGeoChartReady=ko.observable(!1),this.activityPlaceData=new r(function(){return t._loadActivityPlaceData()}),this.pacificOceanSwapper=new i,this.gulfOfMexicoSwapper=new i,this.caribbeanSeaSwapper=new i,this.atlanticOceanSwapper=new i,this.southernOceanSwapper=new i,this.arcticOceanSwapper=new i,this.indianOceanSwapper=new i,this.antarcticaSwapper=new i,this.activitiesSummary={personCount:ko.observable("?"),activityCount:ko.observable("?"),locationCount:ko.observable("?")},this.activitiesSummaryData=new r(function(){return t._loadActivitiesSummary()}),this.geoChart=new App.Google.GeoChart(document.getElementById(this.settings.geoChartElementId)),this._drawGeoChart(),this.activitiesSummaryData.ready()}return t.loadGoogleVisualization=function(){var n=this;return google.load("visualization","1",{packages:["corechart","geochart"]}),google.setOnLoadCallback(function(){n._googleVisualizationLoadedPromise.resolve()}),this._googleVisualizationLoadedPromise},t.prototype._loadActivityPlaceData=function(){var i=this,t=$.Deferred();return this.geoChartSpinner.start(),n.Servers.ActivityPlaces(this.settings.tenantDomain,{countries:!0}).done(function(n){t.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load activity location summary data.",!0),t.reject()}).always(function(){i.geoChartSpinner.stop()}),t},t.prototype._drawGeoChart=function(){var t=this,i={displayMode:"regions",region:"world",keepAspectRatio:!1,colorAxis:{minValue:1,colors:["#dceadc","#006400"]},backgroundColor:"#acccfd"},n=new google.visualization.DataTable;n.addColumn("string","Place"),n.addColumn("number","Total Activities"),this.geoChart.draw(n,i).then(function(){t.isGeoChartReady(!0),t._testSvgInection(),t.activityPlaceData.ready().done(function(r){$.each(r,function(t,i){n.addRow([i.placeName,i.activityIds.length])}),t.geoChart.draw(n,i)})})},t._isD3Defined=function(){return typeof d3!="undefined"},t.prototype._testSvgInjection1=function(){if(t._isD3Defined()){var n=$("#geochart_overlay").html(),i=d3.select("#google_geochart svg > g");i.append("g").attr("id","google_geochart_custom_foreignobject").append("foreignObject").append("xhtml:div").html(n),$("#google_geochart_custom_foreignobject").insertAfter("#google_geochart svg > g > g:nth-child(2)")}},t.prototype._testSvgInection=function(){if(t._isD3Defined()){var n=d3.select("#google_geochart svg > g"),i=n.append("g").attr("id","overlay_root"),r=$("#google_geochart_overlay_container section");$.each(r,function(n,t){var r=i.append("g");$.each($(t).children(),function(n,t){var i=$(t),e=i.attr("src"),o=i.css("left"),s=i.css("top"),h=i.css("width"),c=i.css("height"),u=i.css("display"),f;i.prop("tagName").toUpperCase()=="IMG"&&(f=r.append("image").attr("xlink:href",e).attr("x",parseInt(o)).attr("y",parseInt(s)).attr("width",h).attr("height",c),u&&u.toLowerCase()=="none"&&f.attr("style","display: none;"))}),$.each($(r[0][0]).children(),function(n,t){var i=$(t),u=d3.select(t),r=i.css("display"),f=i.siblings("image"),e=r&&r.toLowerCase()=="none"?"mouseleave":"mouseenter";u.on(e,function(){i.hide(),f.show()})})}),$("#google_geochart svg > g > g:last-child").insertAfter("#google_geochart svg > g > g:nth-child(2)")}},t.prototype._loadActivitiesSummary=function(){var i=this,t=$.Deferred();return n.Servers.ActivitiesSummary(this.settings.tenantDomain).done(function(n){ko.mapping.fromJS(n,{},i.activitiesSummary),t.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load activity total summary data.",!0),t.reject()}),t},t._googleVisualizationLoadedPromise=$.Deferred(),t}(),t.Summary=u})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Employees||(Employees={}))