var Employees;(function(n){(function(t){var r,i,u,f;(function(n){n[n.unknown=0]="unknown",n[n.people=1]="people",n[n.activities=2]="activities",n[n.degress=3]="degress"})(t.DataGraphPivot||(t.DataGraphPivot={})),r=t.DataGraphPivot,i=function(){function n(){var n=this;this._state=ko.observable("up"),this.isUp=ko.computed(function(){return n._state()=="up"}),this.isHover=ko.computed(function(){return n._state()=="hover"})}return n.prototype.onMouseEnter=function(){this._state("hover")},n.prototype.onMouseLeave=function(){this._state("up")},n}(),t.ImageSwapper=i,u=function(){function n(n){this.loader=n,this._promise=$.Deferred()}return n.prototype.ready=function(){var n=this;return this._response||this.loader().done(function(t){n._response=t,n._promise.resolve(n._response)}).fail(function(){n._promise.reject()}),this._promise},n}(),t.DataCacher=u,f=function(){function t(n){var f=this;this.settings=n,this._bindingsApplied=$.Deferred(),this.bindingsApplied=this._bindingsApplied,this.areBindingsApplied=ko.observable(!1),this.pivot=ko.observable(parseInt(sessionStorage.getItem(t._pivotKey))||t._pivotDefault),this._pivotChanged=ko.computed(function(){f._onPivotChanged()}),this.isPivotPeople=ko.computed(function(){return f.pivot()==r.people}),this.isPivotActivities=ko.computed(function(){return f.pivot()==r.activities}),this.routeState=ko.computed(function(){return{pivot:f.pivot()}}),this._routeStateChanged=ko.computed(function(){f._onRouteStateChanged()}).extend({throttle:1}),this.activitiesPlaceData=new u(function(){return f._loadActivitiesPlaceData()}),this.peoplePlaceData=new u(function(){return f._loadPeoplePlaceData()}),this.geoChart=new App.Google.GeoChart(document.getElementById(this.settings.geoChartElementId)),this.geoChartSpinner=new App.Spinner(new App.SpinnerOptions(400,!0)),this.isGeoChartReady=ko.observable(!1),this.isD3Defined=ko.computed(function(){return t._isD3Defined()}),this.isD3Undefined=ko.computed(function(){return!t._isD3Defined()}),this._tooltips=ko.observableArray(),this.pacificOceanTotal=ko.observable(0),this.gulfOfMexicoTotal=ko.observable(0),this.caribbeanSeaTotal=ko.observable(0),this.atlanticOceanTotal=ko.observable(0),this.southernOceanTotal=ko.observable(0),this.arcticOceanTotal=ko.observable(0),this.indianOceanTotal=ko.observable(0),this.antarcticaTotal=ko.observable(0),this.pacificOceanSwapper=new i,this.gulfOfMexicoSwapper=new i,this.caribbeanSeaSwapper=new i,this.atlanticOceanSwapper=new i,this.southernOceanSwapper=new i,this.arcticOceanSwapper=new i,this.indianOceanSwapper=new i,this.antarcticaSwapper=new i,this.activitiesSummary={personCount:ko.observable("?"),activityCount:ko.observable("?"),locationCount:ko.observable("?")},this.activitiesSummaryData=new u(function(){return f._loadActivitiesSummary()}),HistoryJS.Adapter.bind(window,"statechange",function(){f._onRouteChanged()}),this.activitiesSummaryData.ready(),this._initGeoChart(),this.bindingsApplied.done(function(){f._applyState()})}return t.loadGoogleVisualization=function(){return google.load("visualization","1",{packages:["corechart","geochart"]}),google.setOnLoadCallback(function(){t._googleVisualizationLoadedPromise.resolve()}),t._googleVisualizationLoadedPromise},t.prototype.applyBindings=function(){var n=this.settings.element;n||(n=document.getElementById(this.settings.elementId)),ko.applyBindings(this,n),this.areBindingsApplied(!0),this._bindingsApplied.resolve()},t.prototype._onPivotChanged=function(){var n=this.pivot(),i=parseInt(sessionStorage.getItem(t._pivotKey))||0;n!==i&&sessionStorage.setItem(t._pivotKey,n.toString())},t.prototype.pivotPeople=function(){this.pivot(r.people)},t.prototype.pivotActivities=function(){this.pivot(r.activities)},t.prototype.isPivot=function(n){return this.pivot()==n},t.prototype._onRouteStateChanged=function(){var n=this.routeState(),t=HistoryJS.getState();t.data.pivot?HistoryJS.pushState(n,document.title,"?"+$.param(n)):HistoryJS.replaceState(n,document.title,"?"+$.param(n))},t.prototype._onRouteChanged=function(){var n=HistoryJS.getState(),t=n.data;this.pivot(t.pivot),this._applyState()},t.prototype._applyState=function(){this._drawGeoChart()},t.prototype._loadActivitiesPlaceData=function(){var r=this,i=$.Deferred(),u={countries:!0,placeIds:t._overlayPlaceIds};return this.geoChartSpinner.start(),n.Servers.ActivitiesPlaces(this.settings.tenantDomain,u).done(function(n){i.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load activity location summary data.",!0),i.reject()}).always(function(){r.geoChartSpinner.stop()}),i},t.prototype._loadPeoplePlaceData=function(){var r=this,i=$.Deferred(),u={countries:!0,placeIds:t._overlayPlaceIds};return this.geoChartSpinner.start(),n.Servers.PeoplePlaces(this.settings.tenantDomain,u).done(function(n){i.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load employee location summary data.",!0),i.reject()}).always(function(){r.geoChartSpinner.stop()}),i},t._geoChartOptions=function(n){return{displayMode:"regions",region:"world",keepAspectRatio:n.geoChartKeepAspectRatio?!0:!1,height:n.geoChartKeepAspectRatio?480:500,colorAxis:{minValue:1,colors:["#dceadc","#006400"]},backgroundColor:"#acccfd"}},t.prototype._newGeoChartDataTable=function(){var n=new google.visualization.DataTable;return n.addColumn("string","Place"),n.addColumn("number","Total {0}".format(this.isPivotPeople()?"People":"Activities")),n},t.prototype._initGeoChart=function(){var n=this,i=$.Deferred(),r,u;return this.isGeoChartReady()?i.resolve():(r=this._newGeoChartDataTable(),u=t._geoChartOptions(this.settings),this.geoChart.draw(r,u).then(function(){n.isGeoChartReady()||(n.isGeoChartReady(!0),n.bindingsApplied.done(function(){n._svgInjectWaterOverlays()})),i.resolve()})),i},t.prototype._drawGeoChart=function(){var n=this,r=t._geoChartOptions(this.settings),i=this._newGeoChartDataTable();this._initGeoChart().then(function(){n.isPivotPeople()?n.peoplePlaceData.ready().done(function(t){$.each(t,function(n,t){i.addRow([t.placeName,t.personIds.length])}),n.geoChart.draw(i,r).then(function(){n._applyPeopleOverlayTotals(t),n._createOverlayTooltips()})}):n.activitiesPlaceData.ready().done(function(t){$.each(t,function(n,t){i.addRow([t.placeName,t.activityIds.length])}),n.geoChart.draw(i,r).then(function(){n._applyActivitiesOverlayTotals(t),n._createOverlayTooltips()})})})},t._isD3Defined=function(){return typeof d3!="undefined"},t.prototype._svgInjectWaterOverlays=function(){var r=this,i;if(t._isD3Defined()&&this.settings.geoChartWaterOverlaysElementId&&!$("#{0}_root".format(this.settings.geoChartWaterOverlaysElementId)).length){var u=d3.select("#{0} svg > g".format(this.settings.geoChartElementId)),f=u.append("g").attr("id","{0}_root".format(this.settings.geoChartWaterOverlaysElementId)),n=$("#{0}".format(this.settings.geoChartWaterOverlaysElementId));n.show(),i=n.children(),$.each(i,function(n,t){r._svgInjectWaterOverlay(f,t)}),n.hide(),$("#google_geochart svg > g > g:last-child").insertAfter("#google_geochart svg > g > g:nth-child(2)")}},t.prototype._svgInjectWaterOverlay=function(n,t){var i=$(t),r=n.append("g").attr("class",i.attr("class"));return $.each($(t).children(),function(n,t){var u=$(t);if(u.prop("tagName").toUpperCase()==="IMG"){var o=i.position().left,s=i.position().top,h=u.css("width"),c=u.css("height"),l=u.attr("src"),f=u.css("display"),e=r.append("image").attr("xlink:href",l).attr("x",o).attr("y",s).attr("width",h).attr("height",c);f&&f.toLowerCase()=="none"?e.attr("class","hover").attr("style","display: none;"):e.attr("class","no-hover")}}),this._svgApplyWaterOverlayHover(r),r},t.prototype._svgApplyWaterOverlayHover=function(n){var t=$("#{0} .{1}".format(this.settings.geoChartOverlayPhantomsElementId,n.attr("class")));t.on("mouseenter",function(){n.select("image.hover").style("display",""),n.select("image.no-hover").style("display","none")});t.on("mouseleave",function(){n.select("image.no-hover").style("display",""),n.select("image.hover").style("display","none")})},t.prototype._createOverlayTooltips=function(){var n=this,r=this._tooltips(),i;r.length&&($.each(this._tooltips(),function(n,t){t.tooltip("destroy")}),this._tooltips([])),i=this.isD3Defined()?this.settings.geoChartOverlayPhantomsElementId:this.settings.geoChartWaterOverlaysElementId,$.each(t._waterOverlayClassNames,function(t,r){var u=$("#{0} .{1}".format(i,r)),f=$("#{0} .{1} .tooltip".format(n.settings.geoChartOverlayPhantomsElementId,r)),e=f.html()||"tooltip";n._createOverlayTooltip(u,e),n._tooltips.push(u)});var u=$("#{0}".format(this.settings.geoChartAntarcticaOverlayElementId)),f=$("#{0} .tooltip".format(this.settings.geoChartAntarcticaOverlayElementId)),e=f.html();this._createOverlayTooltip(u,e)},t.prototype._createOverlayTooltip=function(n,t){n.tooltip({content:t||"tooltip content goes here",items:"*",track:!0,show:!1,hide:!1,tooltipClass:"geochart",position:{my:"right-15 bottom-15",of:".ui-tooltip-content",within:"#{0}".format(this.settings.geoChartElementId)},create:function(){},open:function(n,t){var i=t.tooltip.find(".ui-tooltip-content").outerWidth();t.tooltip.css({width:"{0}px".format(i)})}})},t.prototype._applyActivitiesOverlayTotals=function(n){this.pacificOceanTotal(this._getActivitiesOverlayTotal(n,0)),this.gulfOfMexicoTotal(this._getActivitiesOverlayTotal(n,1)),this.caribbeanSeaTotal(this._getActivitiesOverlayTotal(n,2)),this.atlanticOceanTotal(this._getActivitiesOverlayTotal(n,3)),this.southernOceanTotal(this._getActivitiesOverlayTotal(n,4)),this.arcticOceanTotal(this._getActivitiesOverlayTotal(n,5)),this.indianOceanTotal(this._getActivitiesOverlayTotal(n,6)),this.antarcticaTotal(this._getActivitiesOverlayTotal(n,7))},t.prototype._getActivitiesOverlayTotal=function(n,i){var r=Enumerable.From(n).Where(function(n){return n.placeId==t._overlayPlaceIds[i]}).Sum(function(n){return n.activityIds.length});return r||0},t.prototype._applyPeopleOverlayTotals=function(n){this.pacificOceanTotal(this._getPeopleOverlayTotal(n,0)),this.gulfOfMexicoTotal(this._getPeopleOverlayTotal(n,1)),this.caribbeanSeaTotal(this._getPeopleOverlayTotal(n,2)),this.atlanticOceanTotal(this._getPeopleOverlayTotal(n,3)),this.southernOceanTotal(this._getPeopleOverlayTotal(n,4)),this.arcticOceanTotal(this._getPeopleOverlayTotal(n,5)),this.indianOceanTotal(this._getPeopleOverlayTotal(n,6)),this.antarcticaTotal(this._getPeopleOverlayTotal(n,7))},t.prototype._getPeopleOverlayTotal=function(n,i){var r=Enumerable.From(n).Where(function(n){return n.placeId==t._overlayPlaceIds[i]}).Sum(function(n){return n.personIds.length});return r||0},t.prototype._loadActivitiesSummary=function(){var i=this,t=$.Deferred();return n.Servers.ActivitiesSummary(this.settings.tenantDomain).done(function(n){ko.mapping.fromJS(n,{},i.activitiesSummary),t.resolve(n)}).fail(function(n){App.Failures.message(n,"while trying to load activity total summary data.",!0),t.reject()}),t},t._googleVisualizationLoadedPromise=$.Deferred(),t._pivotDefault=r.activities,t._pivotKey="EmployeeSummaryPivot",t._waterOverlayClassNames=["pacific-ocean","gulf-of-mexico","caribbean-sea","atlantic-ocean","southern-ocean","arctic-ocean","indian-ocean"],t._overlayPlaceNames=["Pacific Ocean","Gulf of Mexico","Caribbean Sea","Atlantic Ocean","Southern Ocean","Arctic Ocean","Indian Ocean","Antarctica"],t._overlayPlaceIds=[7872,7859,7845,8296,7833,7837,7863,17],t}(),t.Summary=f})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Employees||(Employees={}))