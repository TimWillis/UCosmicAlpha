var ViewModels;(function(n){(function(t){var i=function(){function t(n){this.inititializationErrors="",this._initialize(n)}return t.prototype._initialize=function(t){if(this.sammy=Sammy(),this.initialLocations=[],this.selectedLocationValues=[],this.fromDate=ko.observable(),this.toDate=ko.observable(),this.institutionId=ko.observable(null),this.institutionOfficialName=ko.observable(null),this.institutionCountryOfficialName=ko.observable(null),this.institutionHasCampuses=ko.observable(!1),this.activityTypes=ko.observableArray(),this.selectedActivityIds=ko.observableArray(),this.isHeatmapVisible=ko.observable(!0),this.isPointmapVisible=ko.observable(!1),this.isTableVisible=ko.observable(!1),this.searchType=ko.observable("activities"),this.selectedCountry=ko.observable(null),this.isGlobalView=ko.observable(!0),this.loadSpinner=new n.Spinner(new n.SpinnerOptions(200)),this.barchartWorldDataTable_cached=null,this.selectSearchType("activities"),t!=null){if(t.InstitutionId!=null&&this.institutionId(Number(t.InstitutionId)),t.ActivityTypes!=null)for(var i=0;i<t.ActivityTypes.length;i+=1)this.activityTypes.push(ko.observable({id:t.ActivityTypes[i].Id,type:t.ActivityTypes[i].Name,filter:ko.observable(!0)}));t.InstitutionHasCampuses!=null&&this.institutionHasCampuses(Boolean(t.InstitutionHasCampuses))}},t.prototype.setupWidgets=function(n,t,i,r,u,f,e){var o=this,s,h;this.locationSelectorId=n,s=this,$("#"+n).kendoMultiSelect({autoBind:!0,dataTextField:"officialName",dataValueField:"id",minLength:3,dataSource:s.initialLocations,value:s.selectedLocationValues,change:function(n){o.updateLocations(n.sender.dataItems())},placeholder:"[Select Country/Location]"}),$("#"+t).kendoDatePicker({open:function(){this.options.format="MM/dd/yyyy"}}),$("#"+i).kendoDatePicker({open:function(){this.options.format="MM/dd/yyyy"}}),this.institutionSelectorId=r,$("#"+r).kendoAutoComplete({minLength:3,filter:"contains",ignoreCase:!0,placeholder:"[Enter Institution]",dataTextField:"officialName",dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){$.ajax({url:App.Routes.WebApi.Establishments.getUniversities(),dataType:"json",success:function(t){n.success(t.items)}})}}}),change:function(){o.checkInstitutionForNull()},select:function(n){var i=$("#"+r).data("kendoAutoComplete"),t=i.dataItem(n.item.index());o.institutionOfficialName(t.officialName),o.institutionId(t.id),t.countryName!=null&&t.countryName.length>0?o.institutionCountryOfficialName(t.countryName):o.institutionCountryOfficialName(null)}}),$("#"+e).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"ALL",id:0},change:function(){},dataBound:function(){if(this.selectedIndex!=null&&this.selectedIndex!=-1){var n=this.dataItem(this.selectedIndex);n==null?(this.text(""),$("#departmenDiv").hide()):$("#departmenDiv").show()}else $("#departmenDiv").hide()}}),h=null,this.institutionHasCampuses()||(h=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(this.institutionId(),!0)}}})),$("#"+f).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"ALL",id:0},dataSource:h,change:function(n){var i=n.sender.selectedIndex,t,r;i!=-1&&(t=this.dataItem(i),t!=null&&t.id!=0&&(r=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t.id,!0)}}}),$("#"+e).data("kendoDropDownList").setDataSource(r)))},dataBound:function(){var n,t,i;this.selectedIndex!=null&&this.selectedIndex!=-1&&(n=this.dataItem(this.selectedIndex),n!=null&&n.id!=0&&(t=n.id,t!=null&&(i=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t,!0)}}}),$("#"+e).data("kendoDropDownList").setDataSource(i))))}}),this.institutionHasCampuses()&&$("#"+u).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"ALL",id:0},dataSource:new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(this.institutionId(),!0)}}}),change:function(n){var i=n.sender.selectedIndex,t,r;i!=null&&i!=-1&&(t=this.dataItem(i),t!=null&&t.id!=0&&(r=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t.id,!0)}}}),$("#"+f).data("kendoDropDownList").setDataSource(r)))},dataBound:function(){var n,t,i;this.selectedIndex!=null&&this.selectedIndex!=-1&&(n=this.dataItem(this.selectedIndex),n!=null&&n.id!=0?(t=n.id,t!=null&&(i=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t,!0)}}}),$("#"+f).data("kendoDropDownList").setDataSource(i))):$("#"+f).data("kendoDropDownList").setDataSource(null))}})},t.prototype.setupValidation=function(){},t.prototype.setupSubscriptions=function(){},t.prototype.setupRouting=function(){var n=this;this.sammy.get("#/summary",function(){n.selectMap("heatmap")}),this.sammy.get("#/search",function(){n.selectMap("pointmap")}),this.sammy.get("#/results",function(){n.selectMap("resultstable")}),this.sammy.run("#/summary")},t.prototype.setupMaps=function(){var e=this,t,f,r,u,n,i;if(this.google=window.google,this.google.maps.visualRefresh=!0,this.pointmap=new this.google.maps.Map($("#pointmap")[0],{width:680,height:500,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(0,0),zoom:1,draggable:!0,scrollwheel:!1}),t=new this.google.visualization.DataTable,f=[],t.addColumn("string","Country"),t.addColumn("number","Total Activities"),this.summary!=null&&this.summary.countryActivityCounts()!=null&&this.summary.countryActivityCounts().length>0)for(r=this.summary.countryActivityCounts,n=0;n<r().length;n+=1)i=[],i.push(r()[n].officialName()),i.push(r()[n].count()),t.addRow(i);if(this.heatmapActivityData=t,t=new this.google.visualization.DataTable,f=[],t.addColumn("string","Country"),t.addColumn("number","Total People"),this.summary!=null&&this.summary.countryPeopleCounts()!=null&&this.summary.countryPeopleCounts().length>0)for(u=this.summary.countryPeopleCounts,n=0;n<u().length;n+=1)i=[],i.push(u()[n].officialName()),i.push(u()[n].count()),t.addRow(i);this.heatmapPeopleData=t,this.heatmapOptions={width:680,height:500,region:"world",backgroundColor:"lightBlue",keepAspectRatio:!1,colorAxis:{colors:["#FFFFFF","green"]}},this.heatmap=new this.google.visualization.GeoChart($("#heatmap")[0]),this.google.visualization.events.addListener(this.heatmap,"select",function(){e.heatmapSelectHandler()}),this.barchartActivityOptions={title:"Activities",vAxis:{title:"Count",titleTextStyle:{color:"red"}}},this.barchartPeopleOptions={title:"People",vAxis:{title:"Count",titleTextStyle:{color:"red"}}},this.barchart=new this.google.visualization.BarChart($("#facultystaff-summary-barchart")[0])},t.prototype.getActivityDataTable=function(n){var i,t,e,f,r,u;if(i=new this.google.visualization.DataTable,i.addColumn("string","Activity"),i.addColumn("number","Count"),n==null)for(t=0;t<this.summary.worldActivityCounts().length;t+=1)r=this.summary.worldActivityCounts()[t].type(),u=this.summary.worldActivityCounts()[t].count(),i.addRow([r,u]);else{for(t=0;t<this.summary.countryActivityCounts().length&&this.summary.countryActivityCounts()[t].officialName!==n;)t+=1;if(t<this.summary.countryActivityCounts().length)for(e=this.summary.countryActivityCounts()[t],f=0;f<e.typeCounts().length;f+=1)r=e.typeCounts[f].type(),u=e.typeCounts[f].count(),i.addRow([r,u])}return i},t.prototype.getPeopleDataTable=function(n){var i,t,e,f,r,u;if(i=new this.google.visualization.DataTable,i.addColumn("string","People"),i.addColumn("number","Count"),n==null)for(t=0;t<this.summary.worldPeopleCounts().length;t+=1)r=this.summary.worldPeopleCounts()[t].type(),u=this.summary.worldPeopleCounts()[t].count(),i.addRow([r,u]);else{for(t=0;t<this.summary.countryPeopleCounts().length&&this.summary.countryPeopleCounts()[t].officialName!==n;)t+=1;if(t<this.summary.countryPeopleCounts().length)for(e=this.summary.countryPeopleCounts()[t],f=0;f<e.typeCounts().length;f+=1)r=e.typeCounts[f].type(),u=e.typeCounts[f].count(),i.addRow([r,u])}return i},t.prototype.load=function(){var n=this,u=this,r=$.Deferred(),t,i;return this.loadSpinner.start(),t=$.Deferred(),$.get(App.Routes.WebApi.Employees.ModuleSettings.ActivityTypes.get()).done(function(n){t.resolve(n)}).fail(function(n,i,r){t.reject(n,i,r)}),i=$.Deferred(),$.ajax({type:"GET",url:App.Routes.WebApi.FacultyStaff.getSummary(),success:function(n){i.resolve(n)},error:function(n,t,r){i.reject(n,t,r)}}),$.when(t,i).done(function(t,i){n.activityTypes=ko.mapping.fromJS(t);for(var u=0;u<n.activityTypes().length;u+=1)n.activityTypes()[u].checked=ko.computed(n.defHasActivityTypeCallback(u));n.summary=ko.mapping.fromJS(i),r.resolve()}).fail(function(n,t,i){r.reject(n,t,i)}),r},t.prototype.checkInstitutionForNull=function(){var t=$("#"+this.institutionSelectorId).data("kendoAutoComplete"),n=t.value()!=null?t.value().toString():null;n!=null&&(n=$.trim(n)),(n==null||n.length==0)&&(t.value(null),this.institutionOfficialName(null),this.institutionId(null))},t.prototype.updateLocations=function(n){var t,i;if(this.locations!=null)for(this.locations.removeAll(),t=0;t<n.length;t+=1)i=ko.mapping.fromJS({id:0,placeId:n[t].id,version:""}),this.locations.push(i)},t.prototype.selectMap=function(n){var t;$("#heatmapText").css("font-weight","normal"),this.isHeatmapVisible(!1),$("#pointmapText").css("font-weight","normal"),this.isPointmapVisible(!1),$("#resultstableText").css("font-weight","normal"),this.isTableVisible(!1),$("#bib-faculty-staff-summary").removeClass("current"),$("#bib-faculty-staff-search").removeClass("current"),n==="heatmap"?($("#heatmapText").css("font-weight","bold"),this.isHeatmapVisible(!0),this.searchType()==="activities"?(this.heatmap.draw(this.heatmapActivityData,this.heatmapOptions),t=this.getActivityDataTable(this.selectedCountry()),this.barchart.draw(t,this.barchartActivityOptions)):(this.heatmap.draw(this.heatmapPeopleData,this.heatmapOptions),t=this.getPeopleDataTable(this.selectedCountry()),this.barchart.draw(t,this.barchartPeopleOptions)),$("#bib-faculty-staff-summary").addClass("current")):n==="pointmap"?($("#pointmapText").css("font-weight","bold"),this.isPointmapVisible(!0),$("#pointmap").css("display","inline-block"),this.google.maps.event.trigger(this.pointmap,"resize"),$("#bib-faculty-staff-search").addClass("current")):n==="resultstable"&&($("#resultstableText").css("font-weight","bold"),this.isTableVisible(!0))},t.prototype.selectSearchType=function(n){n==="activities"?this.setActivitiesSearch():this.setPeopleSearch(),this.heatmap!=null&&this.selectMap("heatmap")},t.prototype.setActivitiesSearch=function(){$("#activitiesButton").css("font-weight","bold"),$("#peopleButton").css("font-weight","normal"),this.searchType("activities")},t.prototype.setPeopleSearch=function(){$("#activitiesButton").css("font-weight","normal"),$("#peopleButton").css("font-weight","bold"),this.searchType("people")},t.prototype.addActivityType=function(n){var i=this.getActivityTypeIndexById(n),t;i==-1&&(t=ko.mapping.fromJS({id:0,typeId:n,version:""}),this.selectedActivityIds.push(t))},t.prototype.removeActivityType=function(n){var t=this.getActivityTypeIndexById(n),i;t!=-1&&(i=this.selectedActivityIds()[t],this.selectedActivityIds.remove(i))},t.prototype.getTypeName=function(n){var t="",i=this.getActivityTypeIndexById(n);return i!=-1&&(t=this.activityTypes[i].type),t},t.prototype.getActivityTypeIndexById=function(n){var i=-1,t;if(this.selectedActivityIds!=null&&this.selectedActivityIds().length>0){for(t=0;t<this.selectedActivityIds().length&&n!=this.selectedActivityIds()[t].typeId();)t+=1;t<this.selectedActivityIds().length&&(i=t)}return i},t.prototype.hasActivityType=function(n){return this.getActivityTypeIndexById(n)!=-1},t.prototype.defHasActivityTypeCallback=function(n){var t=this;return{read:function(){return t.hasActivityType(t.activityTypes()[n].id())},write:function(i){i?t.addActivityType(t.activityTypes()[n].id()):t.removeActivityType(t.activityTypes()[n].id())},owner:this}},t.prototype.heatmapSelectHandler=function(){var t=this.heatmap.getSelection(),n;n=this.searchType()==="activities"?this.heatmapActivityData.getFormattedValue(t[0].row,0):this.heatmapPeopleData.getFormattedValue(t[0].row,0),this.selectedCountry(n)},t.prototype.globalViewClickHandler=function(){this.selectedCountry(null),this.selectMap("heatmap")},t}();t.FacultyAndStaff=i})(n.Employees||(n.Employees={}));var t=n.Employees})(ViewModels||(ViewModels={}))