var ViewModels;(function(n){(function(n){var t=function(){function n(n){this.inititializationErrors="",this.geochartCustomPlaces=[{name:"Antarctica",id:"antarctica",activityCount:0,peopleCount:0},{name:"Southern Ocean",id:"southernOcean",activityCount:0,peopleCount:0},{name:"Indian Ocean",id:"indianOcean",activityCount:0,peopleCount:0},{name:"Pacific Ocean",id:"pacificOcean",activityCount:0,peopleCount:0},{name:"Atlantic Ocean",id:"atlanticOcean",activityCount:0,peopleCount:0},{name:"Gulf of Mexico",id:"gulfOfMexico",activityCount:0,peopleCount:0},{name:"Carribean",id:"carribean",activityCount:0,peopleCount:0}],this._initialize(n)}return n.prototype._initialize=function(n){if(this.sammy=Sammy(),this.initialLocations=[],this.selectedLocationValues=[],this.fromDate=ko.observable(),this.toDate=ko.observable(),this.establishmentId=ko.observable(null),this.establishmentOfficialName=ko.observable(null),this.establishmentCountryOfficialName=ko.observable(null),this.institutionHasCampuses=ko.observable(!1),this.activityTypes=ko.observableArray(),this.selectedActivityIds=ko.observableArray(),this.isHeatmapVisible=ko.observable(!0),this.isPointmapVisible=ko.observable(!1),this.isTableVisible=ko.observable(!1),this.searchType=ko.observable("activities"),this.selectedPlace=ko.observable(null),this.isGlobalView=ko.observable(!0),this.loadSpinner=new App.Spinner(new App.SpinnerOptions(200)),this.globalActivityCountData=null,this.placeActivityCountData=null,this.globalPeopleCountData=null,this.placePeopleCountData=null,this.globalActivityTrendData=null,this.placeActivityTrendData=null,this.globalPeopleTrendData=null,this.placePeopleTrendData=null,this.heatmapActivityDataTable=null,this.heatmapPeopleDataTable=null,this.totalCount=ko.observable(0),this.totalPlaceCount=ko.observable(0),this.selectSearchType("activities"),n!=null){if(n.InstitutionId!=null&&this.establishmentId(Number(n.InstitutionId)),n.ActivityTypes!=null)for(var t=0;t<n.ActivityTypes.length;t+=1)this.activityTypes.push(ko.observable({id:n.ActivityTypes[t].Id,type:n.ActivityTypes[t].Name,filter:ko.observable(!0)}));n.InstitutionHasCampuses!=null&&this.institutionHasCampuses(Boolean(n.InstitutionHasCampuses))}},n.prototype.setupWidgets=function(n,t,i,r,u,f,e){var h=this,o,s;this.locationSelectorId=n,o=this,$("#"+n).kendoMultiSelect({autoBind:!0,dataTextField:"officialName",dataValueField:"id",minLength:3,dataSource:o.initialLocations,value:o.selectedLocationValues,change:function(n){h.updateLocations(n.sender.dataItems())},placeholder:"[Select Country/Location]"}),$("#"+t).kendoDatePicker({open:function(){this.options.format="MM/dd/yyyy"}}),$("#"+i).kendoDatePicker({open:function(){this.options.format="MM/dd/yyyy"}}),this.establishmentDropListId=r,$("#"+r).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",dataSource:[{officialName:"USF System",id:0},{officialName:"USF Tampa",id:0},{officialName:"USF St. Petersburg",id:0},{officialName:"USF Sarasota-Manatee",id:0}],change:function(){}}),$("#"+e).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"ALL",id:0},change:function(){},dataBound:function(){if(this.selectedIndex!=null&&this.selectedIndex!=-1){var n=this.dataItem(this.selectedIndex);n==null?(this.text(""),$("#departmenDiv").hide()):$("#departmenDiv").show()}else $("#departmenDiv").hide()}}),s=null,this.institutionHasCampuses()||(s=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(this.establishmentId()),data:{orderBy:["rank-asc","name-asc"]}}}})),$("#"+f).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"ALL",id:0},dataSource:s,change:function(n){var i=n.sender.selectedIndex,t,r;i!=-1&&(t=this.dataItem(i),t!=null&&t.id!=0&&(r=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t.id),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+e).data("kendoDropDownList").setDataSource(r)))},dataBound:function(){var n,t,i;this.selectedIndex!=null&&this.selectedIndex!=-1&&(n=this.dataItem(this.selectedIndex),n!=null&&n.id!=0&&(t=n.id,t!=null&&(i=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+e).data("kendoDropDownList").setDataSource(i))))}}),this.institutionHasCampuses()&&$("#"+u).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"ALL",id:0},dataSource:new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(this.establishmentId()),data:{orderBy:["rank-asc","name-asc"]}}}}),change:function(n){var i=n.sender.selectedIndex,t,r;i!=null&&i!=-1&&(t=this.dataItem(i),t!=null&&t.id!=0&&(r=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t.id),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+f).data("kendoDropDownList").setDataSource(r)))},dataBound:function(){var n,t,i;this.selectedIndex!=null&&this.selectedIndex!=-1&&(n=this.dataItem(this.selectedIndex),n!=null&&n.id!=0?(t=n.id,t!=null&&(i=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+f).data("kendoDropDownList").setDataSource(i))):$("#"+f).data("kendoDropDownList").setDataSource(null))}})},n.prototype.setupValidation=function(){},n.prototype.setupSubscriptions=function(){var n=this;this.selectedPlace.subscribe(function(){n.selectMap("heatmap")})},n.prototype.setupRouting=function(){var n=this;this.sammy.get("#/summary",function(){n.selectMap("heatmap")}),this.sammy.get("#/search",function(){n.selectMap("pointmap")}),this.sammy.get("#/results",function(){n.selectMap("resultstable")}),this.sammy.run("#/summary")},n.prototype.setupMaps=function(){var n=this;this.google=window.google,this.google.maps.visualRefresh=!0,this.pointmap=new this.google.maps.Map($("#pointmap")[0],{width:680,height:500,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(0,0),zoom:1,draggable:!0,scrollwheel:!1}),this.heatmapOptions={width:680,height:500,region:"world",keepAspectRatio:!1,colorAxis:{colors:["#FFFFFF","green"]},backgroundColor:{fill:"transparent"}},this.heatmap=new this.google.visualization.GeoChart($("#heatmap")[0]),this.google.visualization.events.addListener(this.heatmap,"select",function(){n.heatmapSelectHandler()}),this.activityTypes()!=null&&(this.barchartActivityOptions={title:"Global Activities",titleTextStyle:{color:"black",fontSize:14,bold:!0},hAxis:{textPosition:"none"},vAxis:{textPosition:"none"},chartArea:{left:10,width:"100%",height:"75%"},legend:{position:"none"},isStacked:!0,series:[{type:"bars",color:"green"},{type:"line",color:"black",lineWidth:0,pointSize:0,visibleInLegend:!1}]}),this.barchartPeopleOptions={title:"Global People",titleTextStyle:{color:"black",fontSize:14,bold:!0},hAxis:{textPosition:"none"},vAxis:{textPosition:"none"},chartArea:{left:10,width:"100%",height:"75%"},legend:{position:"none"},isStacked:!0,series:[{type:"bars",color:"green"},{type:"line",color:"black",lineWidth:0,pointSize:0,visibleInLegend:!1}]},this.barchart=new this.google.visualization.ColumnChart($("#facultystaff-summary-barchart")[0]),this.linechartActivityOptions={chartArea:{left:40,width:"85%",height:"60%"},title:"Global Activity Trend",titleTextStyle:{color:"black",fontSize:14,bold:!0},colors:["green"],legend:{position:"none"}},this.linechartPeopleOptions={chartArea:{left:40,width:"85%",height:"60%"},title:"Global People Trend",titleTextStyle:{color:"black",fontSize:14,bold:!0},colors:["green"],legend:{position:"none"}},this.linechart=new this.google.visualization.LineChart($("#facultystaff-summary-linechart")[0])},n.prototype.getHeatmapActivityDataTable=function(){var i,f,n,t,u,r;if(this.globalActivityCountData==null&&this.getActivityDataTable(null),this.heatmapActivityDataTable==null){if(i=new this.google.visualization.DataTable,f=[],i.addColumn("string","Country"),i.addColumn("number","Total Activities"),n=this.globalActivityCountData.placeCounts,n!=null&&n.length>0)for(t=0;t<n.length;t+=1)for(u=[],u.push(n[t].officialName),u.push(n[t].count),i.addRow(u),r=0;r<this.geochartCustomPlaces.length;r+=1)n[t].officialName===this.geochartCustomPlaces[r].name&&(this.geochartCustomPlaces[r].activityCount=n[t].count);this.heatmapActivityDataTable=i}return this.heatmapActivityDataTable},n.prototype.getHeatmapPeopleDataTable=function(){var i,f,n,t,u,r;if(this.globalPeopleCountData==null&&this.getPeopleDataTable(null),this.heatmapPeopleDataTable==null){if(i=new this.google.visualization.DataTable,f=[],i.addColumn("string","Country"),i.addColumn("number","Total Activities"),n=this.globalPeopleCountData.placeCounts,n!=null&&n.length>0)for(t=0;t<n.length;t+=1)for(u=[],u.push(n[t].officialName),u.push(n[t].count),i.addRow(u),r=0;r<this.geochartCustomPlaces.length;r+=1)n[t].officialName===this.geochartCustomPlaces[r].name&&(this.geochartCustomPlaces[r].peopleCount=n[t].count);this.heatmapPeopleDataTable=i}return this.heatmapPeopleDataTable},n.prototype.getActivityDataTable=function(n){var o=this,f,i,t,u,r,e;if(n==null?this.globalActivityCountData==null&&$.ajax({type:"GET",async:!1,data:{placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityCount(),success:function(n){o.globalActivityCountData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}}):(f=this.getPlaceId(n),f!=null&&(this.placeActivityCountData==null||this.placeActivityCountData.placeId!=f)&&$.ajax({type:"GET",async:!1,data:{placeId:f},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityCount(),success:function(n){o.placeActivityCountData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}})),i=new this.google.visualization.DataTable,i.addColumn("string","Activity"),i.addColumn("number","Count"),i.addColumn({type:"number",role:"annotation"}),n==null)for(t=0;t<this.globalActivityCountData.typeCounts.length;t+=1)u=this.globalActivityCountData.typeCounts[t].type,r=this.globalActivityCountData.typeCounts[t].count,i.addRow([u,r,r]);else for(t=0;t<this.placeActivityCountData.typeCounts.length;t+=1)u=this.placeActivityCountData.typeCounts[t].type,r=this.placeActivityCountData.typeCounts[t].count,i.addRow([u,r,r]);return e=new this.google.visualization.DataView(i),e.setColumns([0,1,1,2]),e},n.prototype.getPeopleDataTable=function(n){var h=this,e,t,r,o,f,u,i,s;if(n==null?this.globalPeopleCountData==null&&$.ajax({type:"GET",async:!1,data:{placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleCount(),success:function(n){h.globalPeopleCountData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}}):(e=this.getPlaceId(n),e!=null&&(this.placePeopleCountData==null||this.placeActivityCountData.placeId!=e)&&$.ajax({type:"GET",async:!1,data:{placeId:e},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleCount(),success:function(n){h.placePeopleCountData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}})),t=new this.google.visualization.DataTable,t.addColumn("string","Activity"),t.addColumn("number","Count"),t.addColumn({type:"number",role:"annotation"}),n==null)for(r=0;r<this.globalPeopleCountData.typeCounts.length;r+=1)u=this.globalPeopleCountData.typeCounts[r].type,i=this.globalPeopleCountData.typeCounts[r].count,t.addRow([u,i,i]);else for(o=this.globalPeopleCountData.placeCounts[0],f=0;f<o.typeCounts.length;f+=1)u=o.typeCounts[f].type,i=o.typeCounts[f].count,t.addRow([u,i,i]);return s=new this.google.visualization.DataView(t),s.setColumns([0,1,1,2]),s},n.prototype.getActivityTrendDataTable=function(n){var e=this,f,i,t,r,u;if(n==null?this.globalActivityTrendData==null&&$.ajax({type:"GET",async:!1,data:{placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityTrend(),success:function(n){e.globalActivityTrendData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}}):(f=this.getPlaceId(n),f!=null&&(this.placeActivityTrendData==null||this.placeActivityTrendData.placeId!=f)&&$.ajax({type:"GET",async:!1,data:{placeId:f},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityTrend(),success:function(n){e.placeActivityTrendData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}})),i=new this.google.visualization.DataTable,i.addColumn("string","Year"),i.addColumn("number","Count"),n==null)for(t=0;t<this.globalActivityTrendData.trendCounts.length;t+=1)r=this.globalActivityTrendData.trendCounts[t].year.toString(),u=this.globalActivityTrendData.trendCounts[t].count,i.addRow([r,u]);else for(t=0;t<this.placeActivityTrendData.trendCounts.length;t+=1)r=this.placeActivityTrendData.trendCounts[t].year.toString(),u=this.placeActivityTrendData.trendCounts[t].count,i.addRow([r,u]);return i},n.prototype.getPeopleTrendDataTable=function(n){var e=this,f,i,t,r,u;if(n==null?this.globalPeopleTrendData==null&&$.ajax({type:"GET",async:!1,data:{placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleTrend(),success:function(n){e.globalPeopleTrendData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}}):(f=this.getPlaceId(n),f!=null&&(this.placePeopleTrendData==null||this.placePeopleTrendData.placeId!=f)&&$.ajax({type:"GET",async:!1,data:{placeId:f},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleTrend(),success:function(n){e.placePeopleTrendData=n},error:function(n,t,i){alert("Error getting data "+t+" | "+i)}})),i=new this.google.visualization.DataTable,i.addColumn("string","Year"),i.addColumn("number","Count"),n==null)for(t=0;t<this.globalPeopleTrendData.trendCounts.length;t+=1)r=this.globalPeopleTrendData.trendCounts[t].year.toString(),u=this.globalPeopleTrendData.trendCounts[t].count,i.addRow([r,u]);else for(t=0;t<this.placePeopleTrendData.trendCounts.length;t+=1)r=this.placePeopleTrendData.trendCounts[t].year.toString(),u=this.placePeopleTrendData.trendCounts[t].count,i.addRow([r,u]);return i},n.prototype.makeActivityTooltip=function(n,t){return"<b>"+n+"<\/b><br/>Total Activities: "+t.toString()},n.prototype.makePeopleTooltip=function(n,t){return"<b>"+n+"<\/b><br/>Total People: "+t.toString()},n.prototype.updateCustomGeochartPlaceTooltips=function(n){for(var i="",r="",u=0,t=0;t<this.geochartCustomPlaces.length;t+=1)n==="activities"?(i=this.geochartCustomPlaces[t].id,r=this.geochartCustomPlaces[t].name,u=this.geochartCustomPlaces[t].activityCount,$("#"+i).tooltip({position:{my:"bottom+10 right+10"},track:!0,tooltipClass:"geochartTooltip",items:"#"+i,content:this.makeActivityTooltip(r,u)})):(i=this.geochartCustomPlaces[t].id,r=this.geochartCustomPlaces[t].name,u=this.geochartCustomPlaces[t].activityCount,$("#"+i).tooltip({position:{my:"bottom+10 right+10"},track:!0,tooltipClass:"geochartTooltip",items:"#"+i,content:this.makePeopleTooltip(r,u)}))},n.prototype.load=function(){var n=this,u=this,r=$.Deferred(),t,i;return this.loadSpinner.start(),t=$.Deferred(),$.get(App.Routes.WebApi.Employees.ModuleSettings.ActivityTypes.get()).done(function(n){t.resolve(n)}).fail(function(n,i,r){t.reject(n,i,r)}),i=$.Deferred(),$.ajax({type:"GET",data:{isCountry:!0},dataType:"json",url:App.Routes.WebApi.Places.get(),success:function(n){i.resolve(n)},error:function(n,t,r){i.reject(n,t,r)}}),$.when(t,i).done(function(t,i){n.activityTypes=ko.mapping.fromJS(t);for(var u=0;u<n.activityTypes().length;u+=1)n.activityTypes()[u].checked=ko.computed(n.defHasActivityTypeCallback(u));n.places=i,r.resolve()}).fail(function(n,t,i){r.reject(n,t,i)}),r},n.prototype.checkInstitutionForNull=function(){var t=$("#"+this.establishmentDropListId).data("kendoAutoComplete"),n=t.value()!=null?t.value().toString():null;n!=null&&(n=$.trim(n)),(n==null||n.length==0)&&(t.value(null),this.establishmentOfficialName(null),this.establishmentId(null))},n.prototype.updateLocations=function(n){var t,i;if(this.locations!=null)for(this.locations.removeAll(),t=0;t<n.length;t+=1)i=ko.mapping.fromJS({id:0,placeId:n[t].id,version:""}),this.locations.push(i)},n.prototype.selectMap=function(n){if($("#heatmapText").css("font-weight","normal"),this.isHeatmapVisible(!1),$("#pointmapText").css("font-weight","normal"),this.isPointmapVisible(!1),$("#resultstableText").css("font-weight","normal"),this.isTableVisible(!1),$("#bib-faculty-staff-summary").removeClass("current"),$("#bib-faculty-staff-search").removeClass("current"),n==="heatmap"){$("#heatmapText").css("font-weight","bold"),this.isHeatmapVisible(!0);var t=null;this.searchType()==="activities"?(t=this.getHeatmapActivityDataTable(),this.heatmap.draw(t,this.heatmapOptions),t=this.getActivityDataTable(this.selectedPlace()),this.barchart.draw(t,this.barchartActivityOptions),t=this.getActivityTrendDataTable(this.selectedPlace()),this.linechart.draw(t,this.linechartActivityOptions),this.selectedPlace()==null?(this.totalCount(this.globalActivityCountData.count),this.totalPlaceCount(this.globalActivityCountData.countOfPlaces)):(this.totalCount(this.placeActivityCountData.count),this.totalPlaceCount(this.placeActivityCountData.countOfPlaces))):(t=this.getHeatmapPeopleDataTable(),this.heatmap.draw(t,this.heatmapOptions),t=this.getPeopleDataTable(this.selectedPlace()),this.barchart.draw(t,this.barchartPeopleOptions),t=this.getPeopleTrendDataTable(this.selectedPlace()),this.linechart.draw(t,this.linechartPeopleOptions),this.selectedPlace()==null?(this.totalCount(this.globalPeopleCountData.count),this.totalPlaceCount(this.globalPeopleCountData.countOfPlaces)):(this.totalCount(this.placePeopleCountData.count),this.totalPlaceCount(this.placePeopleCountData.countOfPlaces))),this.updateCustomGeochartPlaceTooltips(this.searchType()),$("#bib-faculty-staff-summary").addClass("current")}else n==="pointmap"?($("#pointmapText").css("font-weight","bold"),this.isPointmapVisible(!0),$("#pointmap").css("display","inline-block"),this.google.maps.event.trigger(this.pointmap,"resize"),$("#bib-faculty-staff-search").addClass("current")):n==="resultstable"&&($("#resultstableText").css("font-weight","bold"),this.isTableVisible(!0))},n.prototype.selectSearchType=function(n){n==="activities"?this.setActivitiesSearch():this.setPeopleSearch(),this.heatmap!=null&&this.selectMap("heatmap")},n.prototype.setActivitiesSearch=function(){$("#activitiesButton").css("font-weight","bold"),$("#peopleButton").css("font-weight","normal"),this.searchType("activities")},n.prototype.setPeopleSearch=function(){$("#activitiesButton").css("font-weight","normal"),$("#peopleButton").css("font-weight","bold"),this.searchType("people")},n.prototype.addActivityType=function(n){var i=this.getActivityTypeIndexById(n),t;i==-1&&(t=ko.mapping.fromJS({id:0,typeId:n,version:""}),this.selectedActivityIds.push(t))},n.prototype.removeActivityType=function(n){var t=this.getActivityTypeIndexById(n),i;t!=-1&&(i=this.selectedActivityIds()[t],this.selectedActivityIds.remove(i))},n.prototype.getTypeName=function(n){var t="",i=this.getActivityTypeIndexById(n);return i!=-1&&(t=this.activityTypes[i].type),t},n.prototype.getActivityTypeIndexById=function(n){var i=-1,t;if(this.selectedActivityIds!=null&&this.selectedActivityIds().length>0){for(t=0;t<this.selectedActivityIds().length&&n!=this.selectedActivityIds()[t].typeId();)t+=1;t<this.selectedActivityIds().length&&(i=t)}return i},n.prototype.hasActivityType=function(n){return this.getActivityTypeIndexById(n)!=-1},n.prototype.defHasActivityTypeCallback=function(n){var t=this;return{read:function(){return t.hasActivityType(t.activityTypes()[n].id())},write:function(i){i?t.addActivityType(t.activityTypes()[n].id()):t.removeActivityType(t.activityTypes()[n].id())},owner:this}},n.prototype.heatmapSelectHandler=function(){var n=this.heatmap.getSelection(),t="";t=this.searchType()==="activities"?this.heatmapActivityDataTable.getFormattedValue(n[0].row,0):this.heatmapPeopleDataTable.getFormattedValue(n[0].row,0),this.selectedPlace(t)},n.prototype.globalViewClickHandler=function(){this.selectedPlace(null),this.selectMap("heatmap")},n.prototype.getPlaceId=function(n){for(var t=0;t<this.places.length&&n!==this.places[t].officialName;)t+=1;return t<this.places.length?this.places[t].id:null},n}();n.FacultyAndStaff=t})(n.Employees||(n.Employees={}));var t=n.Employees})(ViewModels||(ViewModels={}))