var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},ViewModels;(function(n){(function(n){var i=function(){function n(){}return n.prototype.load=function(){var t=this,n=$.Deferred();return $.ajax({type:"GET",async:!0,dataType:"json",url:App.Routes.WebApi.Establishments.get(),data:{pageNumber:1,pageSize:App.Constants.int32Max,typeEnglishNames:["University","University System"],orderBy:"name-asc"},success:function(i){t.institutions=ko.mapping.fromJS(i),n.resolve()},error:function(t,i,r){n.reject(r)},complete:function(){}}),n},n.prototype.selectInstitutionUrl=function(n){return App.Routes.Mvc.FacultyStaff.Institution.select(n)},n}(),t;n.FacultyAndStaffSelect=i,t=function(){function n(n){this.geochartCustomPlaces=[{name:"Antarctica",id:"antarctica",activityCount:0,peopleCount:0},{name:"Southern Ocean",id:"southernOcean",activityCount:0,peopleCount:0},{name:"Indian Ocean",id:"indianOcean",activityCount:0,peopleCount:0},{name:"Pacific Ocean",id:"pacificOcean",activityCount:0,peopleCount:0},{name:"Atlantic Ocean",id:"atlanticOcean",activityCount:0,peopleCount:0},{name:"Gulf of Mexico",id:"gulfOfMexico",activityCount:0,peopleCount:0},{name:"Caribbean",id:"caribbean",activityCount:0,peopleCount:0},{name:"Arctic Ocean",id:"arcticOcean",activityCount:0,peopleCount:0}],this._initialize(n)}return n.prototype._initialize=function(n){if(this.sammy=Sammy(),this.initialLocations=[],this.selectedLocationValues=[],this.fromDate=ko.observable(),this.toDate=ko.observable(),this.includeUndated=ko.observable(!0),this.establishmentId=ko.observable(null),this.establishmentOfficialName=ko.observable(null),this.establishmentCountryOfficialName=ko.observable(null),this.institutionHasCampuses=ko.observable(!1),this.institutionDropListData=[],this.locations=ko.observableArray(),this.activityTypes=ko.observableArray(),this.isHeatmapVisible=ko.observable(!0),this.isPointmapVisible=ko.observable(!1),this.isExpertVisible=ko.observable(!1),this.mapType=ko.observable("heatmap"),this.searchType=ko.observable("activities"),this.selectedPlace=ko.observable(null),this.mapRegion=ko.observable("world"),this.isGlobalView=ko.observable(!0),this.degrees=ko.observable(),this.tags=ko.observable(),this.loadSpinner=new App.Spinner(new App.SpinnerOptions(200)),this.globalActivityCountData=null,this.placeActivityCountData=null,this.globalPeopleCountData=null,this.placePeopleCountData=null,this.globalActivityTrendData=null,this.placeActivityTrendData=null,this.globalPeopleTrendData=null,this.placePeopleTrendData=null,this.heatmapActivityDataTable=null,this.heatmapPeopleDataTable=null,this.activityResults=ko.mapping.fromJS({placeResults:[{officialName:"",results:[]}]}),this.peopleResults=ko.mapping.fromJS({placeResults:[{officialName:"",results:[]}]}),this.pointmapActivityMarkers=null,this.pointmapPeopleMarkers=null,this.totalCount=ko.observable(0),this.totalPlaceCount=ko.observable(0),this.degreeCount=ko.observable(0),this.selectSearchType("activities"),this.lenses=ko.observableArray([{text:"Map",value:"map"},{text:"Table",value:"table"}]),this.lens=ko.observable("map"),n!=null&&(n.InstitutionId!=null&&(this.establishmentId(Number(n.InstitutionId)),this.institutionDropListData.push({officialName:n.InstitutionOfficialName,id:n.InstitutionId})),n.InstitutionHasCampuses!=null&&this.institutionHasCampuses(Boolean(n.InstitutionHasCampuses)),n.InstitutionCampusIds!=null&&n.InstitutionCampusIds.length>0))for(var t=0;t<n.InstitutionCampusIds.length;t+=1)this.institutionDropListData.push({officialName:n.InstitutionCampusOfficialNames[t],id:n.InstitutionCampusIds[t]})},n.prototype.setupWidgets=function(n,t,i,r,u,f,e){var h=this,o,s;this.locationSelectorId=n,o=this,$("#"+n).kendoMultiSelect({autoBind:!0,dataTextField:"officialName",dataValueField:"id",minLength:3,dataSource:o.initialLocations,value:o.selectedLocationValues,change:function(n){h.updateLocations(n.sender.dataItems())},placeholder:"[Select Country/Location]"}),$("#"+t).kendoDatePicker({open:function(){this.options.format="MM/dd/yyyy"}}),$("#"+i).kendoDatePicker({open:function(){this.options.format="MM/dd/yyyy"}}),this.establishmentDropListId=r,this.campusDropListId=u,this.collegeDropListId=f,this.departmentDropListId=e,$("#"+r).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",dataSource:this.institutionDropListData,change:function(n){var t=this.dataItem(n.sender.selectedIndex);o.clearCachedData(),o.establishmentId(t.id),o.establishmentOfficialName(t.officialName),o.selectMap(o.mapType()),o.drawPointmap(!0)}}),$("#"+e).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"[All Departments]",id:0},change:function(){o.drawPointmap(!0)},dataBound:function(){if(this.selectedIndex!=null&&this.selectedIndex!=-1){var n=this.dataItem(this.selectedIndex);n==null?(this.text(""),$("#departmenDiv").hide()):$("#departmenDiv").show()}else $("#departmenDiv").hide()}}),s=null,this.institutionHasCampuses()||(s=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(this.establishmentId()),data:{orderBy:["rank-asc","name-asc"]}}}})),$("#"+f).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"[All Colleges]",id:0},dataSource:s,change:function(n){var i=n.sender.selectedIndex,t,r;i!=-1&&(t=this.dataItem(i),t!=null&&t.id!=0&&(r=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t.id),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+e).data("kendoDropDownList").setDataSource(r)),i==0&&$("#"+e).data("kendoDropDownList").setDataSource(new kendo.data.DataSource),o.drawPointmap(!0))},dataBound:function(){var n,t,i;this.selectedIndex!=null&&this.selectedIndex!=-1&&(n=this.dataItem(this.selectedIndex),n!=null&&n.id!=0&&(t=n.id,t!=null&&(i=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+e).data("kendoDropDownList").setDataSource(i))))}}),this.institutionHasCampuses()&&$("#"+u).kendoDropDownList({dataTextField:"officialName",dataValueField:"id",optionLabel:{officialName:"[All Institutions]",id:0},dataSource:new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(this.establishmentId()),data:{orderBy:["rank-asc","name-asc"]}}}}),change:function(n){var t=n.sender.selectedIndex,i,r;t!=null&&t!=-1&&(i=this.dataItem(t),i!=null&&i.id!=0&&(r=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(i.id),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+f).data("kendoDropDownList").setDataSource(r)),t==0&&($("#"+e).data("kendoDropDownList").setDataSource(new kendo.data.DataSource),$("#"+f).data("kendoDropDownList").setDataSource(new kendo.data.DataSource),$("#"+f).data("kendoDropDownList").text("")),o.drawPointmap(!0))},dataBound:function(){var n,t,i;this.selectedIndex!=null&&this.selectedIndex!=-1&&(n=this.dataItem(this.selectedIndex),n!=null&&n.id!=0?(t=n.id,t!=null&&(i=new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.Establishments.getChildren(t),data:{orderBy:["rank-asc","name-asc"]}}}}),$("#"+f).data("kendoDropDownList").setDataSource(i))):$("#"+f).data("kendoDropDownList").setDataSource(new kendo.data.DataSource))}})},n.prototype.setupValidation=function(){},n.prototype.setupSubscriptions=function(){var n=this,t;for(this.selectedPlace.subscribe(function(){n.selectMap("heatmap")}),this.mapRegion.subscribe(function(t){n.heatmapOptions.region=t}),this.searchType.subscribe(function(){n.mapType()==="pointmap"}),t=0;t<this.activityTypes().length;t+=1)this.activityTypes()[t].checked.subscribe(function(){n.mapType()==="pointmap"&&n.drawPointmap(!0)});this.degrees.subscribe(function(){n.mapType()==="pointmap"&&n.drawPointmap(!0)}),this.tags.subscribe(function(){n.mapType()==="pointmap"&&n.drawPointmap(!0)}),this.fromDate.subscribe(function(){n.mapType()==="pointmap"&&n.drawPointmap(!0)}),this.toDate.subscribe(function(){n.mapType()==="pointmap"&&n.drawPointmap(!0)}),this.includeUndated.subscribe(function(){n.mapType()==="pointmap"&&n.drawPointmap(!0)})},n.prototype.setupRouting=function(){var n=this;this.sammy.get("#/summary",function(){n.selectMap("heatmap"),$("#pageTitle").text("Professional Engagement Summary")}),this.sammy.get("#/search",function(){n.selectMap("pointmap"),$("#pageTitle").text("Advanced Search")}),this.sammy.get("#/expert",function(){n.selectMap("expert"),$("#pageTitle").text("Find an Expert")}),this.sammy.run("#/summary")},n.prototype.setupMaps=function(){this.google.maps.visualRefresh=!0,this.pointmapOptions={mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(0,0),zoom:1,draggable:!0,scrollwheel:!1},this.heatmapOptions={width:680,height:500,region:"world",keepAspectRatio:!1,colorAxis:{colors:["#FFFFFF","darkgreen"]},backgroundColor:{fill:"transparent"},datalessRegionColor:"FFFFFF"},this.activityTypes()!=null&&(this.barchartActivityOptions={hAxis:{textPosition:"none"},vAxis:{textPosition:"none"},chartArea:{top:16,left:10,width:"100%",height:"75%"},legend:{position:"none"},isStacked:!0,series:[{type:"bars",color:"green"},{type:"line",color:"black",lineWidth:0,pointSize:0,visibleInLegend:!1}]}),this.barchartPeopleOptions={hAxis:{textPosition:"none"},vAxis:{textPosition:"none"},chartArea:{top:16,left:10,width:"100%",height:"75%"},legend:{position:"none"},isStacked:!0,series:[{type:"bars",color:"green"},{type:"line",color:"black",lineWidth:0,pointSize:0,visibleInLegend:!1}]},this.barchart=new this.google.visualization.ColumnChart($("#facultystaff-summary-barchart")[0]),this.linechartActivityOptions={chartArea:{top:8,left:40,width:"85%",height:"60%"},colors:["green"],legend:{position:"none"},vAxis:{minValue:0}},this.linechartPeopleOptions={chartArea:{top:8,left:40,width:"85%",height:"60%"},colors:["green"],legend:{position:"none"},vAxis:{minValue:0}},this.linechart=new this.google.visualization.LineChart($("#facultystaff-summary-linechart")[0])},n.prototype.getHeatmapActivityDataTable=function(){var t=this,n=$.Deferred();return this.globalActivityCountData==null?this.getActivityDataTable(null).done(function(){n.resolve(t._getHeatmapActivityDataTable())}).fail(function(t,i,r){n.reject(t,i,r)}):n.resolve(this._getHeatmapActivityDataTable()),n},n.prototype._getHeatmapActivityDataTable=function(){var u,e,r,n,f;if(this.heatmapActivityDataTable==null){if(u=new this.google.visualization.DataTable,e=[],u.addColumn("string","Country"),u.addColumn("number","Total Activities"),r=this.globalActivityCountData.placeCounts,r!=null&&r.length>0){for(n=0;n<this.geochartCustomPlaces.length;n+=1)this.geochartCustomPlaces[n].activityCount=0;for(n=0;n<r.length;n+=1){f=[],f.push(r[n].officialName),f.push(r[n].count),u.addRow(f);var t=r[n].officialName,o=r[n].count,i=-1;t==="North Atlantic Ocean"||t==="South Atlantic Ocean"?i=this.getCustomPlaceIndexByName("Atlantic Ocean"):t==="North Pacific Ocean"||t==="Pacific Ocean"||t==="South Pacific Ocean"?i=this.getCustomPlaceIndexByName("Pacific Ocean"):t==="Arctic Ocean"?i=this.getCustomPlaceIndexByName("Arctic Ocean"):t==="Gulf of Mexico"?i=this.getCustomPlaceIndexByName("Gulf of Mexico"):t==="Caribbean Ocean"?i=this.getCustomPlaceIndexByName("Caribbean"):t==="Indian Ocean"?i=this.getCustomPlaceIndexByName("Indian Ocean"):t==="Southern Ocean"?i=this.getCustomPlaceIndexByName("Southern Ocean"):t==="Antarctica"&&(i=this.getCustomPlaceIndexByName("Antarctica")),i>=0&&(this.geochartCustomPlaces[i].activityCount+=o)}}this.heatmapActivityDataTable=u}return this.heatmapActivityDataTable},n.prototype.getHeatmapPeopleDataTable=function(){var t=this,n=$.Deferred();return this.globalPeopleCountData==null?this.getPeopleDataTable(null).done(function(){n.resolve(t._getHeatmapPeopleDataTable())}):n.resolve(this._getHeatmapPeopleDataTable()),n},n.prototype._getHeatmapPeopleDataTable=function(){var u,e,r,n,f;if(this.heatmapPeopleDataTable==null){if(u=new this.google.visualization.DataTable,e=[],u.addColumn("string","Country"),u.addColumn("number","Total People"),r=this.globalPeopleCountData.placeCounts,r!=null&&r.length>0){for(n=0;n<this.geochartCustomPlaces.length;n+=1)this.geochartCustomPlaces[n].peopleCount=0;for(n=0;n<r.length;n+=1){f=[],f.push(r[n].officialName),f.push(r[n].count),u.addRow(f);var t=r[n].officialName,o=r[n].count,i=-1;t==="North Atlantic Ocean"||t==="South Atlantic Ocean"?i=this.getCustomPlaceIndexByName("Atlantic Ocean"):t==="North Pacific Ocean"||t==="Pacific Ocean"||t==="South Pacific Ocean"?i=this.getCustomPlaceIndexByName("Pacific Ocean"):t==="Arctic Ocean"?i=this.getCustomPlaceIndexByName("Arctic Ocean"):t==="Gulf of Mexico"?i=this.getCustomPlaceIndexByName("Gulf of Mexico"):t==="Caribbean Ocean"?i=this.getCustomPlaceIndexByName("Caribbean"):t==="Indian Ocean"?i=this.getCustomPlaceIndexByName("Indian Ocean"):t==="Southern Ocean"?i=this.getCustomPlaceIndexByName("Southern Ocean"):t==="Antarctica"&&(i=this.getCustomPlaceIndexByName("Antarctica")),i>=0&&(this.geochartCustomPlaces[i].peopleCount+=o)}}this.heatmapPeopleDataTable=u}return this.heatmapPeopleDataTable},n.prototype.getGlobalActivityCounts=function(){var t=this,n=$.Deferred();return this.globalActivityCountData==null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityCount(),success:function(i){t.globalActivityCountData=i,n.resolve(t.globalActivityCountData)},error:function(t,i,r){n.reject(r)},complete:function(){}}):n.resolve(this.globalActivityCountData),n},n.prototype.getActivityDataTable=function(n){var r=this,t=$.Deferred(),i;return n==null?this.getGlobalActivityCounts().done(function(){t.resolve(r._getActivityDataTable(null))}).fail(function(n,i,r){t.reject(n,i,r)}):(i=this.getPlaceId(n),i!=null?this.placeActivityCountData==null||this.placeActivityCountData.placeId!=i?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:i},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityCount(),success:function(i){r.placeActivityCountData=i,t.resolve(r._getActivityDataTable(n))},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.resolve(this._getActivityDataTable(n)):t.reject("Unknown PlaceId")),t},n.prototype._getActivityDataTable=function(n){var f=null,t=null,e,i,u,r;if(n==null)for(t=new this.google.visualization.DataTable,t.addColumn("string","Activity"),t.addColumn("number","Count"),t.addColumn({type:"number",role:"annotation"}),i=0;i<this.globalActivityCountData.typeCounts.length;i+=1)u=this.globalActivityCountData.typeCounts[i].type,r=this.globalActivityCountData.typeCounts[i].count,t.addRow([u,r,r]);else if(e=this.getPlaceId(n),e!=null)for(t=new this.google.visualization.DataTable,t.addColumn("string","Activity"),t.addColumn("number","Count"),t.addColumn({type:"number",role:"annotation"}),i=0;i<this.placeActivityCountData.typeCounts.length;i+=1)u=this.placeActivityCountData.typeCounts[i].type,r=this.placeActivityCountData.typeCounts[i].count,t.addRow([u,r,r]);return f=new this.google.visualization.DataView(t),f.setColumns([0,1,1,2]),f},n.prototype.getGlobalPeopleCounts=function(){var t=this,n=$.Deferred();return this.globalPeopleCountData==null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleCount(),success:function(i){t.globalPeopleCountData=i,n.resolve(t._getPeopleDataTable(null))},error:function(t,i,r){n.reject(r)},complete:function(){}}):n.resolve(this._getPeopleDataTable(null)),n},n.prototype.getPeopleDataTable=function(n){var r=this,t=$.Deferred(),i;return n==null?this.getGlobalPeopleCounts().done(function(){t.resolve(r._getPeopleDataTable(null))}).fail(function(n,i,r){t.reject(n,i,r)}):(i=this.getPlaceId(n),i!=null?this.placePeopleCountData==null||this.placePeopleCountData.placeId!=i?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:i},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleCount(),success:function(i){r.placePeopleCountData=i,t.resolve(r._getPeopleDataTable(n))},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.resolve(this._getPeopleDataTable(n)):t.reject("Unknown placeId.")),t},n.prototype._getPeopleDataTable=function(n){var f=null,r=new this.google.visualization.DataTable,t,u,i;if(r.addColumn("string","Activity"),r.addColumn("number","Count"),r.addColumn({type:"number",role:"annotation"}),n==null)for(t=0;t<this.globalPeopleCountData.typeCounts.length;t+=1)u=this.globalPeopleCountData.typeCounts[t].type,i=this.globalPeopleCountData.typeCounts[t].count,r.addRow([u,i,i]);else for(t=0;t<this.placePeopleCountData.typeCounts.length;t+=1)u=this.placePeopleCountData.typeCounts[t].type,i=this.placePeopleCountData.typeCounts[t].count,r.addRow([u,i,i]);return f=new this.google.visualization.DataView(r),f.setColumns([0,1,1,2]),f},n.prototype.getActivityTrendDataTable=function(n){var i=this,t=$.Deferred(),r;return n==null?this.globalActivityTrendData==null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityTrend(),success:function(n){i.globalActivityTrendData=n,t.resolve(i._getActivityTrendDataTable(null))},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.resolve(this._getActivityTrendDataTable(null)):(r=this.getPlaceId(n),r!=null?this.placeActivityTrendData==null||this.placeActivityTrendData.placeId!=r?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:r},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getActivityTrend(),success:function(r){i.placeActivityTrendData=r,t.resolve(i._getActivityTrendDataTable(n))},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.resolve(this._getActivityTrendDataTable(n)):t.reject()),t},n.prototype._getActivityTrendDataTable=function(n){var i=new this.google.visualization.DataTable,t,r,u;if(i.addColumn("string","Year"),i.addColumn("number","Count"),n==null)for(t=0;t<this.globalActivityTrendData.trendCounts.length;t+=1)r=this.globalActivityTrendData.trendCounts[t].year.toString(),u=this.globalActivityTrendData.trendCounts[t].count,i.addRow([r,u]);else for(t=0;t<this.placeActivityTrendData.trendCounts.length;t+=1)r=this.placeActivityTrendData.trendCounts[t].year.toString(),u=this.placeActivityTrendData.trendCounts[t].count,i.addRow([r,u]);return i},n.prototype.getPeopleTrendDataTable=function(n){var i=this,t=$.Deferred(),r;return n==null?this.globalPeopleTrendData==null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleTrend(),success:function(n){i.globalPeopleTrendData=n,t.resolve(i._getPeopleTrendDataTable(null))},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.resolve(this._getPeopleTrendDataTable(null)):(r=this.getPlaceId(n),r!=null?this.placePeopleTrendData==null||this.placePeopleTrendData.placeId!=r?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:r},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getPeopleTrend(),success:function(r){i.placePeopleTrendData=r,t.resolve(i._getPeopleTrendDataTable(n))},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.resolve(this._getPeopleTrendDataTable(n)):t.reject("Unkown placeId")),t},n.prototype._getPeopleTrendDataTable=function(n){var i=new this.google.visualization.DataTable,t,r,u;if(i.addColumn("string","Year"),i.addColumn("number","Count"),n==null)for(t=0;t<this.globalPeopleTrendData.trendCounts.length;t+=1)r=this.globalPeopleTrendData.trendCounts[t].year.toString(),u=this.globalPeopleTrendData.trendCounts[t].count,i.addRow([r,u]);else for(t=0;t<this.placePeopleTrendData.trendCounts.length;t+=1)r=this.placePeopleTrendData.trendCounts[t].year.toString(),u=this.placePeopleTrendData.trendCounts[t].count,i.addRow([r,u]);return i},n.prototype.getDegreeCount=function(n){var t=$.Deferred(),i;return n==null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getDegreeCount(),success:function(n){t.resolve(n.count)},error:function(n,i,r){t.reject(r)},complete:function(){}}):(i=this.getPlaceId(n),i!=null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:i},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getDegreeCount(),success:function(n){t.resolve(n.count)},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.reject("Unknown PlaceId")),t},n.prototype.getDegreePeopleCount=function(n){var t=$.Deferred(),i;return n==null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:null},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getDegreePeopleCount(),success:function(n){t.resolve(n.count)},error:function(n,i,r){t.reject(r)},complete:function(){}}):(i=this.getPlaceId(n),i!=null?$.ajax({type:"GET",async:!0,data:{establishmentId:this.establishmentId(),placeId:i},dataType:"json",url:App.Routes.WebApi.FacultyStaff.getDegreePeopleCount(),success:function(n){t.resolve(n.count)},error:function(n,i,r){t.reject(r)},complete:function(){}}):t.reject("Unknown PlaceId")),t},n.prototype.getPointmapActivityMarkers=function(n){var i=this,t=$.Deferred();return n&&(this.hidePointmapActivityMarkers(),this.pointmapActivityMarkers=null),this.pointmapActivityMarkers==null?this.activitySearch().done(function(n){t.resolve(i._getPointmapActivityMarkers(n))}).fail(function(n,i,r){t.reject(n,i,r)}):t.resolve(this.pointmapActivityMarkers),t},n.prototype._getPointmapActivityMarkers=function(n){var r=[],t=n.placeResults,i,u,f;if(t!=null&&t.length>0)for(i=0;i<t.length;i+=1)t[i].results.length>0&&(u="/api/graphics/circle?side=18&opacity=&strokeColor="+$("#mapMarkerColor").css("background-color")+"&fillColor="+$("#mapMarkerColor").css("background-color")+"&textColor="+$("#mapMarkerColor").css("color")+"&text="+t[i].results.length.toString(),f=new google.maps.Marker({position:new google.maps.LatLng(t[i].lat,t[i].lng),map:null,title:t[i].officialName,icon:u}),r.push(f));return this.pointmapActivityMarkers=r,this.pointmapActivityMarkers},n.prototype.showPointmapActivityMarkers=function(){if(this.pointmapActivityMarkers!=null)for(var n=0;n<this.pointmapActivityMarkers.length;n+=1)this.pointmapActivityMarkers[n].setMap(this.pointmap)},n.prototype.hidePointmapActivityMarkers=function(){if(this.pointmapActivityMarkers!=null)for(var n=0;n<this.pointmapActivityMarkers.length;n+=1)this.pointmapActivityMarkers[n].setMap(null)},n.prototype.getPointmapPeopleMarkers=function(n){var i=this,t=$.Deferred();return n&&(this.hidePointmapPeopleMarkers(),this.pointmapPeopleMarkers=null),this.pointmapPeopleMarkers==null?this.getGlobalPeopleCounts().done(function(){t.resolve(i._getPointmapPeopleMarkers())}).fail(function(n,i,r){t.reject(n,i,r)}):t.resolve(this._getPointmapPeopleMarkers()),t},n.prototype._getPointmapPeopleMarkers=function(){var i,n,t,r,u;if(this.pointmapPeopleMarkers==null){if(i=[],n=this.globalPeopleCountData.placeCounts,n!=null&&n.length>0)for(t=0;t<n.length;t+=1)n[t].count>0&&(r="/api/graphics/circle?side=18&opacity=&strokeColor="+$("#mapMarkerColor").css("background-color")+"&fillColor="+$("#mapMarkerColor").css("background-color")+"&textColor="+$("#mapMarkerColor").css("color")+"&text="+n[t].results.length.toString(),u=new google.maps.Marker({position:new google.maps.LatLng(n[t].lat,n[t].lng),map:null,title:n[t].officialName,icon:r}),i.push(u));this.pointmapPeopleMarkers=i}return this.pointmapPeopleMarkers},n.prototype.showPointmapPeopleMarkers=function(){if(this.pointmapPeopleMarkers!=null)for(var n=0;n<this.pointmapPeopleMarkers.length;n+=1)this.pointmapPeopleMarkers[n].setMap(this.pointmap)},n.prototype.hidePointmapPeopleMarkers=function(){if(this.pointmapPeopleMarkers!=null)for(var n=0;n<this.pointmapPeopleMarkers.length;n+=1)this.pointmapPeopleMarkers[n].setMap(null)},n.prototype.makeActivityTooltip=function(n,t){return"<b>"+n+"<\/b><br/>Total Activities: "+t.toString()},n.prototype.makePeopleTooltip=function(n,t){return"<b>"+n+"<\/b><br/>Total People: "+t.toString()},n.prototype.updateCustomGeochartPlaceTooltips=function(n){for(var i="",r="",u=0,t=0;t<this.geochartCustomPlaces.length;t+=1)n==="activities"?(i=this.geochartCustomPlaces[t].id,r=this.geochartCustomPlaces[t].name,u=this.geochartCustomPlaces[t].activityCount,$("#"+i).tooltip({track:!0,tooltipClass:"geochartTooltip",items:"#"+i,content:this.makeActivityTooltip(r,u)})):(i=this.geochartCustomPlaces[t].id,r=this.geochartCustomPlaces[t].name,u=this.geochartCustomPlaces[t].activityCount,$("#"+i).tooltip({track:!0,tooltipClass:"geochartTooltip",items:"#"+i,content:this.makePeopleTooltip(r,u)}))},n.prototype.load=function(){var n=this,f=this,u=$.Deferred(),t,i,r;return this.loadSpinner.start(),t=$.Deferred(),$.get(App.Routes.WebApi.Employees.ModuleSettings.ActivityTypes.get()).done(function(n){t.resolve(n)}).fail(function(n,i,r){t.reject(n,i,r)}),i=$.Deferred(),$.ajax({type:"GET",data:{isCountry:!0},dataType:"json",url:App.Routes.WebApi.Places.get(),success:function(n){i.resolve(n)},error:function(n,t,r){i.reject(n,t,r)}}),r=$.Deferred(),$.ajax({type:"GET",data:{isWater:!0},dataType:"json",url:App.Routes.WebApi.Places.get(),success:function(n){r.resolve(n)},error:function(n,t,i){r.reject(n,t,i)}}),$.when(t,i,r).done(function(t,i,r){n.activityTypes=ko.mapping.fromJS(t);for(var f=0;f<n.activityTypes().length;f+=1)n.activityTypes()[f].checked=ko.observable(!0);n.places=i.concat(r),u.resolve()}).fail(function(n,t,i){u.reject(n,t,i)}).always(function(){}),u},n.prototype.checkInstitutionForNull=function(){var t=$("#"+this.establishmentDropListId).data("kendoAutoComplete"),n=t.value()!=null?t.value().toString():null;n!=null&&(n=$.trim(n)),(n==null||n.length==0)&&(t.value(null),this.establishmentOfficialName(null),this.establishmentId(null))},n.prototype.updateLocations=function(n){var t,i;if(this.locations!=null){for(this.locations.removeAll(),t=0;t<n.length;t+=1)i=ko.mapping.fromJS({id:0,placeId:n[t].id,version:""}),this.locations.push(i);this.drawPointmap(!0)}},n.prototype.selectMap=function(n){var t=this,i;this.mapType(n),$("#heatmapText").css("font-weight","normal"),this.isHeatmapVisible(!1),$("#pointmapText").css("font-weight","normal"),this.isPointmapVisible(!1),$("#expertText").css("font-weight","normal"),this.isExpertVisible(!1),$("#bib-faculty-staff-summary").removeClass("current"),$("#bib-faculty-staff-search").removeClass("current"),$("#bib-faculty-staff-expert").removeClass("current"),n==="heatmap"?($("#heatmapText").css("font-weight","bold"),this.isHeatmapVisible(!0),this.searchType()==="activities"?($("#activitiesButton").css("font-weight","bold"),$("#peopleButton").css("font-weight","normal")):($("#activitiesButton").css("font-weight","normal"),$("#peopleButton").css("font-weight","bold")),this.heatmap==null&&(this.heatmap=new this.google.visualization.GeoChart($("#heatmap")[0]),this.google.visualization.events.addListener(this.heatmap,"select",function(){t.heatmapSelectHandler()})),this.loadSpinner.start(),this.searchType()==="activities"?(this.getActivityDataTable(this.selectedPlace()).done(function(n){t.barchart.draw(n,t.barchartActivityOptions),t.selectedPlace()!=null&&(t.totalCount(t.placeActivityCountData.count),t.totalPlaceCount(t.placeActivityCountData.countOfPlaces)),t.getHeatmapActivityDataTable().done(function(n){t.heatmap.draw(n,t.heatmapOptions),t.selectedPlace()==null&&(t.totalCount(t.globalActivityCountData.count),t.totalPlaceCount(t.globalActivityCountData.countOfPlaces)),t.updateCustomGeochartPlaceTooltips(t.searchType())}),t.loadSpinner.stop()}),this.getActivityTrendDataTable(this.selectedPlace()).done(function(n){t.linechart.draw(n,t.linechartActivityOptions)}),this.getDegreeCount(this.selectedPlace()).done(function(n){t.degreeCount(n)})):(this.getPeopleDataTable(this.selectedPlace()).done(function(n){t.barchart.draw(n,t.barchartPeopleOptions),t.selectedPlace()!=null&&(t.totalCount(t.placePeopleCountData.count),t.totalPlaceCount(t.placePeopleCountData.countOfPlaces)),t.getHeatmapPeopleDataTable().done(function(n){t.heatmap.draw(n,t.heatmapOptions),t.selectedPlace()==null&&(t.totalCount(t.globalPeopleCountData.count),t.totalPlaceCount(t.globalPeopleCountData.countOfPlaces)),t.updateCustomGeochartPlaceTooltips(t.searchType())}),t.loadSpinner.stop()}),this.getPeopleTrendDataTable(this.selectedPlace()).done(function(n){t.linechart.draw(n,t.linechartPeopleOptions)}),this.getDegreePeopleCount(this.selectedPlace()).done(function(n){t.degreeCount(n)})),$("#bib-faculty-staff-summary").addClass("current")):n==="pointmap"?($("#pointmapText").css("font-weight","bold"),this.isPointmapVisible(!0),$("#pointmap").css("display","inline-block"),this.pointmap==null&&(i=$("#pointmap")[0],this.pointmap=new this.google.maps.Map(i,this.pointmapOptions)),this.drawPointmap(!1),$("#bib-faculty-staff-search").addClass("current")):n==="expert"&&($("#expertText").css("font-weight","bold"),this.isExpertVisible(!0),$("#expert").css("display","inline-block"),$("#bib-faculty-staff-expert").addClass("current"))},n.prototype.selectSearchType=function(n){n==="activities"?this.setActivitiesSearch():this.setPeopleSearch(),this.heatmap!=null&&this.selectMap("heatmap")},n.prototype.setActivitiesSearch=function(){$("#activitiesButton").css("font-weight","bold"),$("#peopleButton").css("font-weight","normal"),this.searchType("activities")},n.prototype.setPeopleSearch=function(){$("#activitiesButton").css("font-weight","normal"),$("#peopleButton").css("font-weight","bold"),this.searchType("people")},n.prototype.heatmapSelectHandler=function(){var r=this.heatmap.getSelection(),i,t,n;if(r!=null&&r.length>0){if(i="",t=null,this.searchType()==="activities")for(i=this.heatmapActivityDataTable.getFormattedValue(r[0].row,0),n=0;n<this.globalActivityCountData.placeCounts.length&&t==null;)this.globalActivityCountData.placeCounts[n].officialName===i&&(t=this.globalActivityCountData.placeCounts[n].countryCode),n+=1;else for(i=this.heatmapPeopleDataTable.getFormattedValue(r[0].row,0),n=0;n<this.globalPeopleCountData.placeCounts.length&&t==null;)this.globalPeopleCountData.placeCounts[n].officialName===i&&(t=this.globalPeopleCountData.placeCounts[n].countryCode),n+=1;this.selectedPlace(i),this.mapRegion(t!=null?t:"world")}},n.prototype.expertClickHandler=function(){this.selectMap("expert")},n.prototype.globalViewClickHandler=function(){this.selectedPlace(null),this.mapRegion("world"),this.selectMap("heatmap")},n.prototype.getPlaceId=function(n){for(var t=0;t<this.places.length&&n!==this.places[t].officialName;)t+=1;return t<this.places.length?this.places[t].id:null},n.prototype.getCustomPlaceIndexByName=function(n){for(var t=0;t<this.geochartCustomPlaces.length&&n!==this.geochartCustomPlaces[t].name;)t+=1;return t<this.geochartCustomPlaces.length?t:-1},n.prototype.clearCachedData=function(){this.globalActivityCountData=null,this.placeActivityCountData=null,this.globalPeopleCountData=null,this.placePeopleCountData=null,this.globalActivityTrendData=null,this.placeActivityTrendData=null,this.globalPeopleTrendData=null,this.placePeopleTrendData=null,this.heatmapActivityDataTable=null,this.heatmapPeopleDataTable=null},n.prototype.customPlaceClick=function(n,t,i){this.selectedPlace(i)},n.prototype.activitySearch=function(){for(var v=this,i=$.Deferred(),s=[],r,u,f,e,o,n,h,c,l,a,t=0;t<this.locations().length;t+=1)s.push(this.locations()[t].placeId());for(r=[],t=0;t<this.activityTypes().length;t+=1)this.activityTypes()[t].checked()&&r.push(this.activityTypes()[t].id());return u=null,this.degrees()!=null&&this.degrees().length>0&&(u=this.degrees().split(",")),f=null,this.tags()!=null&&this.tags().length>0&&(f=this.tags().split(",")),e=null,this.fromDate()!=null&&(e=this.fromDate().toString()),o=null,this.toDate()!=null&&(o=this.toDate().toString()),n=$("#"+this.campusDropListId).data("kendoDropDownList").dataItem(),h=n!=null&&n.id!=0?n.id:null,n=$("#"+this.collegeDropListId).data("kendoDropDownList").dataItem(),c=n!=null&&n.id!=0?n.id:null,n=$("#"+this.departmentDropListId).data("kendoDropDownList").dataItem(),l=n!=null&&n.id!=0?n.id:null,a={establishmentId:this.establishmentId(),filterType:this.searchType(),locationIds:s,activityTypes:r,degrees:u,tags:f,fromDate:e,toDate:o,noUndated:!this.includeUndated(),campusId:h,collegeId:c,departmentId:l},$.ajax({type:"POST",data:ko.toJSON(a),contentType:"application/json",dataType:"json",url:App.Routes.WebApi.FacultyStaff.postSearch(),success:function(n){ko.mapping.fromJS(n,{},v.activityResults),i.resolve(n)},error:function(n,t,r){i.reject(r)}}),i},n.prototype.selectLens=function(n){n==="map"?this.lens("map"):this.lens("table")},n.prototype.getActivityTypeIconName=function(n){for(var t=0;t<this.activityTypes().length&&this.activityTypes()[t].id()!=n;)t+=1;return t<this.activityTypes().length?this.activityTypes()[t].iconName():null},n.prototype.getActivityTypeToolTip=function(n){for(var t=0;t<this.activityTypes().length&&this.activityTypes()[t].id()!=n;)t+=1;return t<this.activityTypes().length?this.activityTypes()[t].type():null},n.prototype.drawPointmap=function(n){var t=this;this.loadSpinner.start(),this.searchType()==="activities"?this.getPointmapActivityMarkers(n).done(function(){t.hidePointmapPeopleMarkers(),t.showPointmapActivityMarkers()}).always(function(){t.loadSpinner.stop()}):this.getPointmapPeopleMarkers(n).done(function(){t.hidePointmapActivityMarkers(),t.showPointmapPeopleMarkers()}).always(function(){t.loadSpinner.stop()})},n}(),n.FacultyAndStaff=t})(n.Employees||(n.Employees={}));var t=n.Employees})(ViewModels||(ViewModels={}))