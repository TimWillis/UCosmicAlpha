var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ViewModels;(function(n){(function(t){var i=function(t){function i(){t.call(this),this.sammy=Sammy(),this.$historyJson=ko.observable(),this._history=ko.observableArray([]),this._historyIndex=0,this.impersonateUserName=ko.observable(),this.flasherProxy=new App.FlasherProxy,this._init()}return __extends(i,t),i.KeywordSessionKey="UserSearchKeyword",i.PageSizeSessionKey="UserSearchPageSize",i.OrderBySessionKey="UserSearchOrderBy",i.prototype._init=function(){this._setupHistory(),this._setupSammy(),this._setupQueryComputed(),this._setupPagingDefaults(),this._setupSessionStorage()},i.prototype._pullResults=function(){var n=this,t=$.Deferred(),i={pageSize:this.pageSize(),pageNumber:this.pageNumber(),keyword:this.throttledKeyword(),orderBy:this.orderBy()};return this.spinner.start(),this.nextForceDisabled(!0),this.prevForceDisabled(!0),$.ajax({url:App.Routes.WebApi.Identity.Users.get(),data:i,cache:!1}).done(function(n,i,r){t.resolve(n,i,r)}).fail(function(n,i,r){t.reject(n,i,r)}).always(function(){n.spinner.stop(),n.nextForceDisabled(!1),n.prevForceDisabled(!1)}),t},i.prototype._loadResults=function(t){var i=this,r={items:{key:function(n){return ko.utils.unwrapObservable(n.id)},create:function(t){return new n.Users.SearchResult(t.data,i)}},ignore:["pageSize","pageNumber"]};ko.mapping.fromJS(t,r,this),this.transitionedPageNumber(this.pageNumber())},i.prototype._setupQueryComputed=function(){var n=this;ko.computed(function(){n.pageSize()!==undefined&&n.orderBy()!==undefined&&n._pullResults().done(function(t){n._loadResults(t)}).fail(function(){})}).extend({throttle:250})},i.prototype._setupSammy=function(){var t=this,n=this;this.sammy.before(/\#\/page\/(.*)/,function(){var i,t,r;if(n.nextForceDisabled()||n.prevForceDisabled())return!1;if(n._history().length>1)for(i=this.path,t=0;t<n._history().length;t++)if(r=n._history()[t],i===r)return n._historyIndex=t,!0;return n._history.push(this.path),n._historyIndex=n._history().length-1,!0}),this.sammy.get(this.getPageHash(":pageNumber"),function(){var t=this.params.pageNumber;t&&parseInt(t)!==parseInt(n.pageNumber())&&n.pageNumber(parseInt(t)),document.title="Users (Page #"+n.pageNumber()+")"}),this.sammy.get("/users[/]?",function(){t.sammy.setLocation(t.getPageHash(1))})},i.prototype._setupHistory=function(){var n=this;this.$historyJson.subscribe(function(t){var i,r;t&&t.length&&(i=t.val(),i&&(r=$.parseJSON(i),ko.mapping.fromJS(r,{},n._history)))}),this._history.subscribe(function(t){if(n.$historyJson()&&n.$historyJson().length){var r=n.$historyJson().val(),i=ko.toJSON(t);r!==i&&n.$historyJson().val(i)}})},i.prototype._setupPagingDefaults=function(){this.orderBy($('input[type=hidden][data-bind*="value: orderBy"]').val()),this.pageSize($('input[type=hidden][data-bind*="value: pageSize"]').val())},i.prototype._setupSessionStorage=function(){this.keyword.subscribe(function(n){sessionStorage.setItem(i.KeywordSessionKey,n)}),this.pageSize.subscribe(function(n){sessionStorage.setItem(i.PageSizeSessionKey,n.toString())}),this.orderBy.subscribe(function(n){sessionStorage.setItem(i.OrderBySessionKey,n)})},i.prototype.applySession=function(){this.keyword(sessionStorage.getItem(i.KeywordSessionKey)||this.keyword()),this.pageSize(parseInt(window.sessionStorage.getItem("UserSearchPageSize"))||parseInt(this.pageSize())),this.orderBy(sessionStorage.getItem(i.OrderBySessionKey)||this.orderBy())},i.prototype.nextPage=function(){this._gotoPage(1)},i.prototype.prevPage=function(){this._gotoPage(-1)},i.prototype._gotoPage=function(n){var u,i,f,e,r;if(n!=0&&(u=n<0?this.prevEnabled():this.nextEnabled(),u&&(i=parseInt(this.pageNumber())+n,i>0&&i<=this.pageCount()))){if(this._history().length>1)for(var o=location.pathname+this.getPageHash(i),t=n<0?0:this._history().length-1,s=function(){n<0?t++:t--};t<this._history().length&&t>=0;s())if(f=this._history()[t],o===f){e=t-this._historyIndex,history.go(e),this._historyIndex=t;return}this.pageNumber(i),r=this.getPageHash(i),this.sammy.getLocation()!==r&&this.sammy.setLocation(r)}},i}(n.PagedSearch);t.Search=i})(n.Users||(n.Users={}));var t=n.Users})(ViewModels||(ViewModels={}))