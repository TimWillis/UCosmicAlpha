var Agreements;(function(n){(function(n){var t=function(){function n(n){typeof n=="undefined"&&(n={val:parseInt(window.location.href.toLowerCase().substring(window.location.href.toLowerCase().indexOf("agreements/")+11))}),this.agreementId=n,this.isBound=ko.observable(!1),this.files=ko.observableArray(),this.content=ko.observable(),this.expiresOn=ko.observable(),this.isAutoRenew=ko.observable(),this.status=ko.observable(),this.isExpirationEstimated=ko.observable(),this.name=ko.observable(),this.notes=ko.observable(),this.participants=ko.observableArray(),this.startsOn=ko.observable(),this.type=ko.observable(),this.umbrellaId=ko.observable(),this.myUrl=window.location.href.toLowerCase(),isNaN(this.agreementId.val)&&(this.agreementId.val=0),this.populateFilesClass=new agreements.populateFiles,this._setupDateComputeds(),this._setupNameComputeds(),this.agreementId.val!==0&&(this.getData(),this.createMap())}return n.prototype.getData=function(){var n=this;$.get(App.Routes.WebApi.Agreements.get(this.agreementId.val)).done(function(t){n.content(t.content),n.expiresOn(t.expiresOn),n.isAutoRenew(t.isAutoRenew),n.status(t.status),n.isExpirationEstimated(t.isExpirationEstimated),n.name(t.name),n.notes(t.notes),ko.mapping.fromJS(t.participants,{},n.participants),n.startsOn(t.startsOn),n.type(t.type),n.umbrellaId(t.umbrellaId),n.isBound(!0),n.partners=t.participants}),this.populateFilesClass.populate(this.agreementId),this.files=this.populateFilesClass.files},n.prototype._setupNameComputeds=function(){var n=this;this.participantsNames=ko.computed(function(){var t="";return ko.utils.arrayForEach(n.participants(),function(n){t+="<div style='margin-bottom:10px'>",t+=n.establishmentTranslatedName()!=null&&n.establishmentOfficialName()!=n.establishmentTranslatedName()&&n.establishmentOfficialName()!=null?"<strong>"+n.establishmentTranslatedName()+"<\/strong><br /> ("+n.establishmentOfficialName()+")":n.establishmentTranslatedName()!=null&&n.establishmentOfficialName()!=n.establishmentTranslatedName()?"<strong>"+n.establishmentTranslatedName()+"<\/strong>":"<strong>"+n.establishmentOfficialName()+"<\/strong>",t+="<\/div>"}),t})},n.prototype._setupDateComputeds=function(){var n=this;this.startsOnDate=ko.computed(function(){var t=n.startsOn(),i=new Date(t);return i.getFullYear()<1500?"unknown":moment(t).format("YYYY-MM-DD")}),this.expiresOnDate=ko.computed(function(){var t=n.expiresOn(),i=new Date(t);return i.getFullYear()<1500?"unknown":moment(t).format("YYYY-MM-DD")})},n.prototype.createMap=function(){function t(){for(var e=Enumerable.From(n.partners).Where(function(n){return!n.isOwner}).ToArray(),o=Enumerable.From(e).Select(function(n){return n.center}).ToArray(),i=Enumerable.From(o).Select(function(n){return new google.maps.LatLng(n.latitude,n.longitude)}).ToArray(),r,u=new google.maps.LatLngBounds,t=0,f=i.length;t<f;t++)u.extend(i[t]);r=new google.maps.Map(document.getElementById("map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,mapMaker:!0}),r.fitBounds(u)}var n=this;google.maps.event.addDomListener(window,"load",t)},n}();n.PublicView=t})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Agreements||(Agreements={}))