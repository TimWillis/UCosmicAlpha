var Agreements;(function(n){(function(n){var t=function(){function n(t){var i=this;this.settings=t,this.keyword=ko.observable(sessionStorage.getItem(n.KeywordSessionKey)||""),this.keywordThrottled=ko.computed(this.keyword).extend({throttle:400}),this.countryCode=ko.observable(sessionStorage.getItem(n.CountrySessionKey)||"any"),this.zoom=ko.observable(parseInt(sessionStorage.getItem(n.ZoomSessionKey))||1),this.lat=ko.observable(parseInt(sessionStorage.getItem(n.LatSessionKey))||0),this.lng=ko.observable(parseInt(sessionStorage.getItem(n.LngSessionKey))||0),this._inputChanged=ko.computed(function(){i.countryCode()==undefined&&i.countryCode("any"),sessionStorage.setItem(n.KeywordSessionKey,i.keyword()||""),sessionStorage.setItem(n.CountrySessionKey,i.countryCode()),sessionStorage.setItem(n.ZoomSessionKey,i.zoom().toString()),sessionStorage.setItem(n.LatSessionKey,i.lat().toString()),sessionStorage.setItem(n.LngSessionKey,i.lng().toString())}).extend({throttle:0}),this.countryOptions=ko.observableArray([{code:"any",name:"[Loading...]"}]),this._countryChanged=ko.computed(function(){i._onCountryChanged()}),this.routeFormat="#/{0}/country/{4}/zoom/{1}/latitude/{2}/longitude/{3}/".format(this.settings.route).replace("{4}","{0}"),this._isActivated=ko.observable(!1),this._route=ko.computed(function(){return i._computeRoute()}),this._loadCountryOptions(),this.sammy=this.settings.sammy||Sammy(),this._runSammy()}return n.prototype._onCountryChanged=function(){var t=this.countryCode(),n=this.countryOptions();n.length==1&&n[0].code!=t&&(n[0].code=t)},n.prototype._loadCountryOptions=function(){var t=this,n=$.Deferred();return $.get(App.Routes.WebApi.Countries.get()).done(function(i){var r=i.slice(0);r=Enumerable.From([{code:"any",name:"[All countries]"}]).Concat(r).Concat([{code:"none",name:"[Without country]"}]).ToArray(),t.countryOptions(r),n.resolve()}),n},n.prototype._runSammy=function(){var n=this,t=new RegExp("\\{0}".format(this.routeFormat.format("(.*)","(.*)","(.*)","(.*)").replace(/\//g,"\\/")));this.sammy.before(t,function(){var t=this;return n._onBeforeRoute(t)}),this.sammy.get(this.routeFormat.format(":country",":zoom",":lat",":lng"),function(){var t=this;n._onRoute(t)}),this.sammy.get(this.settings.activationRoute||this.sammy.getLocation(),function(){var t=this;n.onBeforeActivation(t)}),this.settings.sammy||this.sammy.isRunning()||this.sammy.run()},n.prototype._onBeforeRoute=function(){return!0},n.prototype._onRoute=function(n){var t=n.params.country,i=n.params.zoom,r=n.params.lat,u=n.params.lng;this.countryCode(t),this._isActivated()||this._isActivated(!0)},n.prototype.onBeforeActivation=function(){this._setLocation()},n.prototype._computeRoute=function(){var n=this.countryCode(),t=this.zoom(),i=this.lat(),r=this.lng();return this.routeFormat.format(n,t,i,r)},n.prototype._setLocation=function(){var n=this._route();this.sammy.getLocation().indexOf(n)<0&&this.sammy.setLocation(n)},n.KeywordSessionKey="AgreementSearchKeyword2",n.CountrySessionKey="AgreementSearchCountry2",n.ZoomSessionKey="AgreementSearchZoom",n.LatSessionKey="AgreementSearchLat",n.LngSessionKey="AgreementSearchLng",n}();n.SearchMap=t})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Agreements||(Agreements={}))