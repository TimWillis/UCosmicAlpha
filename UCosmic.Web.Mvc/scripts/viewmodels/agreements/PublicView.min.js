var Agreements;(function(n){(function(t){var i=function(){function t(t,i){var r=this,u,f;this.isBound=ko.observable(!1),this.files=ko.observableArray(),this.content=ko.observable(),this.expiresOn=ko.observable(),this.isAutoRenew=ko.observable(),this.status=ko.observable(),this.isExpirationEstimated=ko.observable(),this.name=ko.observable(),this.notes=ko.observable(),this.participants=ko.observableArray(),this.startsOn=ko.observable(),this.type=ko.observable(),this.umbrellaId=ko.observable(),this.startsOnDate=ko.computed(function(){var n=r.startsOn(),t=new Date(n);return t.getFullYear()<1500?"unknown":moment(n).format("M/D/YYYY")}),this.expiresOnDate=ko.computed(function(){var n=r.expiresOn(),t=new Date(n);return t.getFullYear()<1500?"unknown":moment(n).format("M/D/YYYY")}),this._googleMarkers=ko.observableArray(),isNaN(t)&&(t=0),this.agreementId=t,this.agreementVisibility=i||"Public",this.fileListPopulator=new n.FileListPopulator,this.agreementId!==0&&(u=this._bindData(),f=this._createMap(),$.when(u,f).done(function(){r._bindMap()})),this.files=this.fileListPopulator.files,this.fileListPopulator.populate(this.agreementId)}return t.prototype.fileHref=function(n,t){return"/api/agreements/"+n.agreementId+"/files/"+t.id()+"/content/"},t.prototype.fileDownloadHref=function(n,t){return"/api/agreements/"+n.agreementId+"/files/"+t.id()+"/download/"},t.prototype._bindData=function(){var n=this,t=$.Deferred();return $.get(App.Routes.WebApi.Agreements.get(this.agreementId)).done(function(i){var r={participants:{create:function(n){return n.data}}};ko.mapping.fromJS(i,r,n),n.participants(Enumerable.From(n.participants()).OrderBy(function(n){return n.isOwner}).ThenBy(function(n){return n.establishmentTranslatedName}).ToArray()),n.isBound(!0),t.resolve()}),t},t.prototype._createMap=function(){var t,n;return google.maps.visualRefresh=!0,t={mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(0,0),zoom:1,draggable:!0,scrollwheel:!1,streetViewControl:!1,panControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},this._googleMap=new google.maps.Map(document.getElementById("map-canvas"),t),n=$.Deferred(),google.maps.event.addListenerOnce(this._googleMap,"idle",function(){n.resolve()}),n},t.prototype._bindMap=function(){var e=this,r=Enumerable.From(this.participants()).Where(function(n){return!n.isOwner}).ToArray(),t=Enumerable.From(r).Where(function(n){return n.center&&n.center.hasValue}).Select(function(n){return n.center}).ToArray(),u=Enumerable.From(t).Select(function(n){return new google.maps.LatLng(n.latitude,n.longitude)}).ToArray(),i=new google.maps.LatLngBounds,n,f;$.each(u,function(n,u){var f=Enumerable.From(r).Single(function(i){return i.center&&i.center==t[n]}).establishmentTranslatedName,o={map:e._googleMap,position:u,title:f},s=new google.maps.Marker(o);i.extend(u),e._googleMarkers.push(s)}),t.length==1?(this._googleMap.setCenter(u[0]),n=Enumerable.From(r).Single(function(n){return n.center&&n.center==t[0]}),f=n.googleMapZoomLevel,f?this._googleMap.setZoom(f):n.boundingBox&&n.boundingBox.hasValue&&(i=new google.maps.LatLngBounds(new google.maps.LatLng(n.boundingBox.southWest.latitude,n.boundingBox.southWest.longitude),new google.maps.LatLng(n.boundingBox.northEast.latitude,n.boundingBox.northEast.longitude)),this._googleMap.fitBounds(i),this._googleMap.setCenter(u[0]))):t.length>0&&this._googleMap.fitBounds(i)},t.prototype._animateMapZoom=function(n){var r=this,t=this._googleMap.getZoom();if(t!=n){var u=n-t,f=u>0?1:-1,i=t+f;this._googleMap.setZoom(i),i!=t&&setTimeout(function(){r._animateMapZoom(n)},100)}},t.prototype.createMap=function(){function t(){for(var o=Enumerable.From(n.participants()).Where(function(n){return!n.isOwner}).ToArray(),e=Enumerable.From(n.participants()).Select(function(n){return n.center}).ToArray(),i=Enumerable.From(e).Select(function(n){return new google.maps.LatLng(n.latitude,n.longitude)}).ToArray(),r,u=new google.maps.LatLngBounds,t=0,f=i.length;t<f;t++)u.extend(i[t]);r=new google.maps.Map(document.getElementById("map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,mapMaker:!0}),r.fitBounds(u)}var n=this;google.maps.event.addDomListener(window,"load",t)},t}();t.PublicView=i})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Agreements||(Agreements={}))