var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Agreements;(function(n){(function(n){var t=function(t){function i(i,r){typeof r=="undefined"&&(r=!0);var u=this;t.call(this),this.domain=i,this.initDefaultPageRoute=r,this.header=ko.observable(),this.$searchResults=$("#searchResults"),this.deferredFadeInOut=$.Deferred(),this.deferredFadeInOut2=$.Deferred(),this.optionsEnabled=ko.observable(!0),this.sammy=Sammy(),this.sammyBeforeRoute=/\#\/page\/(.*)\//,this.sammyGetPageRoute="#/page/:pageNumber/",this.sammyDefaultPageRoute="{0}/agreements[/]?".format(this.domain),this.countries=ko.observableArray(),this.countryCode=ko.observable(),this.lenses=ko.observableArray([{text:"Table",value:"table"},{text:"List",value:"list"}]),this.lens=ko.observable(),this.$itemsPage=undefined,this.sideSwiper=new App.SideSwiper({frameWidth:710,speed:"fast",root:"#search"}),this.trail=ko.observableArray([]),this.resultsMapping={items:{key:function(n){return ko.utils.unwrapObservable(n.id)},create:function(t){return new n.SearchResult(t.data,t.parent)}},ignore:["pageSize","pageNumber"]},this._init(),this.changeLens(this.lenses()[0]),this.requestResults=this.requestResults.bind(this),this.prevPage=function(){if(u.pageNumber()>1){var n=Number(u.pageNumber())-1;u.pageNumber(n)}},this.nextPage=function(){if(u.nextEnabled()){var n=Number(u.pageNumber())+1;u.pageNumber(n)}}}return __extends(i,t),i.prototype._init=function(){this._setupCountryDropDown(),this._setupPagingSubscriptions(),this._setupLensing(),this._setupPagingDefaults(),this._applySession(),this._setupSammy(),this._setupSessionStorage()},i.prototype._setupCountryDropDown=function(){var n=this;ko.computed(function(){var t=$('input[type=hidden][data-bind="value: countryCode"]').val();$.get(App.Routes.WebApi.Countries.get()).done(function(i){i.splice(i.length,0,{code:"-1",name:"[Without country]"}),n.countries(i),t&&t!==n.countryCode()&&n.countryCode(t)})}).extend({throttle:1})},i.prototype._setupPagingSubscriptions=function(){var n=this;this.pageNumber.subscribe(function(){n.setLocation()})},i.prototype._setupLensing=function(){var n=this;this.changeLens=function(t){n.lens(t.value)}},i.prototype._setupSammy=function(){var n=this;n.sammy.before(n.sammyBeforeRoute,function(){n.beforePage(this)}),n.sammy.get(n.sammyGetPageRoute,function(){n.getPage(this)}),n.initDefaultPageRoute&&n.sammy.get(n.sammyDefaultPageRoute,function(){n.initPageHash(this)}),ko.computed(function(){n.requestResults()}).extend({throttle:1})},i.prototype.getPage=function(n){var t=this.trail();if(!(t.length>0)||t[t.length-1]!==n.path){if(t.length>1&&t[t.length-2]===n.path){t.pop();return}t.length>0,t.push(n.path)}},i.prototype.beforePage=function(n){var t;return this.nextForceDisabled()||this.prevForceDisabled()?!1:(t=n.params.pageNumber,t&&parseInt(t)!==Number(this.pageNumber())&&this.pageNumber(parseInt(t)),!0)},i.prototype.initPageHash=function(n){n.app.setLocation("#/page/1/")},i.prototype.setLocation=function(){var n="#/page/"+this.pageNumber()+"/";this.sammy.getLocation()!==n&&this.sammy.setLocation(n)},i.prototype.lockAnimation=function(){this.nextForceDisabled(!0),this.prevForceDisabled(!0)},i.prototype.unlockAnimation=function(){this.nextForceDisabled(!1),this.prevForceDisabled(!1)},i.prototype.swipeCallback=function(){},i.prototype.receiveResults=function(n){n?ko.mapping.fromJS(n,this.resultsMapping,this):ko.mapping.fromJS({items:[],itemTotal:0},this.resultsMapping,this),App.WindowScroller.restoreTop(),this.transitionedPageNumber(this.pageNumber()),this.deferredFadeInOut2.resolve()},i.prototype.requestResults=function(){var n=this;(this.optionsEnabled(!1),this.pageSize()!==undefined&&this.orderBy()!==undefined&&this.pageNumber()!==undefined&&this.keyword()===this.throttledKeyword())&&(this.lockAnimation(),this.spinner.start(),this.deferredFadeInOut=$.Deferred(),this.deferredFadeInOut2=$.Deferred(),$.when(this.deferredFadeInOut2).done(function(){n.spinner.stop(),n.$searchResults.fadeIn(400,function(){n.unlockAnimation(),n.optionsEnabled(!0),n.$searchResults.children().offset({top:n.$searchResults.offset().top})})}),this.$searchResults.is(":visible")?this.$searchResults.fadeOut(400,function(){n.deferredFadeInOut.resolve()}):this.deferredFadeInOut.resolve(),$.get(App.Routes.WebApi.Agreements.Search.get(this.domain),{pageSize:this.pageSize(),pageNumber:this.pageNumber(),countryCode:this.countryCode(),keyword:this.throttledKeyword(),orderBy:this.orderBy()}).done(function(t){$.when(n.deferredFadeInOut).done(function(){n.receiveResults(t)})}))},i.prototype.gotoAddNew=function(){return!0},i.prototype.clickAction=function(){return!0},i.prototype.detailHref=function(n){return App.Routes.Mvc.Establishments.show(n)},i.prototype._setupPagingDefaults=function(){this.orderBy("country"),this.pageSize(10)},i.prototype._setupSessionStorage=function(){this.keyword.subscribe(function(n){sessionStorage.setItem(i.KeywordSessionKey,n)}),this.pageSize.subscribe(function(n){sessionStorage.setItem(i.PageSizeSessionKey,n.toString())}),this.orderBy.subscribe(function(n){sessionStorage.setItem(i.OrderBySessionKey,n)}),this.countryCode.subscribe(function(n){sessionStorage.setItem(i.CountrySessionKey,n)}),this.pageNumber.subscribe(function(n){sessionStorage.setItem(i.PageNumberSessionKey,n.toString())})},i.prototype._applySession=function(){this.keyword(sessionStorage.getItem(i.KeywordSessionKey)||this.keyword()),this.pageSize(parseInt(sessionStorage.getItem(i.PageSizeSessionKey))||Number(this.pageSize())),this.orderBy(sessionStorage.getItem(i.OrderBySessionKey)||this.orderBy()),sessionStorage.getItem(i.CountrySessionKey)!=="undefined"&&this.countryCode(sessionStorage.getItem(i.CountrySessionKey)||this.countryCode()),this.pageNumber(parseInt(sessionStorage.getItem(i.PageNumberSessionKey))||Number(this.pageNumber()))},i.KeywordSessionKey="AgreementSearchKeyword",i.PageSizeSessionKey="AgreementSearchPageSize",i.OrderBySessionKey="AgreementSearchOrderBy",i.CountrySessionKey="AgreementSearchCountry",i.PageNumberSessionKey="AgreementSearchPageNumber",i}(App.PagedSearch);n.Search=t})(n.ViewModels||(n.ViewModels={}));var t=n.ViewModels})(Agreements||(Agreements={}))