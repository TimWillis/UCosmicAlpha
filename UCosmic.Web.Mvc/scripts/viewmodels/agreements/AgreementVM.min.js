define(["require","exports","../amd-modules/Establishments/SearchResult","../amd-modules/Establishments/Search","../amd-modules/Establishments/Item","../amd-modules/Widgets/Spinner"],function(n,t,i,r,u,f){var c=i,l=r,a=u,o=f,e=l.Search,v=a.Item,y=c.SearchResult,s=function(){function n(n,t,i,r){this.isOwner=ko.observable(n),this.establishmentId=ko.observable(t),this.establishmentOfficialName=ko.observable(i),this.establishmentTranslatedName=ko.observable(r)}return n}(),h;t.InstitutionalAgreementParticipantModel=s,h=function(){function n(n){typeof n=="undefined"&&(n=!0),this.initDefaultPageRoute=n,this.participants=ko.mapping.fromJS([]),this.officialNameDoesNotMatchTranslation=ko.computed(function(){return!(this.participants.establishmentOfficialName===this.participants.establishmentTranslatedName)}),this.isBound=ko.observable(),this.back=function(){history.back()},this.sideSwiper=new App.SideSwiper({speed:"",frameWidth:970,root:"[data-current-module=agreements]"}),this.owner=new e(!1),this.owner2=new e(!1),this.tenantDomain="uc.edu",this.spinner=new o.Spinner(new o.SpinnerOptions(400,!0)),this.establishmentSearchViewModel=new e,this.hasBoundSearch=!1,this.trail=ko.observableArray([]),this.nextForceDisabled=ko.observable(!1),this.prevForceDisabled=ko.observable(!1),this.pageNumber=ko.observable(),this.populateParticipants(),this.isBound(!0),this.removeParticipant=this.removeParticipant.bind(this),this.hideOtherGroups()}return n.prototype.receiveResults=function(n){n?ko.mapping.fromJS(n,this.participants):ko.mapping.fromJS({items:[],itemTotal:0},this.participants),this.spinner.stop()},n.prototype.populateParticipants=function(){var n=this;this.spinner.start(),$.get(App.Routes.WebApi.Agreements.Participants.get()).done(function(t){n.receiveResults(t)})},n.prototype.hideOtherGroups=function(){$("#estSearch").css("visibility","").hide(),$("#addEstablishment").css("visibility","").hide()},n.prototype.removeParticipant=function(n,t){if(confirm('Are you sure you want to remove "'+n.establishmentTranslatedName()+'" as a participant from this agreement?')){var i=this;i.participants.remove(function(t){return t.establishmentId()===n.establishmentId()&&$(t.participantEl).slideUp("fast",function(){i.participants.remove(t)}),!1})}return t.preventDefault(),t.stopPropagation(),!1},n.prototype.addParticipant=function(){var n=this;this.hasBoundSearch||(ko.applyBindings(this.establishmentSearchViewModel,$("#estSearch")[0]),this.establishmentSearchViewModel.sammy.bind("location-changed",function(){n.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf("agreements")>0&&$("#estSearch").fadeOut(500,function(){$("#allParticipants").fadeIn(500)})}),this.establishmentSearchViewModel.sammy.setLocation("Establishments/#/page/1/"),this.establishmentSearchViewModel.sammy.run()),this.hasBoundSearch=!0,this.establishmentSearchViewModel.detailTooltip=function(){return"Choose this establishment as a participant"};$("#cancelAddParticipant").on("click",function(){this.establishmentSearchViewModel.sammy.setLocation("Agreements/"),$("#estSearch").fadeOut(500,function(){$("#allParticipants").fadeIn(500)})});this.establishmentSearchViewModel.clickAction=function(t){for(var i=new s(!1,t.id(),t.officialName(),t.translatedName()),u=!1,r=0;r<n.participants().length;r++)if(n.participants()[r].establishmentId()===i.establishmentId()){u=!0;break}u!==!0?$.ajax({url:App.Routes.WebApi.Agreements.Participant.get(1),type:"GET",async:!1}).done(function(t){i.isOwner(t.isOwner),n.participants.push(i),$("#estSearch").fadeOut(500,function(){$("#allParticipants").fadeIn(500)})}).fail(function(){n.participants.push(i),$("#estSearch").fadeOut(500,function(){$("#allParticipants").fadeIn(500)})}):alert("This Participant has already been added.")};$("#searchSideBarAddNew").on("click",function(t){var i=$("#addEstablishment");return $("#estSearch").fadeOut(500,function(){i.css("visibility","").hide().fadeIn(500,function(){var t=new v;n.establishmentSearchViewModel.sammy.setLocation("agreements/new/#/"),ko.applyBindings(t,i[0])})}),t.preventDefault(),!1});$("#allParticipants").fadeOut(500,function(){$("#estSearch").fadeIn(500)})},n.prototype.swipeCallback=function(){},n.prototype.lockAnimation=function(){this.nextForceDisabled(!0),this.prevForceDisabled(!0)},n.prototype.unlockAnimation=function(){this.nextForceDisabled(!1),this.prevForceDisabled(!1)},n}(),t.InstitutionalAgreementEditModel=h})