define(["require","exports","../amd-modules/Establishments/SearchResult","../amd-modules/Establishments/Search","../amd-modules/Establishments/Item","../amd-modules/Widgets/Spinner","../../jquery/jquery.globalize/globalize.require"],function(n,t,i,r,u,f){var h=i,c=r,l=u,e=f,a=c.Search,v=l.Item,y=h.SearchResult,o,s;String.prototype.format||(String.prototype.format=function(){for(var t=this,i,n=0;n<arguments.length;n++)i=new RegExp("\\{"+n+"\\}","gi"),t=t.replace(i,arguments[n]);return t}),o=function(){function n(n,t,i,r){this.isOwner=ko.observable(n),this.establishmentId=ko.observable(t),this.establishmentOfficialName=ko.observable(i),this.establishmentTranslatedName=ko.observable(r)}return n}(),t.InstitutionalAgreementParticipantModel=o,s=function(){function t(t){var i,r;typeof t=="undefined"&&(t=!0),this.initDefaultPageRoute=t,i=this,this.selectConstructor=function(n,t){this.name=n,this.id=t},this.percentOffBodyHeight=.2,this.dfdPopParticipants=$.Deferred(),this.dfdPopContacts=$.Deferred(),this.dfdPopFiles=$.Deferred(),this.dfdPageFadeIn=$.Deferred(),this.agreementIsEdit=ko.observable(),this.visibility=ko.observable(),this.trail=ko.observableArray([]),this.nextForceDisabled=ko.observable(!1),this.prevForceDisabled=ko.observable(!1),this.pageNumber=ko.observable(),this.$typeOptions=ko.observable(),this.typeOptions=ko.mapping.fromJS([]),this.typeOptionSelected=ko.observable(),this.$statusOptions=ko.observable(),this.statusOptions=ko.mapping.fromJS([]),this.statusOptionSelected=ko.observable(),this.$contactTypeOptions=ko.observable(),this.contactTypeOptions=ko.mapping.fromJS([]),this.contactTypeOptionSelected=ko.observable(),this.contactsIsEdit=ko.observable(!1),this.contactFirstName=ko.observable(),this.contactLastName=ko.observable(),this.contactSuffix=ko.mapping.fromJS([]),this.contactSuffixSelected=ko.observable(),this.$$contactSuffix=ko.observable(),this.contactSalutation=ko.mapping.fromJS([]),this.contactSalutationSelected=ko.observable(),this.$$contactSalutation=ko.observable(),this.contactJobTitle=ko.observable(),this.contactPersonId=ko.observable(),this.contactDisplayName=ko.observable(),this.contactIndex=0,this.contactEmail=ko.observable(),this.contactMiddleName=ko.observable(),this.contactPhoneTextValue=ko.observable(""),this.contactPhoneType=ko.observable(),this.$addContactDialog=$("#addContactDialog"),this.$contactEmail=$("#contactEmail"),this.$contactLastName=$("#contactLastName"),this.$contactFirstName=$("#contactFirstName"),this.$contactSalutation=$("#contactSalutation"),this.$contactSuffix=$("#contactSuffix"),this.$uAgreements=ko.observable(),this.uAgreements=ko.mapping.fromJS([]),this.uAgreementSelected=ko.observable(""),this.nickname=ko.observable(),this.content=ko.observable(),this.startDate=ko.observable(),this.expDate=ko.observable(),this.isEstimated=ko.observable(),this.autoRenew=ko.observable(2),this.privateNotes=ko.observable(),this.agreementContent=ko.observable(),this.isCustomTypeAllowed=ko.observable(),this.isCustomStatusAllowed=ko.observable(),this.isCustomContactTypeAllowed=ko.observable(),this.phoneTypes=ko.mapping.fromJS([]),this.$phoneTypes=ko.observable(),this.phoneTypeSelected=ko.observable(),this.$file=ko.observable(),this.hasFile=ko.observable(),this.isFileExtensionInvalid=ko.observable(!1),this.isFileTooManyBytes=ko.observable(!1),this.isFileFailureUnexpected=ko.observable(!1),this.isFileInvalid=ko.observable(!1),this.fileError=ko.observable(),this.fileFileExtension=ko.observable(),this.fileFileName=ko.observable(),this.fileSrc=ko.observable(),this.fileUploadSpinner=new e.Spinner(new e.SpinnerOptions(400)),this.fileDeleteSpinner=new e.Spinner(new e.SpinnerOptions(400)),this.tempFileId=0,this.files=ko.mapping.fromJS([]),this.participantsExport=ko.mapping.fromJS([]),this.participants=ko.mapping.fromJS([]),this.participantsErrorMsg=ko.observable(),this.contacts=ko.mapping.fromJS([]),this.contactPhones=ko.mapping.fromJS([]),this.officialNameDoesNotMatchTranslation=ko.computed(function(){return!(this.participants.establishmentOfficialName===this.participants.establishmentTranslatedName)}),this.isBound=ko.observable(),this.back=function(){history.back()},this.sideSwiper=new App.SideSwiper({speed:"",frameWidth:970,root:"[data-current-module=agreements]"}),this.spinner=new e.Spinner(new e.SpinnerOptions(400,!0)),this.establishmentSearchViewModel=new a,this.hasBoundSearch=!1,this.hasBoundItem=!1,r=$("meta[name='accept-language']").attr("content"),window.location.href.toLowerCase().indexOf("agreements/new")>0?(n(["../../jquery/jquery.globalize/cultures/globalize.culture."+r+""],function(){Globalize.culture(r)}),this.dfdPopParticipants.resolve(),this.editOrNewUrl="new/",this.agreementIsEdit(!1),this.visibility("Public"),$("#LoadingPage").hide(),$.when(this.dfdPopParticipants,this.dfdPageFadeIn).done(function(){i.updateKendoDialog($(window).width()),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*i.percentOffBodyHeight)})):(this.editOrNewUrl=window.location.href.toLowerCase().substring(window.location.href.toLowerCase().indexOf("agreements/")+11),this.editOrNewUrl=this.editOrNewUrl.substring(0,this.editOrNewUrl.indexOf("/edit")+5)+"/",this.agreementIsEdit(!0),this.agreementId=this.editOrNewUrl.substring(0,this.editOrNewUrl.indexOf("/")),this.populateParticipants(),this.populateFiles(),this.populateContacts(),n(["../../jquery/jquery.globalize/cultures/globalize.culture."+r+""],function(){Globalize.culture(r),i.populateAgreementData()}),$("#LoadingPage").hide(),$.when(this.dfdPopContacts,this.dfdPopFiles,this.dfdPopParticipants,this.dfdPageFadeIn).done(function(){i.updateKendoDialog($(window).width()),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*i.percentOffBodyHeight)})),this.populateUmbrella(),$(window).resize(function(){i.updateKendoDialog($(window).width())}),this.isBound(!0),this.removeParticipant=this.removeParticipant.bind(this),this.editAContact=this.editAContact.bind(this),this.removeContact=this.removeContact.bind(this),this.removePhone=this.removePhone.bind(this),this.viewAFile=this.viewAFile.bind(this),this.downloadAFile=this.downloadAFile.bind(this),this.addPhone=this.addPhone.bind(this),this.closeEditAFile=this.closeEditAFile.bind(this),this.fileVisibilityClicked=this.fileVisibilityClicked.bind(this),this.removeFile=this.removeFile.bind(this),this._setupValidation=this._setupValidation.bind(this),this.participantsShowErrorMsg=ko.computed(function(){var n=!1,t=!1;return $.each(i.participants(),function(i,r){r.isOwner()==!0&&(n=!0),r.isOwner()==!1&&(t=!0)}),n==!1&&t==!1?(i.participantsErrorMsg("Home and Partner participants are required."),!0):n==!1?(i.participantsErrorMsg("Home participant is required."),!0):t==!1?(i.participantsErrorMsg("Partner participant is required."),!0):!1}),this.hideOtherGroups(),this.bindSearch(),this.getSettings(),this.contactSalutation=ko.mapping.fromJS([new this.selectConstructor("[None]",""),new this.selectConstructor("Dr.","Dr."),new this.selectConstructor("Mr.","Mr."),new this.selectConstructor("Ms.","Ms."),new this.selectConstructor("Mrs.","Mrs."),new this.selectConstructor("Prof.","Prof.")]),this.contactSuffix=ko.mapping.fromJS([new this.selectConstructor("[None]",""),new this.selectConstructor("Esq.","Esq."),new this.selectConstructor("Jr.","Jr."),new this.selectConstructor("PhD","PhD"),new this.selectConstructor("Sr.","Sr.")]),this.phoneTypes=ko.mapping.fromJS([new this.selectConstructor("[None]",""),new this.selectConstructor("home","home"),new this.selectConstructor("work","work"),new this.selectConstructor("mobile","mobile")]),this._setupValidation()}return t.prototype.receiveResults=function(n){n?ko.mapping.fromJS(n,this.participants):ko.mapping.fromJS({items:[],itemTotal:0},this.participants)},t.prototype.populateParticipants=function(){var n=this;$.get(App.Routes.WebApi.Agreements.Participants.get(this.agreementId)).done(function(t){n.receiveResults(t),n.dfdPopParticipants.resolve()})},t.prototype.populateAgreementData=function(){var n=this;$.get(App.Routes.WebApi.Agreements.get(this.agreementId)).done(function(t){var i;n.content(t.content),n.expDate(Globalize.format(new Date(t.expiresOn),"d")),n.startDate(Globalize.format(new Date(t.startsOn),"d")),t.isAutoRenew==null?n.autoRenew(2):n.autoRenew(t.isAutoRenew),n.nickname(t.name),n.privateNotes(t.notes),n.statusOptionSelected(t.status),n.visibility(t.visibility),n.isEstimated(t.isExpirationEstimated),ko.mapping.fromJS(t.participants,n.participants),n.dfdPopParticipants.resolve(),n.uAgreementSelected(t.umbrellaId),i=$("#uAgreements").data("kendoDropDownList"),i.select(function(t){return t.name===n.uAgreementSelected()}),i=n.isCustomStatusAllowed()?$("#statusOptions").data("kendoComboBox"):$("#statusOptions").data("kendoDropDownList"),i.select(function(t){return t.name===n.statusOptionSelected()}),n.typeOptionSelected(t.type),i=n.isCustomTypeAllowed()?$("#typeOptions").data("kendoComboBox"):$("#typeOptions").data("kendoDropDownList"),i.select(function(t){return t.name===n.typeOptionSelected()})})},t.prototype.populateFiles=function(){var n=this;$.get(App.Routes.WebApi.Agreements.Files.get(this.agreementId),{useTestData:!0}).done(function(t){$.each(t,function(t,i){n.files.push(ko.mapping.fromJS({id:i.id,originalName:i.originalName,customName:i.customName,visibility:i.visibility,isEdit:!1,customNameFile:i.customName.substring(0,i.customName.lastIndexOf(".")),customNameExt:i.customName.substring(i.customName.lastIndexOf("."),i.customName.length)}))}),n.dfdPopFiles.resolve()})},t.prototype.populateContacts=function(){var n=this;$.get(App.Routes.WebApi.Agreements.Contacts.get(this.agreementId),{useTestData:!0}).done(function(t){ko.mapping.fromJS(t,n.contacts),n.dfdPopContacts.resolve()})},t.prototype.populateUmbrella=function(){var n=this;$.get(App.Routes.WebApi.Agreements.UmbrellaOptions.get(this.agreementId)).done(function(t){n.uAgreements(t),$("#uAgreements").kendoDropDownList({dataTextField:"text",dataValueField:"value",optionLabel:"[None - this is a top-level or standalone agreement]",dataSource:new kendo.data.DataSource({data:n.uAgreements()})})})},t.prototype.$bindKendoFile=function(){var n=this,t="";t=this.agreementIsEdit()?App.Routes.WebApi.Agreements.Files.post(this.agreementId):App.Routes.WebApi.Uploads.post(),$("#fileUpload").kendoUpload({multiple:!0,showFileList:!1,localization:{select:"Choose a file to upload..."},select:function(t){var i=ko.mapping.toJS({Name:t.files[0].name,Length:t.files[0].rawFile.size}),r=App.Routes.WebApi.Agreements.Files.Validate.post();$.ajax({type:"POST",url:r,async:!1,data:i,success:function(){},error:function(i){i.status!==200&&(t.preventDefault(),n.isFileInvalid(!0),n.fileError(i.responseText))}})},async:{saveUrl:t},upload:function(t){n.agreementIsEdit()&&(t.data={originalName:t.files[0].name,visibility:"Private",customName:t.files[0].name,agreementId:n.agreementId}),t.isDefaultPrevented()||n.fileUploadSpinner.start()},complete:function(){n.fileUploadSpinner.stop()},success:function(t){var i,r;t.operation=="upload"&&(t.response&&t.response.message&&App.flasher.flash(t.response.message),n.agreementIsEdit()?(r=t.XMLHttpRequest!=undefined?t.XMLHttpRequest.getResponseHeader("Location"):t.response.location,i=parseInt(r.substring(r.lastIndexOf("/")+1))):i=n.tempFileId+.01,n.files.push(ko.mapping.fromJS({id:i,originalName:t.files[0].name,customName:t.files[0].name,visibility:"Public",guid:t.response.guid,isEdit:!1,customNameFile:t.files[0].name.substring(0,t.files[0].name.indexOf(t.files[0].extension)),customNameExt:t.files[0].extension})),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*.85))},error:function(t){var i,r;t.files&&t.files.length>0&&(i=t.files[0].name,r=t.files[0].extension),i&&n.fileFileName(i),r&&n.fileFileExtension(r),t.XMLHttpRequest.status===415?n.isFileExtensionInvalid(!0):t.XMLHttpRequest.status===413?n.isFileTooManyBytes(!0):n.isFileFailureUnexpected(!0)}})},t.prototype.removeFile=function(n,t){var r=this,i;confirm("Are you sure you want to remove this file from this agreement?")&&(i="",i=this.agreementIsEdit()?App.Routes.WebApi.Agreements.Files.del(this.agreementId,n.id()):App.Routes.WebApi.Uploads.del(n.guid()),$.ajax({url:i,type:"DELETE",success:function(){r.files.remove(n),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*1.1)}})),t.preventDefault(),t.stopPropagation()},t.prototype.editAFile=function(n){n.isEdit(!0)},t.prototype.cancelEditAFile=function(n,t){return n.customNameFile(n.customName().substring(0,n.customName().lastIndexOf("."))),n.isEdit(!1),t.stopImmediatePropagation(),!1},t.prototype.closeEditAFile=function(n){var t=this,i,r;n.customName(n.customNameFile()+n.customNameExt()),n.isEdit(!1),this.agreementIsEdit()&&(i=ko.mapping.toJS({agreementId:n.agreementId,uploadGuid:n.guid,originalName:n.guid,extension:n.extension,customName:n.customName,visibility:n.visibility}),r=App.Routes.WebApi.Agreements.Files.put(this.agreementId,n.id()),$.ajax({type:"PUT",url:r,data:i,success:function(){},error:function(n){t.spinner.stop(),n.status===400&&(t.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),t.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){t.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}}))},t.prototype.fileVisibilityClicked=function(n){var t=this,i,r;return this.agreementIsEdit()&&(i=ko.mapping.toJS({agreementId:n.agreementId,uploadGuid:n.guid,originalName:n.guid,extension:n.extension,customName:n.customName,visibility:n.visibility}),r=App.Routes.WebApi.Agreements.Files.put(this.agreementId,n.id()),$.ajax({type:"PUT",url:r,data:i,success:function(){},error:function(n){t.spinner.stop(),n.status===400&&(t.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),t.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){t.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}})),!0},t.prototype.downloadAFile=function(n){var t=App.Routes.WebApi.Agreements.Files.Content.download(this.agreementId,n.id());window.location.href=t},t.prototype.viewAFile=function(n){var t=App.Routes.WebApi.Agreements.Files.Content.view(this.agreementId,n.id());window.open(t,"_blank")},t.prototype.updateKendoDialog=function(n){$(".k-window").css({left:n/2-$(".k-window").width()/2+10})},t.prototype.bindjQueryKendo=function(n){function r(n,i){var r=n.dataItem(i.item.index());t.contactDisplayName(r.displayName),t.contactFirstName(r.firstName),t.contactLastName(r.lastName),t.contactEmail(r.defaultEmailAddress),t.contactMiddleName(r.middleName),t.contactPersonId(r.id),t.contactUserId=r.userId,t.contactSuffixSelected(r.suffix),t.contactSalutationSelected(r.salutation),r.userId!=null&&(t.$contactEmail.prop("disabled","disabled"),t.$contactLastName.prop("disabled","disabled"),t.$contactFirstName.prop("disabled","disabled"),$("#contactMiddleName").prop("disabled","disabled"),t.$contactSalutation.data("kendoDropDownList").enable(!1),t.$contactSuffix.data("kendoDropDownList").enable(!1)),t.validateContact.errors.showAllMessages(!0)}var t=this,i;for(this.isCustomTypeAllowed(n.isCustomTypeAllowed),this.isCustomStatusAllowed(n.isCustomStatusAllowed),this.isCustomContactTypeAllowed(n.isCustomContactTypeAllowed),this.statusOptions.push(new this.selectConstructor("","")),this.contactTypeOptions.push(new this.selectConstructor("",undefined)),this.typeOptions.push(new this.selectConstructor("","")),i=0;i<n.statusOptions.length;i++)this.statusOptions.push(new this.selectConstructor(n.statusOptions[i],n.statusOptions[i]));for(i=0;i<n.contactTypeOptions.length;i++)this.contactTypeOptions.push(new this.selectConstructor(n.contactTypeOptions[i],n.contactTypeOptions[i]));for(i=0;i<n.typeOptions.length;i++)this.typeOptions.push(new this.selectConstructor(n.typeOptions[i],n.typeOptions[i]));this.isCustomTypeAllowed?$("#typeOptions").kendoComboBox({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.typeOptions()})}):$("#typeOptions").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.typeOptions()})}),this.isCustomStatusAllowed?$("#statusOptions").kendoComboBox({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.statusOptions()})}):$("#statusOptions").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.statusOptions()})}),this.isCustomContactTypeAllowed?$("#contactTypeOptions").kendoComboBox({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.contactTypeOptions()})}):$("#contactTypeOptions").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.contactTypeOptions()})}),this.$contactSalutation.kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.contactSalutation())})}),this.$contactSuffix.kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.contactSuffix())})}),$(".hasDate").each(function(n,t){$(t).kendoDatePicker({value:new Date($(t).val()),change:function(n){this.value()!=null&&$(n.sender.element).val(Globalize.format(this.value(),"d"))},close:function(n){this.value()!=null&&$(n.sender.element).val(Globalize.format(this.value(),"d"))}})}),this.$bindKendoFile(),$("#helpExpDate").kendoTooltip({width:520,position:"top",content:$("#templateExpToolTip").html(),showOn:"click",autoHide:!1}),this.contactPhoneTextValue.subscribe(function(){t.contactPhoneTextValue().length>0&&(t.contactPhones.push(ko.mapping.fromJS({type:t.contactPhoneType(),value:t.contactPhoneTextValue()})),t.contactPhoneTextValue(""),$(".phoneTypes").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(t.phoneTypes())})}))}),this.$addContactDialog.kendoWindow({width:950,close:function(){$("#addAContact").fadeIn(500),t.clearContactInfo()},visible:!1,draggable:!1,resizable:!1}),$(".k-window").css({position:"fixed",margin:"auto",top:"20px"}),this.$contactEmail.kendoAutoComplete({dataTextField:"defaultEmailAddress",minLength:3,filter:"contains",ignoreCase:!0,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){$.ajax({url:App.Routes.WebApi.People.get(),data:{email:t.contactEmail(),emailMatch:"startsWith"},success:function(t){n.success(t.items)}})}}}),select:function(n){r(t.$contactEmail.data("kendoAutoComplete"),n)}}),this.$contactLastName.kendoAutoComplete({dataTextField:"lastName",template:"#=displayName#",minLength:3,filter:"contains",ignoreCase:!0,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){$.ajax({url:App.Routes.WebApi.People.get(),data:{lastName:t.contactLastName(),lastNameMatch:"startsWith"},success:function(t){n.success(t.items)}})}}}),select:function(n){r(t.$contactLastName.data("kendoAutoComplete"),n)}}),this.$contactFirstName.kendoAutoComplete({dataTextField:"firstName",template:"#=displayName#",minLength:3,filter:"contains",ignoreCase:!0,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){$.ajax({url:App.Routes.WebApi.People.get(),data:{firstName:t.contactFirstName(),firstNameMatch:"startsWith"},success:function(t){n.success(t.items)}})}}}),select:function(n){r(t.$contactFirstName.data("kendoAutoComplete"),n)}}),$(window).scroll(function(){var t=$("#participants"),i=$("#basicInfo"),r=$("#effectiveDatesCurrentStatus"),u=$("#contacts"),f=$("#fileAttachments"),c=$("#overallVisibility"),l=$("#navParticipants"),a=$("#navBasicInfo"),v=$("#navEffectiveDatesCurrentStatus"),y=$("#navContacts"),p=$("#navFileAttachments"),w=$("#navOverallVisibility"),b=t.offset(),e=i.offset(),o=r.offset(),s=u.offset(),h=f.offset(),k=c.offset(),n;n=$("body").scrollTop()?$("body").scrollTop()+100:$("html, body").scrollTop()+100,n<=b.top+t.height()+40?($("aside").find("li").removeClass("current"),l.addClass("current")):n>=e.top&&n<=e.top+i.height()+40?($("aside").find("li").removeClass("current"),a.addClass("current")):n>=o.top&&n<=o.top+r.height()+40?($("aside").find("li").removeClass("current"),v.addClass("current")):n>=s.top&&n<=s.top+u.height()+40?($("aside").find("li").removeClass("current"),y.addClass("current")):n>=h.top&&n<=h.top+f.height()+40?($("aside").find("li").removeClass("current"),p.addClass("current")):n>=k.top&&($("aside").find("li").removeClass("current"),w.closest("li").addClass("current"))}),$("#agreementContent").kendoEditor({tools:["bold","italic","underline","strikethrough","fontName","foreColor","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","subscript","superscript","viewHtml",{name:"formatting",items:[{text:"Paragraph",value:"p"},{text:"Quotation",value:"blockquote"},{text:"Heading 2",value:"h2"},{text:"Heading 3",value:"h3"},{text:"Heading 4",value:"h4"},{text:"Heading 5",value:"h5"},{text:"Heading 6",value:"h6"}],width:"200px"}]})},t.prototype.getSettings=function(){var _this=this,url="App.Routes.WebApi.Agreements.Settings.get()",agreementSettingsGet;$.ajax({url:eval(url),type:"GET"}).done(function(n){_this.bindjQueryKendo(n)}).fail(function(n){alert("fail: status = "+n.status+" "+n.statusText+'; message = "'+n.responseText+'"')})},t.prototype.hideOtherGroups=function(){$("#allParticipants").css("visibility","").hide(),$("#estSearch").css("visibility","").hide(),$("#addEstablishment").css("visibility","").hide()},t.prototype.removeParticipant=function(n,t){if(confirm('Are you sure you want to remove "'+n.establishmentTranslatedName()+'" as a participant from this agreement?')){var i=this;i.participants.remove(function(t){return t.establishmentId()===n.establishmentId()&&$(t.participantEl).slideUp("fast",function(){i.participants.remove(t),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*1.1)}),!1})}return t.preventDefault(),t.stopPropagation(),!1},t.prototype.SearchPageBind=function(n){var t=this,i=$("#cancelAddParticipant"),r=$("#searchSideBarAddNew");this.establishmentSearchViewModel.detailTooltip=function(){return"Choose this establishment as a "+n},i.off(),r.off();r.on("click",function(n){return t.establishmentSearchViewModel.sammy.setLocation("#/new/"),n.preventDefault(),!1});if(n==="parent")i.on("click",function(n){return t.percentOffBodyHeight=.2,t.establishmentSearchViewModel.sammy.setLocation("#/new/"),n.preventDefault(),!1});else i.on("click",function(n){return t.percentOffBodyHeight=.2,t.establishmentSearchViewModel.sammy.setLocation("#/index"),n.preventDefault(),!1});var u=$.Deferred(),f=$.Deferred(),e=$("#allParticipants"),o=$("#addEstablishment");this.fadeModsOut(u,f,e,o,500),$.when(u,f).done(function(){$("#estSearch").fadeIn(500,function(){})})},t.prototype.fadeModsOut=function(n,t,i,r,u){i.css("display")!=="none"?i.fadeOut(u,function(){n.resolve()}):n.resolve(),r.css("display")!=="none"?r.fadeOut(u,function(){t.resolve()}):t.resolve()},t.prototype.scrollMyBody=function(n){$("body").scrollTop()?$("body").scrollTop(n):$("html, body").scrollTop(n)},t.prototype.bindSearch=function(){var n=this,t;this.hasBoundSearch||(this.establishmentSearchViewModel.sammyBeforeRoute=/\#\/index\/(.*)\//,this.establishmentSearchViewModel.sammyGetPageRoute="#/index",this.establishmentSearchViewModel.sammyDefaultPageRoute="/agreements[/]?",ko.applyBindings(this.establishmentSearchViewModel,$("#estSearch")[0]),t="asdf",this.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf("#")===-1&&(this.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf(""+this.editOrNewUrl+"")===-1?this.establishmentSearchViewModel.sammy.setLocation("/agreements/"+this.editOrNewUrl+"#/index"):this.establishmentSearchViewModel.sammy.setLocation("#/index")),sessionStorage.getItem("addest")==undefined&&sessionStorage.setItem("addest","no"),this.establishmentSearchViewModel.sammy.bind("location-changed",function(){var u,f;if(n.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf(t)<0)if(u=$("#asideRootSearch"),f=$("#asideParentSearch"),n.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf(""+n.editOrNewUrl+"#/new/")>0){var c=$("#addEstablishment"),i=$.Deferred(),r=$.Deferred(),e=$("#estSearch"),s=$("#allParticipants"),h=500;n.fadeModsOut(i,r,e,s,h),$.when(i,r).done(function(){c.css("visibility","").hide().fadeIn(500,function(){if(!n.hasBoundItem){n.establishmentItemViewModel=new v,n.establishmentItemViewModel.goToSearch=function(){sessionStorage.setItem("addest","yes"),n.establishmentSearchViewModel.sammy.setLocation("#/page/1/")},n.establishmentItemViewModel.submitToCreate=function(t){var e;if(!n.establishmentItemViewModel.id||n.establishmentItemViewModel.id===0){e=n.establishmentItemViewModel,n.establishmentItemViewModel.validatingSpinner.start();var i=n.establishmentItemViewModel.names()[0],r=n.establishmentItemViewModel.urls()[0],o=n.establishmentItemViewModel.location;if(i.text.isValidating()||r.value.isValidating()||n.establishmentItemViewModel.ceebCode.isValidating()||n.establishmentItemViewModel.uCosmicCode.isValidating())return setTimeout(function(){var i=n.establishmentItemViewModel.submitToCreate(t);return!1},50),!1;if(n.establishmentItemViewModel.isValidationSummaryVisible(!0),n.establishmentItemViewModel.isValid()||n.establishmentItemViewModel.errors.showAllMessages(),i.isValid()||i.errors.showAllMessages(),r.isValid()||r.errors.showAllMessages(),n.establishmentItemViewModel.validatingSpinner.stop(),i.isValid()&&r.isValid()&&n.establishmentItemViewModel.isValid()){var f=$("#LoadingPage").find("strong"),s=App.Routes.WebApi.Establishments.post(),u=n.establishmentItemViewModel.serializeData();f.text("Creating Establishment..."),u.officialName=i.serializeData(),u.officialUrl=r.serializeData(),u.location=o.serializeData(),n.establishmentItemViewModel.createSpinner.start(),$.post(s,u).done(function(){n.establishmentItemViewModel.createSpinner.stop(),f.text("Establishment created, you are being redirected to previous page..."),$("#addEstablishment").fadeOut(500,function(){n.percentOffBodyHeight=.2,$("#LoadingPage").fadeIn(500),setTimeout(function(){$("#LoadingPage").fadeOut(500,function(){f.text("Loading Page...")}),n.establishmentSearchViewModel.sammy.setLocation("#/page/1/")},5e3)})}).fail(function(t){t.status===400&&(n.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(t.responseText.replace("\n","<br /><br />")),n.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){n.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))})}}return!1},ko.applyBindings(n.establishmentItemViewModel,c[0]);var t=$("#cancelAddEstablishment");t.on("click",function(t){return sessionStorage.setItem("addest","no"),n.establishmentSearchViewModel.sammy.setLocation("#/page/1/"),t.preventDefault(),!1});n.hasBoundItem=!0}})}),n.scrollMyBody(0),t="#/new/"}else if(n.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf(""+n.editOrNewUrl+"#/page/")>0)sessionStorage.getItem("addest")==="yes"?(n.establishmentSearchViewModel.clickAction=function(t){n.establishmentItemViewModel.parentEstablishment(t),n.establishmentItemViewModel.parentId(t.id()),n.establishmentSearchViewModel.sammy.setLocation("#/new/")},n.establishmentSearchViewModel.header("Choose a parent establishment"),u.hide(),f.show(),n.SearchPageBind("parent"),n.establishmentSearchViewModel.header("Choose a parent establishment")):(u.show(),f.hide(),n.SearchPageBind("participant"),n.establishmentSearchViewModel.header("Choose a participant"),n.establishmentSearchViewModel.clickAction=function(t){for(var i=new o(!1,t.id(),t.officialName(),t.translatedName()),u=!1,r=0;r<n.participants().length;r++)if(n.participants()[r].establishmentId()===i.establishmentId()){u=!0;break}u!==!0?$.ajax({url:App.Routes.WebApi.Agreements.Participants.get(0,i.establishmentId()),type:"GET",async:!1}).done(function(t){i.isOwner(t.isOwner),n.participants.push(i),n.percentOffBodyHeight=.2,n.establishmentSearchViewModel.sammy.setLocation("agreements/"+n.editOrNewUrl+""),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*.85)}).fail(function(){n.percentOffBodyHeight=.2,n.participants.push(i),n.establishmentSearchViewModel.sammy.setLocation("agreements/"+n.editOrNewUrl+"")}):alert("This Participant has already been added.")}),n.scrollMyBody(0),t="#/page/";else if(n.establishmentSearchViewModel.sammy.getLocation().toLowerCase().indexOf("agreements/"+n.editOrNewUrl+"")>0){sessionStorage.setItem("addest","no"),t="#/index",n.establishmentSearchViewModel.sammy.setLocation("#/index");var i=$.Deferred(),r=$.Deferred(),e=$("#estSearch"),s=$("#addEstablishment"),h=500;n.fadeModsOut(i,r,e,s,h),$.when(i,r).done(function(){$("#allParticipants").fadeIn(500).promise().done(function(){$(n).show(),n.scrollMyBody(0),n.dfdPageFadeIn.resolve()})})}else window.location.replace(n.establishmentSearchViewModel.sammy.getLocation())}),this.establishmentSearchViewModel.sammy.run())},t.prototype.editAContact=function(n){var t;this.$addContactDialog.data("kendoWindow").open().title("Edit Contact"),this.contactsIsEdit(!0),this.contactEmail(n.emailAddress()),this.contactDisplayName(n.displayName()),this.contactPersonId(n.personId()),this.contactUserId=n.userId(),this.contactJobTitle(n.title()),this.contactFirstName(n.firstName()),this.contactLastName(n.lastName()),this.contactPhones(n.phones()),this.contactMiddleName(n.middleName()),this.contactIndex=this.contacts.indexOf(n),n.userId()!=null&&(this.$contactEmail.prop("disabled",!0),this.$contactLastName.prop("disabled",!0),this.$contactFirstName.prop("disabled",!0),$("#contactMiddleName").prop("disabled",!0),this.$contactSalutation.data("kendoDropDownList").enable(!1),this.$contactSuffix.data("kendoDropDownList").enable(!1)),this.contactTypeOptionSelected(n.type()),t=this.isCustomContactTypeAllowed?$("#contactTypeOptions").data("kendoComboBox"):$("#contactTypeOptions").data("kendoDropDownList"),t.select(function(t){return t.name===n.type()}),t=$("#contactSuffix").data("kendoDropDownList"),t.select(function(t){return t.name===n.suffix()}),t=$("#contactSalutation").data("kendoDropDownList"),t.select(function(t){return t.name===n.salutation()}),$("#addAContact").fadeOut(500,function(){}),$("input.phoneTypes").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.phoneTypes())})}),$("input.phoneTypes").each(function(i){t=$(this).data("kendoDropDownList"),t.select(function(t){return t.name===n.phones()[i].type()})})},t.prototype.clearContactInfo=function(){var n;this.contactEmail(""),this.contactDisplayName(""),this.contactPersonId(""),this.contactUserId="",this.contactJobTitle(""),this.contactFirstName(""),this.contactMiddleName(""),this.contactLastName(""),this.contactPhones(""),this.contactTypeOptionSelected(""),n=this.isCustomContactTypeAllowed?$("#contactTypeOptions").data("kendoComboBox"):$("#contactTypeOptions").data("kendoDropDownList"),n.select(0),n=$("#contactSalutation").data("kendoDropDownList"),n.select(0),n=$("#contactSuffix").data("kendoDropDownList"),n.select(0)},t.prototype.editContact=function(){var n=this,t,i,r;this.validateContact.isValid()?(this.contactsIsEdit(!1),this.contacts()[this.contactIndex].emailAddress(this.contactEmail()),this.contacts()[this.contactIndex].title(this.contactJobTitle()),this.contacts()[this.contactIndex].displayName(this.contactDisplayName()),this.contacts()[this.contactIndex].personId(this.contactPersonId()),this.contacts()[this.contactIndex].userId(this.contactUserId),this.contacts()[this.contactIndex].firstName(this.contactFirstName()),this.contacts()[this.contactIndex].lastName(this.contactLastName()),this.contacts()[this.contactIndex].middleName(this.contactMiddleName()),this.contacts()[this.contactIndex].phones(this.contactPhones()),this.contacts()[this.contactIndex].type(this.contactTypeOptionSelected()),this.contacts()[this.contactIndex].salutation(this.contactSalutationSelected()),this.contacts()[this.contactIndex].suffix(this.contactSuffixSelected()),this.$addContactDialog.data("kendoWindow").close(),$("#addAContact").fadeIn(500),this.agreementIsEdit()&&(this.contacts()[this.contactIndex].agreementId(this.agreementId),t=[],$.each(this.contacts()[this.contactIndex].phones(),function(n,i){var r=ko.mapping.toJS({contactId:i.contactId,type:i.type,value:i.value});t.push(r)}),i={agreementId:this.contacts()[this.contactIndex].agreementId(),PersonId:this.contacts()[this.contactIndex].personId(),Type:this.contacts()[this.contactIndex].type(),DisplayName:this.contacts()[this.contactIndex].displayName(),FirstName:this.contacts()[this.contactIndex].firstName(),MiddleName:this.contacts()[this.contactIndex].middleName(),LastName:this.contacts()[this.contactIndex].lastName(),Suffix:this.contacts()[this.contactIndex].suffix(),EmailAddress:this.contacts()[this.contactIndex].emailAddress(),PersonId:this.contacts()[this.contactIndex].personId(),Phones:t},r=App.Routes.WebApi.Agreements.Contacts.put(this.agreementId,this.contacts()[this.contactIndex].id()),$.ajax({type:"PUT",url:r,data:i,success:function(){},error:function(t){n.spinner.stop(),t.status===400&&(n.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(t.responseText.replace("\n","<br /><br />")),n.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){n.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}}))):this.validateContact.errors.showAllMessages(!0)},t.prototype.addContact=function(){var n=this,t,i;this.validateContact.isValid()?((this.contactDisplayName()==undefined||this.contactDisplayName()=="")&&this.contactDisplayName(this.contactFirstName()+" "+this.contactLastName()),t={agreementId:this.agreementId,title:this.contactJobTitle(),firstName:this.contactFirstName(),lastName:this.contactLastName(),id:1,personId:this.contactPersonId(),userId:this.contactUserId,phones:ko.mapping.toJS(this.contactPhones()),emailAddress:this.contactEmail(),type:this.contactTypeOptionSelected(),suffix:this.contactSuffixSelected(),salutation:this.contactSalutationSelected(),displayName:this.contactDisplayName(),middleName:this.contactMiddleName},this.contacts.push(ko.mapping.fromJS(t)),this.$addContactDialog.data("kendoWindow").close(),$("#addAContact").fadeIn(500),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*.85),this.agreementIsEdit()&&(i=App.Routes.WebApi.Agreements.Contacts.post(this.agreementId),$.post(i,t).done(function(){}).fail(function(t){n.spinner.stop(),t.status===400&&(n.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(t.responseText.replace("\n","<br /><br />")),n.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){n.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}))):this.validateContact.errors.showAllMessages(!0)},t.prototype.addAContact=function(){this.contactsIsEdit(!1),this.$contactEmail.prop("disabled",!1),this.$contactLastName.prop("disabled",!1),this.$contactFirstName.prop("disabled",!1),$("#contactMiddleName").prop("disabled",!1),this.$contactSalutation.data("kendoDropDownList").enable(!0),this.$contactSuffix.data("kendoDropDownList").enable(!0),this.validateContact.errors.showAllMessages(!1),this.$addContactDialog.data("kendoWindow").open().title("Add Contact"),$("#addAContact").fadeOut(500,function(){})},t.prototype.cancelContact=function(){this.$addContactDialog.data("kendoWindow").close(),$("#addAContact").fadeIn(500)},t.prototype.clearContact=function(){this.clearContactInfo();var n=$("#contactEmail"),t=$("#contactLastName"),i=$("#contactFirstName"),r=$("#contactSalutation"),u=$("#contactSuffix");n.prop("disabled",!1),t.prop("disabled",!1),i.prop("disabled",!1),$("#contactMiddleName").prop("disabled",!1),r.data("kendoComboBox").enable(!0),u.data("kendoDropDownList").enable(!0),this.validateContact.errors.showAllMessages(!1)},t.prototype.removeContact=function(n,t){return confirm('Are you sure you want to remove "'+n.firstName()+" "+n.lastName()+'" as a contact from this agreement?')&&(this.contacts.remove(n),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*1.1)),t.preventDefault(),t.stopPropagation(),!1},t.prototype.removePhone=function(n,t){this.contactPhones.remove(n),t.preventDefault(),t.stopPropagation()},t.prototype.addPhone=function(){this.contactPhoneTextValue().length>0&&(this.contactPhones.push(ko.mapping.fromJS({type:"",value:this.contactPhoneTextValue()})),this.contactPhoneTextValue(""),$(".phoneTypes").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.phoneTypes())})}))},t.prototype.addParticipant=function(){this.establishmentSearchViewModel.sammy.setLocation("#/page/1/"),this.hasBoundSearch=!0},t.prototype.swipeCallback=function(){},t.prototype.lockAnimation=function(){this.nextForceDisabled(!0),this.prevForceDisabled(!0)},t.prototype.unlockAnimation=function(){this.nextForceDisabled(!1),this.prevForceDisabled(!1)},t.prototype._setupValidation=function(){ko.validation.rules.greaterThan={validator:function(n,t){return t()==undefined?!0:Globalize.parseDate(n)>Globalize.parseDate(t())},message:"The field must be greater than start date"},ko.validation.rules.date.validator=function(n,t){return!n.length||t&&Globalize.parseDate(n)!=null},ko.validation.registerExtenders(),this.validateEffectiveDatesCurrentStatus=ko.validatedObservable({startDate:this.startDate.extend({required:{message:"Start date is required."},date:{message:"Start date must valid."},maxLength:50}),expDate:this.expDate.extend({required:{message:"Expiration date is required."},date:{message:"Expiration date must valid."},maxLength:50,greaterThan:this.startDate}),autoRenew:this.autoRenew.extend({required:{message:"Auto renew is required."}}),statusOptionSelected:this.statusOptionSelected.extend({required:{message:"Current Status is required."}})}),this.validateBasicInfo=ko.validatedObservable({agreementType:this.typeOptionSelected.extend({required:{message:"Agreement type is required."},maxLength:50}),nickname:this.nickname.extend({maxLength:50}),content:this.content.extend({maxLength:5e3}),privateNotes:this.privateNotes.extend({maxLength:250})}),this.validateContact=ko.validatedObservable({contactSalutation:this.contactSalutation.extend({maxLength:50}),contactFirstName:this.contactFirstName.extend({required:{message:"First name is required."},maxLength:50}),contactTypeOptionSelected:this.contactTypeOptionSelected.extend({required:{message:"Contact type is required."},maxLength:50}),contactLastName:this.contactLastName.extend({required:{message:"Last name is required."},maxLength:50}),contactEmail:this.contactEmail.extend({required:{message:"Email is required.",maxLength:100}}).extend({pattern:{message:"Email is in wrong format.",params:"^(?:(?!Email).)*$"}}),contactSuffix:this.contactSuffix.extend({maxLength:50}),contactJobTitle:this.contactJobTitle.extend({maxLength:50})})},t.prototype.goToSection=function(n,t,i){var r=$("#"+n).offset();$("body").scrollTop()?$("body").scrollTop(r.top-20):$("html, body").scrollTop(r.top-20),$(i.target).closest("ul").find("li").removeClass("current"),$(i.target).closest("li").addClass("current")},t.prototype.postMe=function(n,t){var i=this;$.post(t,n).done(function(){}).fail(function(n){i.spinner.stop(),n.status===400&&(i.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),i.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){i.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))})},t.prototype.agreementPostFiles=function(){var n=this,t=App.Routes.WebApi.Agreements.Files.post(this.agreementId);$.each(this.files(),function(i,r){var u=ko.mapping.toJS({agreementId:r.agreementId,uploadGuid:r.guid,originalName:r.guid,extension:r.extension,customName:r.customName,visibility:r.visibility});n.postMe(u,t)}),this.spinner.stop()},t.prototype.agreementPostContacts=function(){var n=this,t=App.Routes.WebApi.Agreements.Contacts.post(this.agreementId);$.each(this.contacts(),function(i,r){var u=ko.mapping.toJS({agreementId:n.agreementId,PersonId:r.personId,Type:r.type,DisplayName:r.displayName,FirstName:r.firstName,MiddleName:r.middleName,LastName:r.lastName,Suffix:r.suffix,EmailAddress:r.emailAddress,PersonId:r.personId,Phones:r.phones});n.postMe(u,t)})},t.prototype.saveUpdateAgreement=function(){var n=this,t,r,i,u;this.validateEffectiveDatesCurrentStatus.isValid()||(t=$("#effectiveDatesCurrentStatus").offset(),this.validateEffectiveDatesCurrentStatus.errors.showAllMessages(!0),$("#navEffectiveDatesCurrentStatus").closest("ul").find("li").removeClass("current"),$("#navEffectiveDatesCurrentStatus").addClass("current")),this.validateBasicInfo.isValid()||(t=$("#basicInfo").offset(),this.validateBasicInfo.errors.showAllMessages(!0),$("#navValidateBasicInfo").closest("ul").find("li").removeClass("current"),$("#navValidateBasicInfo").addClass("current")),$("#participantsErrorMsg").show(),this.participantsShowErrorMsg()&&(t=$("#participants").offset(),$("#navParticipants").closest("ul").find("li").removeClass("current"),$("#navParticipants").addClass("current")),t!=undefined?$("body").scrollTop()?$("body").scrollTop(t.top-20):$("html, body").scrollTop(t.top-20):(i=$("#LoadingPage").find("strong"),this.spinner.start(),$("body").scrollTop()?$("body").scrollTop(0):$("html, body").scrollTop(0),i=$("#LoadingPage").find("strong"),i.text("Saving agreement..."),$("#allParticipants").show().fadeOut(500,function(){$("#LoadingPage").hide().fadeIn(500)}),$.each(this.participants(),function(t,i){n.participantsExport.push({agreementId:i.agreementId,establishmentId:i.establishmentId,establishmentOfficialName:i.establishmentOfficialName,establishmentTranslatedName:i.establishmentTranslatedName,isOwner:i.isOwner,center:i.center})}),u=ko.mapping.toJS({content:this.content(),expiresOn:this.expDate(),startsOn:this.startDate(),isAutoRenew:this.autoRenew(),name:this.nickname(),notes:this.privateNotes(),status:this.statusOptionSelected(),visibility:this.visibility(),isExpirationEstimated:this.isEstimated(),participants:this.participantsExport,umbrellaId:this.uAgreementSelected(),type:this.typeOptionSelected()}),this.agreementIsEdit()?(r=App.Routes.WebApi.Agreements.put(this.agreementId),$.ajax({type:"PUT",url:r,data:u,success:function(){i.text("Agreement Saved..."),setTimeout(function(){$("#LoadingPage").show().fadeOut(500,function(){$("#allParticipants").hide().fadeIn(500)})},5e3)},error:function(t){n.spinner.stop(),t.status===400&&(n.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(t.responseText.replace("\n","<br /><br />")),n.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){n.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}})):(r=App.Routes.WebApi.Agreements.post(),$.post(r,u).done(function(t,r,u){n.agreementPostFiles(t,r,u),n.agreementPostContacts(t,r,u),i.text("Agreement Saved..."),setTimeout(function(){$("#LoadingPage").fadeOut(500,function(){u!=undefined?(window.location.hash="",window.location.href="/agreements/"+u.getResponseHeader("Location").substring(u.getResponseHeader("Location").lastIndexOf("/")+1)+"/edit/"):alert("success, but no location")})},5e3)}).fail(function(t){n.spinner.stop(),t.status===400&&(n.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(t.responseText.replace("\n","<br /><br />")),n.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){n.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))})))},t}(),t.InstitutionalAgreementEditModel=s})