var Agreements;(function(n){var t=function(){function n(n,t){this.name=n,this.id=t,this.name=n,this.id=t}return n}(),i;n.SelectConstructor=t,i=function(){function i(i,r,u,f,e,o){this.$contactTypeOptions=ko.observable(),this.contactTypeOptions=ko.mapping.fromJS([]),this.contactTypeOptionSelected=ko.observable(),this.contactsIsEdit=ko.observable(!1),this.contactFirstName=ko.observable(),this.contactLastName=ko.observable(),this.contactId=ko.observable(),this.contactSuffix=ko.mapping.fromJS([]),this.contactSuffixSelected=ko.observable(),this.$$contactSuffix=ko.observable(),this.contactSalutation=ko.mapping.fromJS([]),this.contactSalutationSelected=ko.observable(),this.$$contactSalutation=ko.observable(),this.contactJobTitle=ko.observable(),this.contactPersonId=ko.observable(),this.contactUserId=ko.observable(),this.contactDisplayName=ko.observable(),this.contactIndex=0,this.contactEmail=ko.observable(),this.contactMiddleName=ko.observable(),this.$addContactDialog=$("#addContactDialog"),this.$contactEmail=$("#contactEmail"),this.$contactLastName=$("#contactLastName"),this.$contactFirstName=$("#contactFirstName"),this.$contactSalutation=$("#contactSalutation"),this.$contactSuffix=$("#contactSuffix"),this.contacts=ko.mapping.fromJS([]),this.agreementId=f,this.phones=new n.Phones(f,r,this.contactId),this.isCustomContactTypeAllowed=i,this.establishmentItemViewModel=r,this.agreementIsEdit=u,this.kendoWindowBug=e,this.deferredPopContacts=o,this._setupValidation=this._setupValidation.bind(this),this.editAContact=this.editAContact.bind(this),this.removeContact=this.removeContact.bind(this),this.populateContacts=this.populateContacts.bind(this),this.contactSalutation=ko.mapping.fromJS([new t("[None]",""),new t("Dr.","Dr."),new t("Mr.","Mr."),new t("Ms.","Ms."),new t("Mrs.","Mrs."),new t("Prof.","Prof.")]),this.contactSuffix=ko.mapping.fromJS([new t("[None]",""),new t("Esq.","Esq."),new t("Jr.","Jr."),new t("PhD","PhD"),new t("Sr.","Sr.")]),this._setupValidation()}return i.prototype.editAContact=function(n){var r=this,t,i;this.$addContactDialog.data("kendoWindow").open().title("Edit Contact"),this.contactsIsEdit(!0),this.contactEmail(n.emailAddress()),this.contactDisplayName(n.displayName()),this.contactPersonId(n.personId()),this.contactUserId(n.userId()),this.contactId(n.id()),this.contactJobTitle(n.title()),this.contactFirstName(n.firstName()),this.contactLastName(n.lastName()),$.each(n.phones(),function(n,t){i=ko.mapping.toJS({id:t.id,contactId:t.contactId,type:t.type,value:t.value}),i.type==null&&(i.type=""),r.phones.contactPhones.push(i)}),this.contactMiddleName(n.middleName()),this.contactIndex=this.contacts.indexOf(n),n.userId()!=null&&(this.$contactEmail.prop("disabled","disabled"),this.$contactLastName.prop("disabled","disabled"),this.$contactFirstName.prop("disabled","disabled"),$("#contactMiddleName").prop("disabled","disabled"),this.$contactSalutation.data("kendoDropDownList").enable(!1),this.$contactSuffix.data("kendoDropDownList").enable(!1)),this.contactTypeOptionSelected(n.type()),t=this.isCustomContactTypeAllowed?$("#contactTypeOptions").data("kendoComboBox"):$("#contactTypeOptions").data("kendoDropDownList"),t.select(function(t){return t.name===n.type()}),t=$("#contactSuffix").data("kendoDropDownList"),t.select(function(t){return t.name===n.suffix()}),t=$("#contactSalutation").data("kendoDropDownList"),t.select(function(t){return t.name===n.salutation()}),$("#addAContact").fadeOut(500),$("input.phoneTypes").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.phones.phoneTypes())})}),$("input.phoneTypes").each(function(i){t=$(this).data("kendoDropDownList"),t.select(function(t){return t.name===n.phones()[i].type()})})},i.prototype.editContact=function(){var n=this,t,i;this.validateContact.isValid()?(this.contactsIsEdit(!1),this.contacts()[this.contactIndex].emailAddress(this.contactEmail()),this.contacts()[this.contactIndex].title(this.contactJobTitle()),this.contactUserId()!=null?this.contacts()[this.contactIndex].displayName(this.contactDisplayName()):this.contacts()[this.contactIndex].displayName(this.contactFirstName()+" "+this.contactLastName()),this.contacts()[this.contactIndex].personId(this.contactPersonId()),this.contacts()[this.contactIndex].userId(this.contactUserId()),this.contacts()[this.contactIndex].firstName(this.contactFirstName()),this.contacts()[this.contactIndex].lastName(this.contactLastName()),this.contacts()[this.contactIndex].middleName(this.contactMiddleName()),this.contacts()[this.contactIndex].phones.removeAll(),$.each(this.phones.contactPhones(),function(i,r){t=ko.mapping.toJS({id:r.id,contactId:r.contactId,type:r.type,value:r.value}),n.contacts()[n.contactIndex].phones.push(ko.mapping.fromJS(t))}),this.contacts()[this.contactIndex].type(this.contactTypeOptionSelected()),this.contacts()[this.contactIndex].salutation(this.contactSalutationSelected()),this.contacts()[this.contactIndex].suffix(this.contactSuffixSelected()),$("#addAContact").fadeIn(500),this.agreementIsEdit()&&(this.contacts()[this.contactIndex].agreementId(this.agreementId),t={agreementId:this.contacts()[this.contactIndex].agreementId(),PersonId:this.contacts()[this.contactIndex].personId(),Type:this.contacts()[this.contactIndex].type(),DisplayName:this.contacts()[this.contactIndex].displayName(),FirstName:this.contacts()[this.contactIndex].firstName(),MiddleName:this.contacts()[this.contactIndex].middleName(),LastName:this.contacts()[this.contactIndex].lastName(),Suffix:this.contacts()[this.contactIndex].suffix(),EmailAddress:this.contacts()[this.contactIndex].emailAddress(),PersonId:this.contacts()[this.contactIndex].personId(),Phones:this.contacts()[this.contactIndex].phones(),Title:this.contacts()[this.contactIndex].title()},i=App.Routes.WebApi.Agreements.Contacts.put(this.agreementId,this.contacts()[this.contactIndex].id()),$.ajax({type:"PUT",url:i,data:t,success:function(){},error:function(t){t.status===400&&(n.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(t.responseText.replace("\n","<br /><br />")),n.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){n.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}}))):this.validateContact.errors.showAllMessages(!0),this.$addContactDialog.data("kendoWindow").close()},i.prototype.addContact=function(){var t=this,n,i;this.validateContact.isValid()?((this.contactDisplayName()==undefined||this.contactDisplayName()=="")&&this.contactDisplayName(this.contactFirstName()+" "+this.contactLastName()),n={agreementId:this.agreementId,title:this.contactJobTitle(),firstName:this.contactFirstName(),lastName:this.contactLastName(),id:this.contactUserId(),personId:this.contactPersonId(),userId:this.contactUserId(),phones:ko.mapping.toJS(this.phones.contactPhones()),emailAddress:this.contactEmail(),type:this.contactTypeOptionSelected(),suffix:this.contactSuffixSelected(),salutation:this.contactSalutationSelected(),displayName:this.contactDisplayName(),middleName:this.contactMiddleName()},this.$addContactDialog.data("kendoWindow").close(),$("#addAContact").fadeIn(500),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*.85),this.agreementIsEdit()?(i=App.Routes.WebApi.Agreements.Contacts.post(this.agreementId),$.post(i,n).done(function(i,r,u){var f=u.getResponseHeader("Location");n.id=parseInt(f.substring(f.lastIndexOf("/")+1)),t.contacts.push(ko.mapping.fromJS(n))}).fail(function(n){n.status===400&&(t.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),t.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){t.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))})):this.contacts.push(ko.mapping.fromJS(n))):this.validateContact.errors.showAllMessages(!0)},i.prototype.addAContact=function(){this.contactsIsEdit(!1),this.clearContact(),this.$addContactDialog.data("kendoWindow").open().title("Add Contact"),$("#addAContact").fadeOut(500)},i.prototype.cancelContact=function(){this.$addContactDialog.data("kendoWindow").close(),$("#addAContact").fadeIn(500)},i.prototype.clearContact=function(){var n;this.$contactEmail.prop("disabled",""),this.$contactLastName.prop("disabled",""),this.$contactFirstName.prop("disabled",""),$("#contactMiddleName").prop("disabled",""),this.$contactSalutation.data("kendoDropDownList").enable(!0),this.$contactSuffix.data("kendoDropDownList").enable(!0),this.validateContact.errors.showAllMessages(!1),this.validateContact.errors.showAllMessages(!1),this.contactId(undefined),this.contactEmail(""),this.contactDisplayName(""),this.contactPersonId(""),this.contactUserId(""),this.contactJobTitle(""),this.contactFirstName(""),this.contactMiddleName(""),this.contactLastName(""),this.phones.contactPhones.removeAll(),this.contactTypeOptionSelected(""),n=this.isCustomContactTypeAllowed?$("#contactTypeOptions").data("kendoComboBox"):$("#contactTypeOptions").data("kendoDropDownList"),n.select(0),n=$("#contactSalutation").data("kendoDropDownList"),n.select(0),n=$("#contactSuffix").data("kendoDropDownList"),n.select(0),this.validateContact.errors.showAllMessages(!1)},i.prototype.removeContact=function(n,t){var r=this,i;return confirm('Are you sure you want to remove "'+n.firstName()+" "+n.lastName()+'" as a contact from this agreement?')&&(i="",this.agreementIsEdit()&&(i=App.Routes.WebApi.Agreements.Contacts.del(this.agreementId,n.id()),$.ajax({url:i,type:"DELETE",success:function(){r.contacts.remove(n),$("body").css("min-height",$(window).height()+$("body").height()-$(window).height()*1.1)}}))),t.preventDefault(),t.stopPropagation(),!1},i.prototype.bindJquery=function(){var n=this,i=this,t;this.$addContactDialog.kendoWindow({width:950,open:function(){n.kendoWindowBug.val=$("body").scrollTop()-10,$("html, body").css("overflow","hidden")},close:function(){n.kendoWindowBug.val=0,$("html, body").css("overflow",""),$("#addAContact").fadeIn(500),n.clearContact()},visible:!1,draggable:!1,resizable:!1}),this.$addContactDialog.parent().addClass("contactKendoWindow"),t=function(t,i){var r=t.dataItem(i.item.index());n.contactDisplayName(r.displayName),n.contactFirstName(r.firstName),n.contactLastName(r.lastName),n.contactEmail(r.defaultEmailAddress),n.contactMiddleName(r.middleName),n.contactPersonId(r.id),n.contactUserId(r.userId),n.contactSuffixSelected(r.suffix),n.contactSalutationSelected(r.salutation),r.userId!=null&&(n.$contactEmail.prop("disabled","disabled"),n.$contactLastName.prop("disabled","disabled"),n.$contactFirstName.prop("disabled","disabled"),$("#contactMiddleName").prop("disabled","disabled"),n.$contactSalutation.data("kendoDropDownList").enable(!1),n.$contactSuffix.data("kendoDropDownList").enable(!1)),n.validateContact.errors.showAllMessages(!0)},this.$contactEmail.kendoAutoComplete({dataTextField:"defaultEmailAddress",minLength:3,filter:"contains",ignoreCase:!0,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){$.ajax({url:App.Routes.WebApi.People.get(),data:{email:$("#contactEmail").val(),emailMatch:"startsWith"},success:function(t){n.success(t.items)}})}}}),select:function(i){t(n.$contactEmail.data("kendoAutoComplete"),i)}}),this.$contactLastName.kendoAutoComplete({dataTextField:"lastName",template:"#=displayName#",minLength:3,filter:"contains",ignoreCase:!0,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(t){$.ajax({url:App.Routes.WebApi.People.get(),data:{lastName:n.contactLastName(),lastNameMatch:"startsWith"},success:function(n){t.success(n.items)}})}}}),select:function(i){t(n.$contactLastName.data("kendoAutoComplete"),i)}}),this.$contactFirstName.kendoAutoComplete({dataTextField:"firstName",template:"#=displayName#",minLength:3,filter:"contains",ignoreCase:!0,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(t){$.ajax({url:App.Routes.WebApi.People.get(),data:{firstName:n.contactFirstName(),firstNameMatch:"startsWith"},success:function(n){t.success(n.items)}})}}}),select:function(i){t(n.$contactFirstName.data("kendoAutoComplete"),i)}});$("#addContactDialog").on("change",".phoneTypes",function(){var t=this,n=ko.dataFor(this),r;n.type!=$(this).val()&&$(this).val()!==""&&(n.type=$(this).val()),n.id&&(r=App.Routes.WebApi.Agreements.Contacts.Phones.put(i.agreementId,n.contactId,n.id),$.ajax({type:"PUT",url:r,data:n,success:function(){},error:function(n){n.status===400&&(t.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),t.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){t.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}}))});$("#addContactDialog").on("change",".phoneNumbers",function(){var t=this,n=ko.dataFor(this),r;i.agreementIsEdit()&&n.value==$(this).val()&&($(this).val()==""?$("#phoneNumberValidate"+n.id).css("visibility","visible"):(r=App.Routes.WebApi.Agreements.Contacts.Phones.put(i.agreementId,n.contactId,n.id),$("#phoneNumberValidate"+n.id).css("visibility","hidden"),$.ajax({type:"PUT",url:r,data:n,success:function(){},error:function(n){n.status===400&&(t.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),t.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){t.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))}})))});this.isCustomContactTypeAllowed?$("#contactTypeOptions").kendoComboBox({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.contactTypeOptions()})}):$("#contactTypeOptions").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:this.contactTypeOptions()})}),this.$contactSalutation.kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.contactSalutation())})}),this.$contactSuffix.kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:new kendo.data.DataSource({data:ko.mapping.toJS(this.contactSuffix())})})},i.prototype._setupValidation=function(){this.validateContact=ko.validatedObservable({contactSalutation:this.contactSalutation.extend({maxLength:50}),contactFirstName:this.contactFirstName.extend({required:{message:"First name is required."},maxLength:50}),contactTypeOptionSelected:this.contactTypeOptionSelected.extend({required:{message:"Contact type is required."},maxLength:50}),contactLastName:this.contactLastName.extend({required:{message:"Last name is required."},maxLength:50}),contactEmail:this.contactEmail.extend({required:{message:"Email is required.",maxLength:100},email:{message:"Email is in wrong format"}}),contactSuffix:this.contactSuffix.extend({maxLength:50}),contactJobTitle:this.contactJobTitle.extend({maxLength:50})})},i.prototype.populateContacts=function(){var n=this;$.get(App.Routes.WebApi.Agreements.Contacts.get(this.agreementId),{useTestData:!1}).done(function(t){ko.mapping.fromJS(t,n.contacts),n.deferredPopContacts.resolve()})},i.prototype.postMe=function(n,t){var i=this;$.post(t,n).done(function(){}).fail(function(n){n.status===400&&(i.establishmentItemViewModel.$genericAlertDialog.find("p.content").html(n.responseText.replace("\n","<br /><br />")),i.establishmentItemViewModel.$genericAlertDialog.dialog({title:"Alert Message",dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:{Ok:function(){i.establishmentItemViewModel.$genericAlertDialog.dialog("close")}}}))})},i.prototype.agreementPostContacts=function(){var n=this,i=App.Routes.WebApi.Agreements.Contacts.post(this.agreementId),t;$.each(this.contacts(),function(r,u){t={agreementId:n.agreementId,title:u.title(),firstName:u.firstName(),lastName:u.lastName(),userId:u.id(),personId:u.personId(),phones:u.phones(),emailAddress:u.emailAddress(),type:u.type(),suffix:u.suffix(),salutation:u.salutation(),displayName:u.displayName(),middleName:u.middleName},n.postMe(t,i)})},i}(),n.Contacts=i})(Agreements||(Agreements={}))