var ViewModels;(function(n){(function(n){var t=function(){function n(n){this.inititializationErrors="",this.dirtyFlag=ko.observable(!1),this._initialize(n)}return n.prototype._initialize=function(n){this.id=ko.observable(n)},n.prototype.setupWidgets=function(n){var t=this;this.institutionSelectorId=n,$("#"+n).kendoAutoComplete({minLength:3,filter:"contains",ignoreCase:!0,placeholder:"[Enter Institution]",dataTextField:"officialName",dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){$.ajax({url:App.Routes.WebApi.Establishments.get(),data:{keyword:n.data.filter.filters[0].value,pageNumber:1,pageSize:App.Constants.int32Max},success:function(t){n.success(t.items)}})}}}),change:function(){t.checkInstitutionForNull()},select:function(i){var u=$("#"+n).data("kendoAutoComplete"),r=u.dataItem(i.item.index());t.institutionOfficialName(r.officialName),t.institutionId(r.id),r.countryName!=null&&r.countryName.length>0?t.institutionCountryOfficialName(r.countryName):t.institutionCountryOfficialName(null)}})},n.prototype.checkInstitutionForNull=function(){var t=$("#"+this.institutionSelectorId).data("kendoAutoComplete"),n=t.value()!=null?t.value().toString():null;n!=null&&(n=$.trim(n)),(n==null||n.length==0)&&(t.value(null),this.institutionOfficialName(null),this.institutionId(null))},n.prototype.setupValidation=function(){this.title.extend({required:!0,minLength:1,maxLength:256}),this.yearAwarded.extend({min:1900}),ko.validation.group(this)},n.prototype.setupSubscriptions=function(){var n=this;this.title.subscribe(function(){n.dirtyFlag(!0)}),this.fieldOfStudy.subscribe(function(){n.dirtyFlag(!0)}),this.yearAwarded.subscribe(function(){n.dirtyFlag(!0)}),this.institutionId.subscribe(function(){n.dirtyFlag(!0)})},n.prototype.load=function(){var i=this,n=$.Deferred(),t;return this.id()==0?(this.version=ko.observable(null),this.personId=ko.observable(0),this.title=ko.observable(null),this.fieldOfStudy=ko.observable(null),this.yearAwarded=ko.observable(null),this.whenLastUpdated=ko.observable(null),this.whoLastUpdated=ko.observable(null),this.institutionId=ko.observable(null),this.institutionOfficialName=ko.observable(null),this.institutionCountryOfficialName=ko.observable(null),n.resolve()):(t=$.Deferred(),$.ajax({type:"GET",url:App.Routes.WebApi.My.Degrees.get(this.id()),success:function(n){t.resolve(n)},error:function(n,i,r){t.reject(n,i,r)}}),$.when(t).done(function(t){ko.mapping.fromJS(t,{},i),n.resolve()}).fail(function(t,i,r){n.reject(t,i,r)})),n},n.prototype.save=function(n){var t;if(!this.isValid()){this.errors.showAllMessages();return}this.yearAwarded()!=null&&(t=this.yearAwarded().toString(),t=$.trim(t),t.length==0&&this.yearAwarded(null)),this.checkInstitutionForNull();var i={id:this.id,version:this.version,personId:this.personId,whenLastUpdated:this.whenLastUpdated,whoLastUpdated:this.whoLastUpdated,title:this.title,fieldOfStudy:this.fieldOfStudy,yearAwarded:this.yearAwarded,institutionId:this.institutionId},r=ko.mapping.toJS(i),u=n.id()==0?App.Routes.WebApi.My.Degrees.post():App.Routes.WebApi.My.Degrees.put(n.id()),f=n.id()==0?"POST":"PUT";$.ajax({type:f,async:!1,url:u,data:r,success:function(){},error:function(n){App.Failures.message(n,"while trying to save your degree",!0)},complete:function(){location.href=App.Routes.Mvc.My.Profile.get()+"#/formal-education"}})},n.prototype.cancel=function(){this.dirtyFlag()==!0?$("#cancelConfirmDialog").dialog({modal:!0,resizable:!1,width:450,buttons:{"Do not cancel":function(){$(this).dialog("close")},"Cancel and lose changes":function(){$(this).dialog("close"),location.href=App.Routes.Mvc.My.Profile.get("formal-education")}}}):history.back()},n}();n.Degree=t})(n.Degrees||(n.Degrees={}));var t=n.Degrees})(ViewModels||(ViewModels={}))