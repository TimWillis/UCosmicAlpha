var ViewModels;(function(n){(function(n){var t=function(){function n(n){this.dirtyFlag=ko.observable(!1);this.isOther=ko.observable(!1);this._initialize(n)}return n.prototype._initialize=function(n){this.id=ko.observable(n)},n.prototype.setupWidgets=function(n,t,i,r,u){var f=this;$("#"+n).kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Select...",dataSource:this.languageList,value:this.languageId()!=null?this.languageId():0,change:function(n){if(n.sender.selectedIndex>0){var t=f.languageList[n.sender.selectedIndex-1];t.name=="Other"?f.languageId(null):f.languageId(t.id)}else f.languageId(null)}});this.languageDroplist=$("#"+n).data("kendoDropDownList");this.languageId()==null&&this.languageDroplist.select(function(n){return n.name==="Other"});$("#"+t).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.speakingMeanings,value:this.speakingProficiency().toString(),template:kendo.template($("#proficiency-template").html())});$("#"+i).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.listeningMeanings,value:this.listeningProficiency().toString(),template:kendo.template($("#proficiency-template").html())});$("#"+r).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.readingMeanings,value:this.readingProficiency().toString(),template:kendo.template($("#proficiency-template").html())});$("#"+u).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.writingMeanings,value:this.writingProficiency().toString(),template:kendo.template($("#proficiency-template").html())})},n.prototype.setupValidation=function(){this.languageId.extend({notEqual:0});ko.validation.group(this)},n.prototype.setupSubscriptions=function(){var n=this;this.languageId.subscribe(function(){n.dirtyFlag(!0)});this.other.subscribe(function(){n.dirtyFlag(!0)});this.dialect.subscribe(function(){n.dirtyFlag(!0)});this.speakingProficiency.subscribe(function(){n.dirtyFlag(!0)});this.listeningProficiency.subscribe(function(){n.dirtyFlag(!0)});this.readingProficiency.subscribe(function(){n.dirtyFlag(!0)});this.writingProficiency.subscribe(function(){n.dirtyFlag(!0)})},n.prototype.load=function(){var n=this,t=$.Deferred(),r=$.Deferred(),i,u;return $.get(App.Routes.WebApi.LanguageExpertise.Proficiencies.get()).done(function(n){r.resolve(n)}).fail(function(n,t,i){r.reject(n,t,i)}),i=$.Deferred(),$.get(App.Routes.WebApi.Languages.get()).done(function(n){i.resolve(n)}).fail(function(n,t,r){i.reject(n,t,r)}),this.id()==0?(this.version=ko.observable(null),this.personId=ko.observable(0),this.whenLastUpdated=ko.observable(null),this.whoLastUpdated=ko.observable(null),this.languageId=ko.observable(0),this.dialect=ko.observable(null),this.other=ko.observable(null),this.speakingProficiency=ko.observable(0),this.listeningProficiency=ko.observable(0),this.readingProficiency=ko.observable(0),this.writingProficiency=ko.observable(0),$.when(i,r).done(function(i,r){n.languageList=i;n.languageList.push({name:"Other",code:"",id:0});n.proficiencyInfo=r;t.resolve()}).fail(function(n,i,r){t.reject(n,i,r)})):(u=$.Deferred(),$.ajax({type:"GET",url:App.Routes.WebApi.LanguageExpertise.get(this.id()),success:function(n){u.resolve(n)},error:function(n,t,i){u.reject(n,t,i)}}),$.when(i,r,u).done(function(i,r,u){n.languageList=i;n.languageList.push({name:"Other",code:"",id:0});n.proficiencyInfo=r;ko.mapping.fromJS(u,{},n);t.resolve()}).fail(function(n,i,r){t.reject(n,i,r)})),t},n.prototype.save=function(n){var t,i;if(!this.isValid()){this.errors.showAllMessages();return}if(t=this.languageDroplist.select()-1,i=this.languageList[t].name,i==="Other"&&(this.other()==null||this.other().length==0)){this.isOther(!0);return}var r={id:this.id,version:this.version,personId:this.personId,whenLastUpdated:this.whenLastUpdated,whoLastUpdated:this.whoLastUpdated,languageId:this.languageId,dialect:this.dialect,other:this.other,speakingProficiency:this.speakingProficiency,listeningProficiency:this.listeningProficiency,readingProficiency:this.readingProficiency,writingProficiency:this.writingProficiency},u=ko.mapping.toJS(r),f=n.id()==0?App.Routes.WebApi.LanguageExpertise.post():App.Routes.WebApi.LanguageExpertise.put(n.id()),e=n.id()==0?"POST":"PUT";$.ajax({type:e,async:!1,url:f,data:u,success:function(){},error:function(n,t,i){alert(t+" | "+i)},complete:function(){location.href=App.Routes.Mvc.My.Profile.get("language-expertise")}})},n.prototype.cancel=function(){this.dirtyFlag()==!0?$("#cancelConfirmDialog").dialog({modal:!0,resizable:!1,width:450,buttons:{"Do not cancel":function(){$(this).dialog("close")},"Cancel and lose changes":function(){$(this).dialog("close");location.href=App.Routes.Mvc.My.Profile.get("language-expertise")}}}):location.href=App.Routes.Mvc.My.Profile.get("language-expertise")},n}();n.LanguageExpertise=t})(n.LanguageExpertises||(n.LanguageExpertises={}));var t=n.LanguageExpertises})(ViewModels||(ViewModels={}));