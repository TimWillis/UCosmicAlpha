var ViewModels;(function(n){(function(n){var t=function(){function n(n){this.inititializationErrors="",this.dirtyFlag=ko.observable(!1),this._initialize(n)}return n.prototype._initialize=function(n){this.id=n==="new"?ko.observable(0):ko.observable(Number(n))},n.prototype.setupWidgets=function(n,t,i,r,u){var f=this,e;$("#"+n).kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:this.languageList,value:this.languageId()!=null?this.languageId():0,change:function(n){var t=f.languageList[n.sender.selectedIndex];t.name=="Other"?f.languageId(null):f.languageId(t.id)}}),this.languageId()==null&&(e=$("#"+n).data("kendoDropDownList"),e.select(function(n){return n.name==="Other"})),$("#"+t).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.speakingMeanings,value:this.speakingProficiency(),template:kendo.template($("#proficiency-template").html())}),$("#"+i).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.listeningMeanings,value:this.listeningProficiency(),template:kendo.template($("#proficiency-template").html())}),$("#"+r).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.readingMeanings,value:this.readingProficiency(),template:kendo.template($("#proficiency-template").html())}),$("#"+u).kendoDropDownList({dataTextField:"title",dataValueField:"weight",dataSource:this.proficiencyInfo.writingMeanings,value:this.writingProficiency(),template:kendo.template($("#proficiency-template").html())})},n.prototype.setupValidation=function(){ko.validation.rules.atLeast={validator:function(n,t){return n.length>=t},message:"At least {0} must be selected."},ko.validation.registerExtenders(),ko.validation.group(this)},n.prototype.setupSubscriptions=function(){var n=this;this.languageId.subscribe(function(){n.dirtyFlag(!0)}),this.other.subscribe(function(){n.dirtyFlag(!0)}),this.dialect.subscribe(function(){n.dirtyFlag(!0)}),this.speakingProficiency.subscribe(function(){n.dirtyFlag(!0)}),this.listeningProficiency.subscribe(function(){n.dirtyFlag(!0)}),this.readingProficiency.subscribe(function(){n.dirtyFlag(!0)}),this.writingProficiency.subscribe(function(){n.dirtyFlag(!0)})},n.prototype.load=function(){var n=this,t=$.Deferred(),r=$.Deferred(),i,u;return $.get(App.Routes.WebApi.LanguageProficiency.get()).done(function(n){r.resolve(n)}).fail(function(n,t,i){r.reject(n,t,i)}),i=$.Deferred(),$.get(App.Routes.WebApi.Languages.get()).done(function(n){i.resolve(n)}).fail(function(n,t,r){i.reject(n,t,r)}),this.id()==0?(this.version=ko.observable(null),this.personId=ko.observable(0),this.whenLastUpdated=ko.observable(null),this.whoLastUpdated=ko.observable(null),this.languageId=ko.observable(0),this.dialect=ko.observable(null),this.other=ko.observable(null),this.speakingProficiency=ko.observable(0),this.listeningProficiency=ko.observable(0),this.readingProficiency=ko.observable(0),this.writingProficiency=ko.observable(0),$.when(i,r).done(function(i,r){n.languageList=i,n.languageList.push({name:"Other",code:"",id:0}),n.proficiencyInfo=r,t.resolve()}).fail(function(n,i,r){t.reject(n,i,r)})):(u=$.Deferred(),$.ajax({type:"GET",url:App.Routes.WebApi.LanguageExpertises.get(this.id()),success:function(n){u.resolve(n)},error:function(n,t,i){u.reject(n,t,i)}}),$.when(i,r,u).done(function(i,r,u){n.languageList=i,n.languageList.push({name:"Other",code:"",id:0}),n.proficiencyInfo=r,ko.mapping.fromJS(u,{},n),t.resolve()}).fail(function(n,i,r){t.reject(n,i,r)})),t},n.prototype.save=function(n){if(this.isValid()){var t={id:this.id,version:this.version,personId:this.personId,whenLastUpdated:this.whenLastUpdated,whoLastUpdated:this.whoLastUpdated,languageId:this.languageId,dialect:this.dialect,other:this.other,speakingProficiency:this.speakingProficiency,listeningProficiency:this.listeningProficiency,readingProficiency:this.readingProficiency,writingProficiency:this.writingProficiency},i=ko.mapping.toJS(t),r=n.id()==0?App.Routes.WebApi.LanguageExpertises.post():App.Routes.WebApi.LanguageExpertises.put(n.id()),u=n.id()==0?"POST":"PUT";$.ajax({type:u,async:!1,url:r,data:ko.toJSON(i),dataType:"json",contentType:"application/json",success:function(){},error:function(n,t,i){alert(t+" | "+i)},complete:function(){location.href=App.Routes.Mvc.My.Profile.get("language-expertise")}})}},n.prototype.cancel=function(){this.dirtyFlag()==!0?$("#cancelConfirmDialog").dialog({modal:!0,resizable:!1,width:450,buttons:{"Do not cancel":function(){$(this).dialog("close")},"Cancel and lose changes":function(){$(this).dialog("close"),location.href=App.Routes.Mvc.My.Profile.get("language-expertise")}}}):location.href=App.Routes.Mvc.My.Profile.get("language-expertise")},n}();n.LanguageExpertise=t})(n.LanguageExpertises||(n.LanguageExpertises={}));var t=n.LanguageExpertises})(ViewModels||(ViewModels={}))