var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i};define(["require","exports"],function(n,t){var i=google.maps,r=function(){function n(){this.position=i.ControlPosition.TOP_LEFT,this.elementId="map_tools"}return n}(),u;t.ToolsOverlayOptions=r,u=function(n){function t(t,i){typeof i=="undefined"&&(i=new r),n.call(this),this.markerLatLng=ko.observable(),this.position=i.position,this.elementId=i.elementId,this.$element=$("#"+this.elementId),this.element=this.$element[0],this.$markerAddButton=this.$element.find(".marker img.add-button"),this.$markerRemoveButton=this.$element.find(".marker img.remove-button"),this.$markerButtonsContainer=this.$element.find(".marker"),this.setMap(t)}return __extends(t,n),t.prototype.onAdd=function(){var n=this;this.getMap().controls[this.position].push(this.element),this.markerLatLng()?this.$markerAddButton.hide():this.$markerRemoveButton.hide();this.$markerAddButton.on("click",this,function(t){n.createMarker(t)});this.$markerRemoveButton.on("click",this,function(t){n.removeMarker(t)});this.$element.show()},t.prototype.onRemove=function(){this.element.parentNode.removeChild(this.element)},t.prototype.draw=function(){},t.prototype.updateMarkerLatLng=function(n){var t=n?new i.LatLng(n.lat(),n.lng()):null;this.markerLatLng(t)},t.prototype.placeMarker=function(n){var t=this,r=this.$markerButtonsContainer.is(":visible");this.marker=new i.Marker({map:this.getMap(),position:n,draggable:r}),this.updateMarkerLatLng(n),i.event.addListener(this.marker,"dragstart",function(n){t.updateMarkerLatLng(n.latLng),$(t.getMap().getDiv()).trigger("marker_dragstart",t)}),i.event.addListener(this.marker,"drag",function(n){t.updateMarkerLatLng(n.latLng),$(t.getMap().getDiv()).trigger("marker_drag",t)}),i.event.addListener(this.marker,"dragend",function(n){t.updateMarkerLatLng(n.latLng),$(t.getMap().getDiv()).trigger("marker_dragend",t)})},t.prototype.createMarker=function(){var n=this,f,r;this.getMap().setOptions({draggableCursor:"pointer"});var o=this.$element.position().left+this.$markerAddButton.position().left+this.$markerAddButton.outerWidth()/2,s=this.$markerAddButton.outerHeight(),t=this.$element.find(".marker img.drag-icon"),e=new i.Point(0,0),u=t.data("anchor");u&&u.indexOf(",")&&(e=new i.Point(parseInt(u.split(",")[0]),parseInt(u.split(",")[1]))),f=new i.Point(0,0),r=t.data("origin"),r&&r.indexOf(",")&&(f=new i.Point(parseInt(r.split(",")[0]),parseInt(r.split(",")[1]))),this.marker=new i.Marker({map:this.getMap(),position:this.getProjection().fromContainerPixelToLatLng(new i.Point(o,s)),cursor:"pointer",clickable:!1,icon:new i.MarkerImage(t.attr("src"),new i.Size(t.width(),t.height()),f,e)}),this.$markerAddButton.hide(),this.$markerRemoveButton.show(),this.markerMoveListener=i.event.addListener(this.getMap(),"mousemove",function(t){n.marker.setPosition(t.latLng)}),this.markerDropListener=i.event.addListenerOnce(this.getMap(),"mouseup",function(r){var u;i.event.removeListener(n.markerMoveListener),i.event.removeListener(n.markerDropListener),n.getMap().setOptions({draggableCursor:undefined}),n.marker.setMap(null),u=new i.OverlayView,u.draw=function(){},u.setMap(n.getMap());var e=u.getProjection().fromLatLngToContainerPixel(r.latLng),o=new i.Point(0,0),f=t.data("offset");f&&f.indexOf(",")&&(o=new i.Point(parseInt(f.split(",")[0]),parseInt(f.split(",")[1]))),e.y+=o.y,e.x+=o.x,r.latLng=u.getProjection().fromContainerPixelToLatLng(e),n.placeMarker(r.latLng),$(n.getMap().getDiv()).trigger("marker_created",n)})},t.prototype.removeMarker=function(){var n=this;this.$destroyMarkerConfirmDialog||(this.$destroyMarkerConfirmDialog=this.$element.find(".confirm-destroy-marker-dialog")),this.$destroyMarkerConfirmDialog.length?this.$destroyMarkerConfirmDialog.dialog({dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:[{text:"Yes, confirm removal",click:function(){n.$destroyMarkerConfirmDialog.dialog("close"),n.destroyMarker()}},{text:"No, do not remove",click:function(){n.$destroyMarkerConfirmDialog.dialog("close")},"data-css-link":!0}]}):confirm("Are you sure you want to remove this placemark?")&&this.destroyMarker()},t.prototype.destroyMarker=function(){this.getMap().setOptions({draggableCursor:undefined}),this.markerMoveListener&&(i.event.removeListener(this.markerMoveListener),this.markerMoveListener=undefined),this.markerDropListener&&(i.event.removeListener(this.markerDropListener),this.markerDropListener=undefined),i.event.clearInstanceListeners(this.marker),this.marker.setMap(null),this.marker=undefined,this.updateMarkerLatLng(null),this.$markerRemoveButton.hide(),this.$markerAddButton.show(),$(this.getMap().getDiv()).trigger("marker_destroyed",this)},t.prototype.hideMarkerTools=function(){this.$markerButtonsContainer&&this.$markerButtonsContainer.length&&this.$markerButtonsContainer.hide(),this.marker&&this.marker.setDraggable(!1)},t.prototype.showMarkerTools=function(){this.$markerButtonsContainer&&this.$markerButtonsContainer.length&&this.$markerButtonsContainer.show(),this.marker&&this.marker.setDraggable(!0)},t}(google.maps.OverlayView),t.ToolsOverlay=u})