var ViewModels;(function(n){(function(n){var t=function(){function n(n){this.inititializationErrors="",this.saving=!1,this.dirtyFlag=ko.observable(!1),this.selectedLocations=ko.observableArray(),this._initialize(n)}return n.prototype._initialize=function(n){this.id=ko.observable(n)},n.prototype.setupWidgets=function(n){var t=this;this.locationSelectorId=n,$("#"+n).kendoMultiSelect({ignoreCase:!0,dataTextField:"officialName",dataValueField:"id",minLength:3,dataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(n){n.data.filter!=null&&$.ajax({url:App.Routes.WebApi.Places.get(),data:{keyword:n.data.filter!=null?n.data.filter.filters[0].value:null}})}}}),value:this.selectedLocations(),change:function(n){t.updateLocations(n.sender.value())},placeholder:"[Select Country/Location, Body of Water or Global]"})},n.prototype.setupValidation=function(){ko.validation.rules.atLeast={validator:function(n,t){return n.length>=t},message:"At least {0} must be selected."},ko.validation.registerExtenders(),this.locations.extend({atLeast:1}),this.description.extend({maxLength:400}),ko.validation.group(this)},n.prototype.load=function(){var n=this,t=$.Deferred(),i,r;return this.id()==0?(this.version=ko.observable(null),this.entityId=ko.observable(null),this.description=ko.observable(null),this.locations=ko.observableArray(),this.whenLastUpdated=ko.observable(null),this.whoLastUpdated=ko.observable(null),t.resolve()):(i=$.Deferred(),$.get(App.Routes.WebApi.Places.get()).done(function(n){i.resolve(n)}).fail(function(n,t,r){i.reject(n,t,r)}),r=$.Deferred(),$.ajax({type:"GET",url:App.Routes.WebApi.GeographicExpertises.get(this.id()),success:function(n){r.resolve(n)},error:function(n,t,i){r.reject(n,t,i)}}),$.when(i,r).done(function(i,r){ko.mapping.fromJS(r,{},n);for(var u=0;u<n.locations().length;u+=1)n.selectedLocations.push(n.locations()[u].placeId());n.description.subscribe(function(){n.dirtyFlag(!0)}),t.resolve()}).fail(function(n,i,r){t.reject(n,i,r)})),t},n.prototype.save=function(n){var t=this,i;if(this.isValid()){while(this.saving)alert("Please wait while expertise is saved.");i=ko.mapping.toJS(this),this.saving=!0,$.ajax({type:"PUT",url:App.Routes.WebApi.GeographicExpertises.put(n.id()),data:i,dataType:"json",success:function(){t.saving=!1,location.href=App.Routes.Mvc.My.Profile.get(1)},error:function(n,i,r){t.saving=!1,alert(i+" | "+r),location.href=App.Routes.Mvc.My.Profile.get(1)}})}},n.prototype.deleteExpertise=function(){},n.prototype.cancel=function(){if(this.dirtyFlag()==!0){var n=this;$("#cancelConfirmDialog").dialog({modal:!0,resizable:!1,width:450,buttons:{"Do not cancel":function(){$(this).dialog("close")},"Cancel and lose changes":function(){$(this).dialog("close"),location.href=App.Routes.Mvc.My.Profile.get(1)}}})}},n.prototype.updateLocations=function(n){var t,i;for(this.locations.removeAll(),t=0;t<n.length;t+=1)i=ko.mapping.fromJS({id:0,placeId:n[t],version:""}),this.locations.push(i);this.dirtyFlag(!0)},n}();n.GeographicExpertise=t})(n.GeographicExpertises||(n.GeographicExpertises={}));var t=n.GeographicExpertises})(ViewModels||(ViewModels={}))