var ViewModels;(function(n){(function(t){var i=google.maps,r=function(){function r(i){var r=this;this.namesSpinner=new n.Spinner(new n.SpinnerOptions(0,!0)),this.urlsSpinner=new n.Spinner(new n.SpinnerOptions(0,!0)),this.id=0,this.$genericAlertDialog=undefined,this.languages=ko.observableArray(),this.names=ko.observableArray(),this.editingName=ko.observable(0),this.urls=ko.observableArray(),this.editingUrl=ko.observable(0),this.mapTools=ko.observable(),this.id=i||0,ko.computed(function(){$.getJSON(App.Routes.WebApi.Languages.get()).done(function(t){var i=new n.Languages.ServerApiModel(undefined,"[Language Neutral]");t.splice(0,0,i),r.languages(t)})}).extend({throttle:1}),this.namesMapping={create:function(n){return new t.Name(n.data,r)}},this.canAddName=ko.computed(function(){return!r.namesSpinner.isVisible()&&r.editingName()===0&&r.id!==0}),ko.computed(function(){r.id?r.requestNames():setTimeout(function(){r.namesSpinner.stop(),r.addName()},0)}).extend({throttle:1}),this.urlsMapping={create:function(n){return new t.Url(n.data,r)}},this.canAddUrl=ko.computed(function(){return!r.urlsSpinner.isVisible()&&r.editingUrl()===0&&r.id!==0}),ko.computed(function(){r.id?r.requestUrls():setTimeout(function(){r.urlsSpinner.stop(),r.addUrl()},0)}).extend({throttle:1}),this.toolsMarkerLat=ko.computed(function(){return r.mapTools()&&r.mapTools().markerLatLng()?r.mapTools().markerLatLng().lat():null}),this.toolsMarkerLng=ko.computed(function(){return r.mapTools()&&r.mapTools().markerLatLng()?r.mapTools().markerLatLng().lng():null})}return r.prototype.requestNames=function(n){var t=this;this.namesSpinner.start(),$.get(App.Routes.WebApi.Establishments.Names.get(this.id)).done(function(i){t.receiveNames(i),n&&n(i)})},r.prototype.receiveNames=function(n){ko.mapping.fromJS(n||[],this.namesMapping,this.names),this.namesSpinner.stop(),App.Obtruder.obtrude(document)},r.prototype.addName=function(){var i=new t.ServerNameApiModel(this.id),n;this.names().length===0&&(i.isOfficialName=!0),n=new t.Name(i,this),this.names.unshift(n),n.showEditor(),App.Obtruder.obtrude(document)},r.prototype.requestUrls=function(n){var t=this;this.urlsSpinner.start(),$.get(App.Routes.WebApi.Establishments.Urls.get(this.id)).done(function(i){t.receiveUrls(i),n&&n(i)})},r.prototype.receiveUrls=function(n){ko.mapping.fromJS(n||[],this.urlsMapping,this.urls),this.urlsSpinner.stop(),App.Obtruder.obtrude(document)},r.prototype.addUrl=function(){var i=new t.ServerUrlApiModel(this.id),n;this.urls().length===0&&(i.isOfficialUrl=!0),n=new t.Url(i,this),this.urls.unshift(n),n.showEditor(),App.Obtruder.obtrude(document)},r.prototype.initMap=function(n){var t=this,u=new i.LatLng(0,0),f=i.MapTypeId.ROADMAP,e={mapTypeId:f,center:u,zoom:1,scrollwheel:!1,overviewMapControl:!0,overviewMapControlOptions:{opened:!1}},r;this.map=new i.Map(document.getElementById(n),e),r=new App.GoogleMaps.ToolsOverlayOptions,$.get(App.Routes.WebApi.Establishments.Locations.get(this.id)).done(function(n){n.center.hasValue&&(r.markerLatLng=new i.LatLng(n.center.latitude,n.center.longitude)),i.event.addListenerOnce(t.map,"idle",function(){if(n.googleMapZoomLevel)t.map.setZoom(n.googleMapZoomLevel);else if(n.box.hasValue){var u=new i.LatLng(n.box.northEast.latitude,n.box.northEast.longitude),f=new i.LatLng(n.box.southWest.latitude,n.box.southWest.longitude);t.map.fitBounds(new i.LatLngBounds(f,u))}n.center.hasValue&&t.map.setCenter(r.markerLatLng)})}).fail(function(){r.markerLatLng=undefined}).always(function(){i.event.addListenerOnce(t.map,"idle",function(){t.mapTools(new App.GoogleMaps.ToolsOverlay(t.map,r))})})},r}();t.Item=r})(n.Establishments||(n.Establishments={}));var t=n.Establishments})(ViewModels||(ViewModels={}))