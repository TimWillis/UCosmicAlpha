var ViewModels;(function(n){(function(t){var r=google.maps,i=function(){function i(i){this.id=0,this.$genericAlertDialog=undefined,this.languages=ko.observableArray(),this.names=ko.observableArray(),this.editingName=ko.observable(0),this.namesSpinner=new n.Spinner(new n.SpinnerOptions(0,!0)),this.urls=ko.observableArray(),this.editingUrl=ko.observable(0),this.urlsSpinner=new n.Spinner(new n.SpinnerOptions(0,!0)),this.id=i||0,this._initNamesComputeds(),this._initUrlsComputeds(),this.location=new t.Location(this.id)}return i.prototype.requestNames=function(n){var t=this;this.namesSpinner.start(),$.get(App.Routes.WebApi.Establishments.Names.get(this.id)).done(function(i){t.receiveNames(i),n&&n(i)})},i.prototype.receiveNames=function(n){ko.mapping.fromJS(n||[],this._namesMapping,this.names),this.namesSpinner.stop(),App.Obtruder.obtrude(document)},i.prototype.addName=function(){var i=new t.ServerNameApiModel(this.id),n;this.names().length===0&&(i.isOfficialName=!0),n=new t.Name(i,this),this.names.unshift(n),n.showEditor(),App.Obtruder.obtrude(document)},i.prototype._initNamesComputeds=function(){var i=this;ko.computed(function(){$.getJSON(App.Routes.WebApi.Languages.get()).done(function(t){var r=new n.Languages.ServerApiModel(undefined,"[Language Neutral]");t.splice(0,0,r),i.languages(t)})}).extend({throttle:1}),this._namesMapping={create:function(n){return new t.Name(n.data,i)}},this.canAddName=ko.computed(function(){return!i.namesSpinner.isVisible()&&i.editingName()===0&&i.id!==0}),ko.computed(function(){i.id?i.requestNames():setTimeout(function(){i.namesSpinner.stop(),i.addName()},0)}).extend({throttle:1})},i.prototype.requestUrls=function(n){var t=this;this.urlsSpinner.start(),$.get(App.Routes.WebApi.Establishments.Urls.get(this.id)).done(function(i){t.receiveUrls(i),n&&n(i)})},i.prototype.receiveUrls=function(n){ko.mapping.fromJS(n||[],this._urlsMapping,this.urls),this.urlsSpinner.stop(),App.Obtruder.obtrude(document)},i.prototype.addUrl=function(){var i=new t.ServerUrlApiModel(this.id),n;this.urls().length===0&&(i.isOfficialUrl=!0),n=new t.Url(i,this),this.urls.unshift(n),n.showEditor(),App.Obtruder.obtrude(document)},i.prototype._initUrlsComputeds=function(){var n=this;this._urlsMapping={create:function(i){return new t.Url(i.data,n)}},this.canAddUrl=ko.computed(function(){return!n.urlsSpinner.isVisible()&&n.editingUrl()===0&&n.id!==0}),ko.computed(function(){n.id?n.requestUrls():setTimeout(function(){n.urlsSpinner.stop(),n.addUrl()},0)}).extend({throttle:1})},i.prototype.submitToCreate=function(n){var f=this,r,u;if(!this.id||this.id===0){var t=this.names()[0],i=this.urls()[0],e=this.location;if(t.text.isValidating()||i.value.isValidating())return setTimeout(function(){var t=f.submitToCreate(n);return!1},5),!1;t.isValid()||t.errors.showAllMessages(),i.isValid()||i.errors.showAllMessages(),t.isValid()&&i.isValid()&&(r=App.Routes.WebApi.Establishments.post(),u={officialName:t.serializeData(),officialUrl:i.serializeData(),location:e.serializeData()},$.post(r,u).always(function(){alert("always")}).done(function(){alert("done")}).fail(function(){alert("fail :(")}))}return!1},i}();t.Item=i})(n.Establishments||(n.Establishments={}));var t=n.Establishments})(ViewModels||(ViewModels={}))