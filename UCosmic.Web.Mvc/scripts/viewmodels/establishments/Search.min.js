var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ViewModels;(function(n){(function(t){var i=function(t){function i(){var r=this,i;t.call(this),this.sammy=Sammy(),this.countries=ko.observableArray(),this.countryCode=ko.observable(),this.lenses=ko.observableArray([{text:"Table",value:"table"},{text:"List",value:"list"},{text:"Grid",value:"grid"},{text:"Map",value:"map"},{text:"Tree",value:"tree"}]),this.lens=ko.observable(),this.$itemsPage=undefined,this.sideSwiper=new App.SideSwiper({frameWidth:710,speed:"fast",root:"#search"}),this.trail=ko.observableArray([]),this.resultsMapping={items:{key:function(n){return ko.utils.unwrapObservable(n.id)},create:function(t){return new n.Establishments.SearchResult(t.data)}},ignore:["pageSize","pageNumber"]},ko.computed(function(){var t=$('input[type=hidden][data-bind="value: countryCode"]').val();$.get(App.Routes.WebApi.Countries.get()).done(function(i){var u=new n.Places.ServerCountryApiModel("-1","[Without country]");i.splice(i.length,0,u),r.countries(i),t&&t!==r.countryCode()&&r.countryCode(t)})}).extend({throttle:1}),this.pageNumber.subscribe(function(){r.setLocation()}),this.changeLens=function(n){r.lens(n.value)},i=this,this.sammy.before(/\#\/page\/(.*)/,function(){if(i.nextForceDisabled()||i.prevForceDisabled())return!1;var n=this.params.pageNumber;return n&&parseInt(n)!==parseInt(i.pageNumber())&&i.pageNumber(parseInt(n)),!0}),this.sammy.get("#/page/:pageNumber/",function(){var n=i.trail(),t;if(!(n.length>0)||n[n.length-1]!==this.path){if(n.length>1&&n[n.length-2]===this.path){n.pop(),i.swipeCallback=function(){t=i.$itemsPage.clone(!0).removeAttr("data-bind").data("bind",undefined).removeAttr("id"),t.appendTo(i.$itemsPage.parent()),i.$itemsPage.attr("data-side-swiper","off").hide(),i.lockAnimation(),$(window).scrollTop(0),i.sideSwiper.prev(1,function(){i.$itemsPage.siblings().remove(),i.unlockAnimation()})};return}n.length>0&&(i.swipeCallback=function(){t=i.$itemsPage.clone(!0).removeAttr("data-bind").data("bind",undefined).removeAttr("id"),t.insertBefore(i.$itemsPage),i.$itemsPage.attr("data-side-swiper","off").hide(),i.lockAnimation(),$(window).scrollTop(0),i.sideSwiper.next(1,function(){i.unlockAnimation()})}),n.push(this.path)}}),this.sammy.get("/establishments[/]?",function(){this.app.setLocation("#/page/1/")}),ko.computed(function(){r.requestResults()}).extend({throttle:1})}return __extends(i,t),i.prototype.setLocation=function(){var n="#/page/"+this.pageNumber()+"/";this.sammy.getLocation()!==n&&this.sammy.setLocation(n)},i.prototype.lockAnimation=function(){this.nextForceDisabled(!0),this.prevForceDisabled(!0)},i.prototype.unlockAnimation=function(){this.nextForceDisabled(!1),this.prevForceDisabled(!1)},i.prototype.swipeCallback=function(){},i.prototype.receiveResults=function(n){n?ko.mapping.fromJS(n,this.resultsMapping,this):ko.mapping.fromJS({items:[],itemTotal:0},this.resultsMapping,this),App.WindowScroller.restoreTop(),this.spinner.stop(),this.swipeCallback(),this.transitionedPageNumber(this.pageNumber())},i.prototype.requestResults=function(){var n=this;this.pageSize()!==undefined&&this.orderBy()!==undefined&&(this.spinner.start(),$.get(App.Routes.WebApi.Establishments.get(),{pageSize:this.pageSize(),pageNumber:this.pageNumber(),countryCode:this.countryCode(),keyword:this.throttledKeyword(),orderBy:this.orderBy()}).done(function(t){n.receiveResults(t)}))},i.prototype.gotoAddNew=function(){return!0},i}(n.PagedSearch);t.Search=i})(n.Establishments||(n.Establishments={}));var t=n.Establishments})(ViewModels||(ViewModels={}))