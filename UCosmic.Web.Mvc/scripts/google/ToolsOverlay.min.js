var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},App;(function(n){(function(n){var t=google.maps,i=function(){function n(){this.position=t.ControlPosition.TOP_LEFT,this.elementId="map_tools"}return n}(),r;n.ToolsOverlayOptions=i,r=function(n){function r(t,r){typeof r=="undefined"&&(r=new i),n.call(this),this.markerLatLng=ko.observable(),this.position=r.position,this.elementId=r.elementId,this.$element=$("#"+this.elementId),this.element=this.$element[0],this.$markerAddButton=this.$element.find(".marker img.add-button"),this.$markerRemoveButton=this.$element.find(".marker img.remove-button"),this.setMap(t)}return __extends(r,n),r.prototype.onAdd=function(){var n=this;this.getMap().controls[this.position].push(this.element),this.markerLatLng()?this.$markerAddButton.hide():this.$markerRemoveButton.hide();this.$markerAddButton.on("click",this,function(t){n.createMarker(t)});this.$markerRemoveButton.on("click",this,function(t){n.removeMarker(t)});this.$element.show()},r.prototype.onRemove=function(){this.element.parentNode.removeChild(this.element)},r.prototype.draw=function(){},r.prototype.updateMarkerLatLng=function(n){var i=n?new t.LatLng(n.lat(),n.lng()):null;this.markerLatLng(i)},r.prototype.placeMarker=function(n){var i=this;this.marker=new t.Marker({map:this.getMap(),position:n,draggable:!0}),this.updateMarkerLatLng(n),t.event.addListener(this.marker,"dragstart",function(n){i.updateMarkerLatLng(n.latLng),$(i.getMap().getDiv()).trigger("marker_dragstart",i)}),t.event.addListener(this.marker,"drag",function(n){i.updateMarkerLatLng(n.latLng),$(i.getMap().getDiv()).trigger("marker_drag",i)}),t.event.addListener(this.marker,"dragend",function(n){i.updateMarkerLatLng(n.latLng),$(i.getMap().getDiv()).trigger("marker_dragend",i)})},r.prototype.createMarker=function(){var n=this,f,r;this.getMap().setOptions({draggableCursor:"pointer"});var o=this.$element.position().left+this.$markerAddButton.position().left+this.$markerAddButton.outerWidth()/2,s=this.$markerAddButton.outerHeight(),i=this.$element.find(".marker img.drag-icon"),e=new t.Point(0,0),u=i.data("anchor");u&&u.indexOf(",")&&(e=new t.Point(parseInt(u.split(",")[0]),parseInt(u.split(",")[1]))),f=new t.Point(0,0),r=i.data("origin"),r&&r.indexOf(",")&&(f=new t.Point(parseInt(r.split(",")[0]),parseInt(r.split(",")[1]))),this.marker=new t.Marker({map:this.getMap(),position:this.getProjection().fromContainerPixelToLatLng(new t.Point(o,s)),cursor:"pointer",clickable:!1,icon:new t.MarkerImage(i.attr("src"),new t.Size(i.width(),i.height()),f,e)}),this.$markerAddButton.hide(),this.$markerRemoveButton.show(),this.markerMoveListener=t.event.addListener(this.getMap(),"mousemove",function(t){n.marker.setPosition(t.latLng)}),this.markerDropListener=t.event.addListenerOnce(this.getMap(),"mouseup",function(r){var u;t.event.removeListener(n.markerMoveListener),t.event.removeListener(n.markerDropListener),n.getMap().setOptions({draggableCursor:undefined}),n.marker.setMap(null),u=new t.OverlayView,u.draw=function(){},u.setMap(n.getMap());var e=u.getProjection().fromLatLngToContainerPixel(r.latLng),o=new t.Point(0,0),f=i.data("offset");f&&f.indexOf(",")&&(o=new t.Point(parseInt(f.split(",")[0]),parseInt(f.split(",")[1]))),e.y+=o.y,e.x+=o.x,r.latLng=u.getProjection().fromContainerPixelToLatLng(e),n.placeMarker(r.latLng),$(n.getMap().getDiv()).trigger("marker_created",n)})},r.prototype.removeMarker=function(){var n=this;this.$destroyMarkerConfirmDialog||(this.$destroyMarkerConfirmDialog=this.$element.find(".confirm-destroy-marker-dialog")),this.$destroyMarkerConfirmDialog.length?this.$destroyMarkerConfirmDialog.dialog({dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:[{text:"Yes, confirm removal",click:function(){n.$destroyMarkerConfirmDialog.dialog("close"),n.destroyMarker()}},{text:"No, do not remove",click:function(){n.$destroyMarkerConfirmDialog.dialog("close")},"data-css-link":!0}]}):confirm("Are you sure you want to remove this placemark?")&&this.destroyMarker()},r.prototype.destroyMarker=function(){this.getMap().setOptions({draggableCursor:undefined}),this.markerMoveListener&&(t.event.removeListener(this.markerMoveListener),this.markerMoveListener=undefined),this.markerDropListener&&(t.event.removeListener(this.markerDropListener),this.markerDropListener=undefined),t.event.clearInstanceListeners(this.marker),this.marker.setMap(null),this.marker=undefined,this.updateMarkerLatLng(null),this.$markerRemoveButton.hide(),this.$markerAddButton.show(),$(this.getMap().getDiv()).trigger("marker_destroyed",this)},r}(google.maps.OverlayView),n.ToolsOverlay=r})(n.GoogleMaps||(n.GoogleMaps={}));var t=n.GoogleMaps})(App||(App={}))