var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},App;(function(n){(function(n){var t=function(){function n(){this.position=google.maps.ControlPosition.TOP_LEFT,this.elementId="map_tools",this.markerLatLng=undefined}return n}(),i;n.ToolsOverlayOptions=t,i=function(n){function i(i,r){typeof r=="undefined"&&(r=new t),n.call(this),this.map=i,this.setMap(this.map),this.position=r.position,this.elementId=r.elementId,this.$element=$("#"+this.elementId),this.element=this.$element[0],this.markerLatLng=r.markerLatLng,this.markerLat=r.markerLatObservable||ko.observable(),this.markerLng=r.markerLngObservable||ko.observable(),this.updateMarkerLatLng(this.markerLatLng),this.$markerReadyButton=this.$element.find(".marker img.ready-icon"),this.$markerPushedButton=this.$element.find(".marker img.pushed-icon"),this.init()}return __extends(i,n),i.prototype.draw=function(){},i.prototype.init=function(){var n=this;this.map.controls[this.position].push(this.element),this.markerLatLng?this.$markerReadyButton.hide():this.$markerPushedButton.hide(),this.markerLatLng&&this.putMarker(this.markerLatLng);this.$markerReadyButton.on("click",this,function(t){n.createMarker(t)});this.$markerPushedButton.on("click",this,function(t){n.removeMarker(t)});this.$element.show()},i.prototype.updateMarkerLatLng=function(n){n&&(this.markerLat(n.lat()),this.markerLng(n.lng()))},i.prototype.getCreatedMarkerLatLng=function(){var n=this.$element.position().left+this.$element.outerWidth()/2,t=this.$element.outerHeight(),i=new google.maps.Point(n,t),r=this.getProjection();return r.fromContainerPixelToLatLng(i)},i.prototype.putMarker=function(n){var t=this;this.marker=new google.maps.Marker({map:this.map,position:n,draggable:!0}),this.updateMarkerLatLng(n),google.maps.event.addListener(this.marker,"dragstart",function(n){t.updateMarkerLatLng(n.latLng),$(t.map.getDiv()).trigger("marker_dragstart",t)}),google.maps.event.addListener(this.marker,"drag",function(n){t.updateMarkerLatLng(n.latLng),$(t.map.getDiv()).trigger("marker_drag",t)}),google.maps.event.addListener(this.marker,"dragend",function(n){t.updateMarkerLatLng(n.latLng),$(t.map.getDiv()).trigger("marker_dragend",t)})},i.prototype.createMarker=function(){var n=this;this.$markerReadyButton.hide(),this.$markerPushedButton.show(),this.map.setOptions({draggableCursor:"pointer"}),this.marker=new google.maps.Marker({map:this.map,position:this.getCreatedMarkerLatLng(),cursor:"pointer",clickable:!1,icon:new google.maps.MarkerImage("/styles/icons/maps/tools-marker-new.png",new google.maps.Size(52,61),new google.maps.Point(0,0),new google.maps.Point(10,10))}),this.markerMoveListener=google.maps.event.addListener(this.map,"mousemove",function(t){n.marker.setPosition(t.latLng)}),this.markerDropListener=google.maps.event.addListenerOnce(this.map,"click",function(t){var i,r;google.maps.event.removeListener(n.markerMoveListener),n.map.setOptions({draggableCursor:undefined}),n.marker.setMap(null),i=new google.maps.OverlayView,i.draw=function(){},i.setMap(n.map),r=i.getProjection().fromLatLngToContainerPixel(t.latLng),r.y+=43,t.latLng=i.getProjection().fromContainerPixelToLatLng(r),n.putMarker(t.latLng),$(n.map.getDiv()).trigger("marker_created",n)})},i.prototype.removeMarker=function(){var n=this;this.$destroyMarkerConfirmDialog||(this.$destroyMarkerConfirmDialog=this.$element.find(".confirm-destroy-marker-dialog")),this.$destroyMarkerConfirmDialog.length?this.$destroyMarkerConfirmDialog.dialog({dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:[{text:"Yes, confirm removal",click:function(){n.$destroyMarkerConfirmDialog.dialog("close"),n.destroyMarker()}},{text:"No, do not remove",click:function(){n.$destroyMarkerConfirmDialog.dialog("close")},"data-css-link":!0}]}):confirm("Are you sure you want to remove this placemark?")&&this.destroyMarker()},i.prototype.destroyMarker=function(){this.$markerPushedButton.hide(),this.$markerReadyButton.show(),this.map.setOptions({draggableCursor:undefined}),this.markerMoveListener&&(google.maps.event.removeListener(this.markerMoveListener),this.markerMoveListener=undefined),this.markerDropListener&&(google.maps.event.removeListener(this.markerDropListener),this.markerDropListener=undefined),google.maps.event.clearInstanceListeners(this.marker),this.marker.setMap(null),this.marker=undefined,this.markerLat(null),this.markerLng(null),$(this.map.getDiv()).trigger("marker_destroyed",this)},i}(google.maps.OverlayView),n.ToolsOverlay=i})(n.GoogleMaps||(n.GoogleMaps={}));var t=n.GoogleMaps})(App||(App={}))