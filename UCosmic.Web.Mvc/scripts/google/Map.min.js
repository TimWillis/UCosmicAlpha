var App;(function(n){(function(n){var t=function(){function n(t,i,r){this._promise=$.Deferred(),this.idles=ko.observable(0),this.north=ko.observable(),this.south=ko.observable(),this.east=ko.observable(),this.west=ko.observable(),this.isDragging=ko.observable(!1),this.markers=ko.observableArray([]),this.infoWindows=ko.observableArray([]),this._options=i||{},this._settings=r||{},this._log("Constructing google map wrapper instance."),this._element=typeof t=="string"?document.getElementById(t):t,this._log('Set map canvas element, id is "{0}".',$(this._element).attr("id")),this.zoom=ko.observable(this._options.zoom||this._options.zoom==0?this._options.zoom:1),this.lat=ko.observable(this._options.center?this._reducePrecision(this._options.center.lat()):n.defaultCenter.lat()),this.lng=ko.observable(this._options.center?this._reducePrecision(this._options.center.lng()):n.defaultCenter.lng()),this._log("Zoom initialized to {0}.",this.zoom()),this._log("Latitude initialized to {0}.",this.lat()),this._log("Longitude initialized to {0}.",this.lng()),(typeof this._settings.autoCreate=="undefined"||this._settings.autoCreate)&&(this._log("Eagerly readying the google map instance."),this.ready()),this._log("Completed Construction of google map wrapper instance.")}return n.prototype.ready=function(){var n=this;return this.map||(this._create(),google.maps.event.addListenerOnce(this.map,"idle",function(){n._log("Fired map idle event #0."),n._listenForCenterChange(),n._listenForZoomChange(),n._listenForBoundsChange(),n._listenForDragging(),n._listenForIdled(),n._boundsChanged(),n._promise.resolve()})),this._promise},n.prototype._create=function(){var t=this._options;t.center||(t.center=n.defaultCenter),t.zoom||(t.zoom=1),t.mapTypeId||(t.mapTypeId=google.maps.MapTypeId.ROADMAP),t.scrollwheel||(t.scrollwheel=!1),this.map=new google.maps.Map(this._element,t)},n.prototype.setViewport=function(t){var i=!1,e=this.map.getZoom(),u,f,r;return n.isValidZoom(t.zoom)&&t.zoom!=e&&(this.map.setZoom(t.zoom),i=!0),u=this.map.getCenter(),t.center&&!n.areCentersEqual(u,t.center)&&(this.map.setCenter(t.center),i=!0),f=this.map.getBounds(),!t.bounds||n.isEmptyBounds(t.bounds)||n.areBoundsEqual(f,t.bounds)||(this.map.fitBounds(t.bounds),i=!0),r=$.Deferred(),i?google.maps.event.addListenerOnce(this.map,"idle",function(){r.resolve()}):r.resolve(),r},n.prototype._idled=function(){var n=this.idles();this.idles(++n)},n.prototype._listenForIdled=function(){var n=this;google.maps.event.addListener(this.map,"idle",function(){n._idled(),n._log("Fired map idle event #{0}.",n.idles())})},n.prototype._zoomChanged=function(){var n=this.map.getZoom();this.zoom(n)},n.prototype._listenForZoomChange=function(){var n=this;google.maps.event.addListener(this.map,"zoom_changed",function(){n._log("Firing map zoom_changed event."),n._zoomChanged(),n._log("Fired map zoom_changed event.")})},n.isValidZoom=function(n){return typeof n!="undefined"&&!isNaN(n)&&n>=0},n.prototype._centerChanged=function(){var n=this.map.getCenter();this.lat(this._reducePrecision(n.lat())),this.lng(this._reducePrecision(n.lng()))},n.prototype._listenForCenterChange=function(){var n=this;google.maps.event.addListener(this.map,"center_changed",function(){n._log("Firing map center_changed event."),n._centerChanged(),n._log("Fired map center_changed event.")})},n.areCentersEqual=function(n,t){return n.lat()==t.lat()&&n.lng()==t.lng()},n.prototype._boundsChanged=function(){var n=this.map.getBounds(),t=n.getNorthEast(),i=n.getSouthWest();this.north(this._reducePrecision(t.lat())),this.east(this._reducePrecision(t.lng())),this.south(this._reducePrecision(i.lat())),this.west(this._reducePrecision(i.lng()))},n.prototype._listenForBoundsChange=function(){var n=this;google.maps.event.addListener(this.map,"bounds_changed",function(){n._log("Firing map bounds_changed event."),n._boundsChanged(),n._log("Fired map bounds_changed event.")})},n.isEmptyBounds=function(t){return n.areBoundsEqual(t,n.emptyBounds)},n.areBoundsEqual=function(n,t){var i=n.getNorthEast(),r=t.getNorthEast(),u=n.getSouthWest(),f=t.getSouthWest();return i.lat()==r.lat()&&i.lng()==r.lng()&&u.lat()==f.lat()&&u.lng()==f.lng()},n.prototype._draggingChanged=function(n){this.isDragging(n)},n.prototype._listenForDragging=function(){var n=this;google.maps.event.addListener(this.map,"dragstart",function(){n._log("Firing map dragstart event."),n._draggingChanged(!0),n._log("Fired map dragstart event.")}),google.maps.event.addListener(this.map,"dragend",function(){n._log("Firing map dragend event."),n._draggingChanged(!1),n._log("Fired map dragend event.")})},n.prototype.addMarker=function(n){n.map=this.map;var t=new google.maps.Marker(n);return this.markers.push(t),t},n.prototype.clearMarkers=function(n){typeof n=="undefined"&&(n=!0);var t=this.markers().slice(0);return $.each(t,function(t,i){i.setMap(null),n&&(i=null)}),this.markers([]),t},n.prototype.replaceMarkers=function(n,t){typeof t=="undefined"&&(t=!0);var i=this,r=this.clearMarkers(t);return $.each(n,function(n,t){t.setMap(i.map),i.markers.push(t)}),r},n.prototype.openInfoWindowAtMarker=function(n,t){var i=new google.maps.InfoWindow(n);return this.infoWindows.push(i),i.open(this.map,t),i},n.prototype.clearInfoWindows=function(){var n=this.infoWindows().slice(0);return $.each(n,function(n,t){t.close(),t=null}),this.infoWindows([]),n},n.prototype.closeInfoWindows=function(){var n=this.infoWindows();$.each(n,function(n,t){t.close()})},n.prototype.triggerResize=function(){google.maps.event.trigger(this.map,"resize")},n.prototype._reducePrecision=function(n){var r=n,u=this._settings.maxPrecision,t,i,f;return u&&(t=n.toString(),i=t.indexOf("."),i>=0&&(f=t.substr(i,u+1),t=t.substr(0,i)+f,r=parseFloat(t))),r},n.prototype._log=function(n){for(var i=[],t=0;t<arguments.length-1;t++)i[t]=arguments[t+1];this._settings.log&&console&&console.log("MapWrapper: "+n.format(i))},n.defaultCenter=new google.maps.LatLng(0,0),n.emptyBounds=new google.maps.LatLngBounds(new google.maps.LatLng(1,180),new google.maps.LatLng(-1,-180)),n}();n.Map=t})(n.GoogleMaps||(n.GoogleMaps={}));var t=n.GoogleMaps})(App||(App={}))